<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cheng Chun Chieh">
<meta name="dcterms.date" content="2024-05-18">

<title>Visual Analytics - Take Home Ex 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Visual Analytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-ex" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-On Ex</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-ex">    
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx1/handson_ex01.html">
 <span class="dropdown-text">Hands-On Ex 1 - ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx2/handson_ex02.html">
 <span class="dropdown-text">Hands-On Ex 2 - Beyond ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx3/handson_ex03.html">
 <span class="dropdown-text">Hands-On Ex 3 - Interactive Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx3-2/handson_ex3-2.html">
 <span class="dropdown-text">Hands-On Ex 3.2 - Using Animation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx4/handsonex4.html">
 <span class="dropdown-text">Hands-On Ex 4 - Fundamentals of Visual Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx5/handsonex5.html">
 <span class="dropdown-text">Hands-On Ex 5 - Visualising and Analysing Text Data with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx6/handsonex6.html">
 <span class="dropdown-text">Hands-On Ex 6 - Network Data Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx7/handsonex7.html">
 <span class="dropdown-text">Hands-On Ex 7 - Time-Oriented Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx8/handsonex8.html">
 <span class="dropdown-text">Hands-On Ex 8 - Visualising Geospatial Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx9/handsonex9.html">
 <span class="dropdown-text">Hands-On Ex 9 - Visualising Multivariate Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/HandsOnEx9/handsonex10.html">
 <span class="dropdown-text">Hands-On Ex 10 - Info Dashboard</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-ex" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Ex</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-ex">    
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex01/inclassex01.html">
 <span class="dropdown-text">In-Class Ex 01 - ggplot2 basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex02/inclassex02.html">
 <span class="dropdown-text">In-Class Ex 02 - data visualisation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex03/inclassex3.html">
 <span class="dropdown-text">In-Class Ex 03 - Tableu Interactivity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex04/inclassex4.html">
 <span class="dropdown-text">In-Class Ex 04 - Visual Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex05/inclassex5.html">
 <span class="dropdown-text">In-Class Ex 05 - Text Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex06/inclassex6.html">
 <span class="dropdown-text">In-Class Ex 06 -</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex08/inclassex8.html">
 <span class="dropdown-text">In-Class Ex 08 - Geospatial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/Ex09/inclassex09.html">
 <span class="dropdown-text">In-Class Ex 09 - MultiVariate</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-ex" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Ex</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-ex">    
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/ex01/takehomeex1.html">
 <span class="dropdown-text">Take-Home Ex 01 - Real Estate Transaction Prices in Singapore</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/ex02/takehomeex2.html">
 <span class="dropdown-text">Take-Home Ex 02 - Data Visualisation Make-over</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/ex03/takehomeex3.html">
 <span class="dropdown-text">Take-Home Ex 03 - VAST CHallenge Mini-Case 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://public.tableau.com/app/profile/chun.chieh.cheng/vizzes"> <i class="bi bi-bar-chart-fill" role="img" aria-label="Tableau Public Profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:cc.cheng.2023@mitb.smu.edu.sg"> <i class="bi bi-envelope-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1. Overview</a>
  <ul class="collapse">
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link" data-scroll-target="#loading-packages">1.1 Loading Packages</a></li>
  <li><a href="#data-provided-by-the-challenge" id="toc-data-provided-by-the-challenge" class="nav-link" data-scroll-target="#data-provided-by-the-challenge">1.2 Data Provided by the Challenge</a>
  <ul class="collapse">
  <li><a href="#geography-data-of-oceanus" id="toc-geography-data-of-oceanus" class="nav-link" data-scroll-target="#geography-data-of-oceanus">1.2.1 Geography Data of Oceanus</a></li>
  <li><a href="#graph-data" id="toc-graph-data" class="nav-link" data-scroll-target="#graph-data">1.2.2 Graph Data</a></li>
  </ul></li>
  <li><a href="#importing-the-data" id="toc-importing-the-data" class="nav-link" data-scroll-target="#importing-the-data">1.3 Importing the Data</a></li>
  </ul></li>
  <li><a href="#tidying-the-data" id="toc-tidying-the-data" class="nav-link" data-scroll-target="#tidying-the-data">2. Tidying the Data</a>
  <ul class="collapse">
  <li><a href="#looking-at-the-nodes" id="toc-looking-at-the-nodes" class="nav-link" data-scroll-target="#looking-at-the-nodes">2.1 Looking at the Nodes</a>
  <ul class="collapse">
  <li><a href="#tidying-the-text" id="toc-tidying-the-text" class="nav-link" data-scroll-target="#tidying-the-text">2.1.1 Tidying the Text</a></li>
  </ul></li>
  <li><a href="#looking-at-the-edges" id="toc-looking-at-the-edges" class="nav-link" data-scroll-target="#looking-at-the-edges">2.2 Looking at the Edges</a>
  <ul class="collapse">
  <li><a href="#correcting-date-data-type" id="toc-correcting-date-data-type" class="nav-link" data-scroll-target="#correcting-date-data-type">2.2.1 Correcting date data type</a></li>
  <li><a href="#changing-the-field-names" id="toc-changing-the-field-names" class="nav-link" data-scroll-target="#changing-the-field-names">2.2.2 Changing the field names</a></li>
  <li><a href="#splitting-the-text-under-type" id="toc-splitting-the-text-under-type" class="nav-link" data-scroll-target="#splitting-the-text-under-type">2.2.3 Splitting the Text under Type</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#examining-the-data" id="toc-examining-the-data" class="nav-link" data-scroll-target="#examining-the-data">3. Examining the data</a>
  <ul class="collapse">
  <li><a href="#nodes-data" id="toc-nodes-data" class="nav-link" data-scroll-target="#nodes-data">3.1 Nodes Data</a></li>
  <li><a href="#splitting-the-text-under-type-1" id="toc-splitting-the-text-under-type-1" class="nav-link" data-scroll-target="#splitting-the-text-under-type-1">3.2 Splitting the text under type</a></li>
  <li><a href="#filter-out-the-species-in-region" id="toc-filter-out-the-species-in-region" class="nav-link" data-scroll-target="#filter-out-the-species-in-region">3.3 Filter out the Species in Region</a></li>
  <li><a href="#edges-data" id="toc-edges-data" class="nav-link" data-scroll-target="#edges-data">3.4 Edges Data</a></li>
  </ul></li>
  <li><a href="#qn-1---associate-vessels-with-their-cargo" id="toc-qn-1---associate-vessels-with-their-cargo" class="nav-link" data-scroll-target="#qn-1---associate-vessels-with-their-cargo">4. Qn 1 - Associate Vessels with their Cargo</a>
  <ul class="collapse">
  <li><a href="#visualising-the-harbor-records" id="toc-visualising-the-harbor-records" class="nav-link" data-scroll-target="#visualising-the-harbor-records">4.1 Visualising the Harbor Records</a></li>
  <li><a href="#wrangling-the-transponder-data" id="toc-wrangling-the-transponder-data" class="nav-link" data-scroll-target="#wrangling-the-transponder-data">4.2 Wrangling the Transponder Data</a>
  <ul class="collapse">
  <li><a href="#visualising-the-transponder-data" id="toc-visualising-the-transponder-data" class="nav-link" data-scroll-target="#visualising-the-transponder-data">4.2.1 Visualising the Transponder Data</a></li>
  <li><a href="#looking-at-the-areas-that-the-vessels-visited" id="toc-looking-at-the-areas-that-the-vessels-visited" class="nav-link" data-scroll-target="#looking-at-the-areas-that-the-vessels-visited">4.2.2 Looking at the areas that the vessels visited</a></li>
  <li><a href="#vessels-within-reserve-areas" id="toc-vessels-within-reserve-areas" class="nav-link" data-scroll-target="#vessels-within-reserve-areas">4.2.3 Vessels within Reserve Areas</a></li>
  <li><a href="#cargo-vessels-within-fishing-grounds" id="toc-cargo-vessels-within-fishing-grounds" class="nav-link" data-scroll-target="#cargo-vessels-within-fishing-grounds">4.2.4 Cargo Vessels within Fishing Grounds</a></li>
  <li><a href="#vessels-stay-duration-at-the-ports" id="toc-vessels-stay-duration-at-the-ports" class="nav-link" data-scroll-target="#vessels-stay-duration-at-the-ports">4.2.5 Vessels’ Stay Duration at the Ports</a></li>
  </ul></li>
  <li><a href="#finding-out-the-catches-within-the-vessel" id="toc-finding-out-the-catches-within-the-vessel" class="nav-link" data-scroll-target="#finding-out-the-catches-within-the-vessel">4.3 Finding out the catches within the Vessel</a></li>
  <li><a href="#wrangling-with-the-delivery-reports" id="toc-wrangling-with-the-delivery-reports" class="nav-link" data-scroll-target="#wrangling-with-the-delivery-reports">4.4 Wrangling with the Delivery Reports</a>
  <ul class="collapse">
  <li><a href="#deliveries-by-the-ports" id="toc-deliveries-by-the-ports" class="nav-link" data-scroll-target="#deliveries-by-the-ports">4.4.1 Deliveries by the Ports</a></li>
  <li><a href="#fish-species-not-found-in-fishing-grounds-but-delivered-at-the-ports" id="toc-fish-species-not-found-in-fishing-grounds-but-delivered-at-the-ports" class="nav-link" data-scroll-target="#fish-species-not-found-in-fishing-grounds-but-delivered-at-the-ports">4.4.2 Fish Species not found in Fishing Grounds but Delivered at the Ports</a></li>
  <li><a href="#monthly-delivery-trend-by-fish-types" id="toc-monthly-delivery-trend-by-fish-types" class="nav-link" data-scroll-target="#monthly-delivery-trend-by-fish-types">4.4.3 Monthly Delivery Trend by Fish Types</a></li>
  </ul></li>
  <li><a href="#merging-the-catch-summary-data-with-delivery-reports" id="toc-merging-the-catch-summary-data-with-delivery-reports" class="nav-link" data-scroll-target="#merging-the-catch-summary-data-with-delivery-reports">4.5 Merging the Catch Summary Data with Delivery Reports</a></li>
  </ul></li>
  <li><a href="#visualising" id="toc-visualising" class="nav-link" data-scroll-target="#visualising">5. Visualising</a>
  <ul class="collapse">
  <li><a href="#match-with-harbor-records-instead" id="toc-match-with-harbor-records-instead" class="nav-link" data-scroll-target="#match-with-harbor-records-instead">5.1 Match with Harbor Records Instead</a></li>
  </ul></li>
  <li><a href="#qn-2---illegal-activities-for-southseafood-express-corp-sec" id="toc-qn-2---illegal-activities-for-southseafood-express-corp-sec" class="nav-link" data-scroll-target="#qn-2---illegal-activities-for-southseafood-express-corp-sec">6. Qn 2 - Illegal Activities for SouthSeafood Express Corp (SEC)</a>
  <ul class="collapse">
  <li><a href="#identify-vessels-belonging-to-sec" id="toc-identify-vessels-belonging-to-sec" class="nav-link" data-scroll-target="#identify-vessels-belonging-to-sec">6.1 Identify Vessels belonging to SEC</a></li>
  <li><a href="#introducing-the-geospatial-data-to-help-in-visualising" id="toc-introducing-the-geospatial-data-to-help-in-visualising" class="nav-link" data-scroll-target="#introducing-the-geospatial-data-to-help-in-visualising">6.2 Introducing the Geospatial Data to help in visualising</a></li>
  <li><a href="#importing-geographical-data-in-esri-shapefile-format" id="toc-importing-geographical-data-in-esri-shapefile-format" class="nav-link" data-scroll-target="#importing-geographical-data-in-esri-shapefile-format">6.3 <strong>Importing Geographical Data in ESRI shapefile format</strong></a></li>
  <li><a href="#data-prep-for-vessel-movement-data" id="toc-data-prep-for-vessel-movement-data" class="nav-link" data-scroll-target="#data-prep-for-vessel-movement-data">6.4 Data Prep for Vessel Movement Data</a></li>
  <li><a href="#visualising-the-trajectories-of-snappy-snatcher-and-roach-robber" id="toc-visualising-the-trajectories-of-snappy-snatcher-and-roach-robber" class="nav-link" data-scroll-target="#visualising-the-trajectories-of-snappy-snatcher-and-roach-robber">6.5 Visualising the Trajectories of Snappy Snatcher and Roach Robber</a>
  <ul class="collapse">
  <li><a href="#transforming-the-vessel-movement-data-to-a-path" id="toc-transforming-the-vessel-movement-data-to-a-path" class="nav-link" data-scroll-target="#transforming-the-vessel-movement-data-to-a-path">6.5.1 Transforming the vessel movement data to a path</a></li>
  <li><a href="#calculating-the-dwell-time-mins-at-each-point" id="toc-calculating-the-dwell-time-mins-at-each-point" class="nav-link" data-scroll-target="#calculating-the-dwell-time-mins-at-each-point">6.5.2 Calculating the Dwell Time (mins) at each point</a></li>
  <li><a href="#path-of-snapper-snatcher-and-roach-robber" id="toc-path-of-snapper-snatcher-and-roach-robber" class="nav-link" data-scroll-target="#path-of-snapper-snatcher-and-roach-robber">6.5.3 Path of Snapper Snatcher and Roach Robber</a></li>
  <li><a href="#when-and-where-did-the-illegal-fishing-took-place" id="toc-when-and-where-did-the-illegal-fishing-took-place" class="nav-link" data-scroll-target="#when-and-where-did-the-illegal-fishing-took-place">6.5.4 When and Where did the illegal fishing took place?</a></li>
  <li><a href="#other-vessels-movement-path" id="toc-other-vessels-movement-path" class="nav-link" data-scroll-target="#other-vessels-movement-path">6.5.6 Other Vessels Movement Path</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#qn-3---workflow-to-discover-other-illegal-fishing" id="toc-qn-3---workflow-to-discover-other-illegal-fishing" class="nav-link" data-scroll-target="#qn-3---workflow-to-discover-other-illegal-fishing">7. Qn 3 - Workflow to discover other illegal fishing</a>
  <ul class="collapse">
  <li><a href="#plot-the-path-of-gurnard-grabber" id="toc-plot-the-path-of-gurnard-grabber" class="nav-link" data-scroll-target="#plot-the-path-of-gurnard-grabber">7.1 Plot the Path of Gurnard Grabber</a></li>
  <li><a href="#investigate-vessels-from-the-same-company" id="toc-investigate-vessels-from-the-same-company" class="nav-link" data-scroll-target="#investigate-vessels-from-the-same-company">7.2 Investigate vessels from the same company</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">8. References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Take Home Ex 3</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Cheng Chun Chieh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 18, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 19, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>1. Overview</h1>
<p>In Oceanus, island life is defined by the coming and going of seafaring vessels, many of which are operated by commercial fishing companies. Typically, the movement of ships and goods are a sign of Oceanus’s healthy economy, especially in the fishing business. But mundane routines can be disrupted by a major event. Analysts at FishEye International, a non-profit organization that aims to find and prevent illegal fishing, need your help to better understand one such event.</p>
<p>FishEye has learned that SouthSeafood Express Corp has been caught fishing illegally. The scandal caused a major disruption in the close-knit fishing community. FishEye has been collecting data on ship movements and shipping records in hopes that they could assemble a cohesive store of knowledge that will allow them to better understand local commercial fishing behavior. FishEye processed open-source and commercial vessel tracking and shipping records into CatchNet: the Oceanus Knowledge Graph. Analysts examine and correct data as it is loaded but need your help to create analytical capabilities for this data.</p>
<p>FishEye analysts need your help to perform geographic and temporal analysis of the CatchNet data so they can prevent illegal fishing from happening again. Your task is to develop new visual analytics tools and workflows that can be used to discover and understand signatures of different types of behavior. Can you use your tool to visualize a signature of SouthSeafood Express Corp’s illegal behavior? FishEye needs your help to develop a workflow to find other instances of illegal behavior.</p>
<ol type="1">
<li><p>FishEye analysts have long wanted to better understand the flow of commercially caught fish through Oceanus’s many ports. But as they were loading data into CatchNet, they discovered they had purchased the wrong port records. They wanted to get the ship off-load records, but they instead got the port-exit records (essentially trucks/trains leaving the port area). Port exit records do not include which vessel that delivered the products. Given this limitation, develop a visualization system to associate vessels with their probable cargos. Which vessels deliver which products and when? What are the seasonal trends and anomalies in the port exit records?</p></li>
<li><p>Develop visualizations that illustrate the inappropriate behavior of SouthSeafood Express Corp vessels. How do their movement and catch contents compare to other fishing vessels? When and where did SouthSeafood Express Corp vessels perform their illegal fishing? How many different types of suspicious behaviors are observed? Use visual evidence to justify your conclusions.</p></li>
<li><p>To support further Fisheye investigations, develop visual analytics workflows that allow you to discover other vessels engaging in behaviors similar to SouthSeafood Express Corp’s illegal activities? Provide visual evidence of the similarities.</p></li>
<li><p>How did fishing activity change after SouthSeafood Express Corp was caught? What new behaviors in the Oceanus commercial fishing community are most suspicious and why?</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For this Take-home Ex 3 - I will be focusing on Qn 1 and 2 first. If time is available, I will also attempt to go in to Qn 3.</p>
<p>To note that we will subsequently package these as part of our project.</p>
</div>
</div>
<section id="loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages">1.1 Loading Packages</h2>
<p>Because the data are given in a json file format - we will have to load it using jsonlite. The following are the packages that we will be using for this ex.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(jsonlite, tidygraph, igraph, ggraph, visNetwork, graphlayouts, ggforce, skimr, tidytext, tidyverse, plotly, shiny, DT, sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-provided-by-the-challenge" class="level2">
<h2 class="anchored" data-anchor-id="data-provided-by-the-challenge">1.2 Data Provided by the Challenge</h2>
<section id="geography-data-of-oceanus" class="level3">
<h3 class="anchored" data-anchor-id="geography-data-of-oceanus">1.2.1 Geography Data of Oceanus</h3>
<p><img src="data/Oceanus Geography.png" class="img-fluid"></p>
</section>
<section id="graph-data" class="level3">
<h3 class="anchored" data-anchor-id="graph-data">1.2.2 Graph Data</h3>
<p>The following is the graph data provided:</p>
<ul>
<li><p>Directed multi-graph, allowing multiple edges between nodes</p></li>
<li><p>5637 nodes</p></li>
<li><p>271752 edges</p></li>
<li><p>1 (weakly) connected component</p></li>
</ul>
<p>Which covers:</p>
<ul>
<li><p><strong>Vessel Movements:</strong> Oceanus is outfitted with a transponder/ping system named the Oceanus Vessel Locator System (OVLS).&nbsp; Vessels are outfitted with a transponder and periodic ‘pings’ from base-stations results in a report of vessel locations at any time.&nbsp; The raw ping granularity is at the minute-level but post-processing has converted it into visit/dwell times. OVLS is generally reliable, though vessel records may be missing for a variety of reasons.</p>
<ul>
<li><p>Node/Edge types and properties present</p>
<ul>
<li><p>Entity.Vessel: Description of the vessel</p></li>
<li><p>Entity.Location: Description of a geographic location</p></li>
<li><p>Event.TransponderPing: Links a vessel to a location</p></li>
</ul></li>
</ul></li>
<li><p><strong>Harbor Reports:</strong> Harbor masters regularly report the vessels found in their purview anytime during the day.&nbsp; This data is derived from a different system than OVLS (see “Vessel Movements”), though the data overlaps.&nbsp; Harbor Reports are provided on a different schedule from different harbors. Since no harbor reports every day, this data has lower temporal granularity than vessel movement data. Additionally, the Harbor Master is also responsible for proximate navigational beacon(s), so this data has lower spatial granularity as well.&nbsp; However, the list of vessels observed is considered canonical.</p>
<ul>
<li><p>Node/edge types present:</p>
<ul>
<li><p>Entity.Vessel</p></li>
<li><p>Entity.location</p></li>
<li><p>Event.HarborReport</p></li>
</ul></li>
</ul></li>
<li><p><strong>Harbor Import Records</strong>: Vessels deliver cargo to the ports, and that cargo is brought into Oceanus.&nbsp; These records reflect the goods that *leave* the harbor to go to businesses in Oceanus or to be exported.&nbsp; It was filtered pre-ingest to focus on the delivery of raw fish.&nbsp; Because it is raw, fish leave the port quickly (generally one day after delivery).&nbsp; Due to clerical error, the records purchased by FishEye do not include the vessel that delivered the cargo.</p>
<ul>
<li><p>Node/Edge types present:</p>
<ul>
<li><p>Entity.location</p></li>
<li><p>Entity.Commodity.Fish</p></li>
<li><p>Entity.Document.DeliveryReport</p></li>
<li><p>Event.Transaction</p></li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="importing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data">1.3 Importing the Data</h2>
<p>We will use jsonlite to import the data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mc2_data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span> (<span class="st">"data/mc2.json"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Importing the nodes and edges as tibble data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(mc2_data<span class="sc">$</span>links) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(mc2_data<span class="sc">$</span>nodes) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="tidying-the-data" class="level1">
<h1>2. Tidying the Data</h1>
<section id="looking-at-the-nodes" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-the-nodes">2.1 Looking at the Nodes</h2>
<p>We first look at the types of nodes and how many of each are present in the data set:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>type_counts_nodes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span> <span class="fu">count</span>(type)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts_nodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Of note we have:</p>
<ul>
<li><p>5307 Delivery Reports</p></li>
<li><p>178 Fishing Vessel and 100 Cargo Vessels</p></li>
<li><p>10 Types of Fish</p></li>
</ul>
<section id="tidying-the-text" class="level3">
<h3 class="anchored" data-anchor-id="tidying-the-text">2.1.1 Tidying the Text</h3>
<p>From the table above, beside the date data type and inappropriate field name issues we discussed earlier, two additional data issues can be observed. They are:</p>
<ul>
<li><p>The values in Activities and fish_species_present fields are in <strong>list</strong> data type, which will affect the ability to process and to analyse the data.</p></li>
<li><p>As shown in the screenshot below, some values in the Activities field are not ready to be analyse without further tidying (i.e.&nbsp;removing c(““)).</p></li>
</ul>
<p>In the code chunk below,&nbsp;<code>mutate()</code>&nbsp;of dplyr and&nbsp;<code>gsub()</code>&nbsp;of Base R are used to perform the data todying task.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mc2_nodes_tidied <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Activities =</span> <span class="fu">gsub</span>(<span class="st">"c[(]"</span>, <span class="st">""</span>, Activities)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Activities =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>, Activities)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Activities =</span> <span class="fu">gsub</span>(<span class="st">"[)]"</span>, <span class="st">""</span>, Activities)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mc2_nodes_tidied <span class="ot">&lt;-</span> mc2_nodes_tidied <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">gsub</span>(<span class="st">"c[(]"</span>, <span class="st">""</span>, fish_species_present)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>, fish_species_present)) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">gsub</span>(<span class="st">"[)]"</span>, <span class="st">""</span>, fish_species_present)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mc2_nodes_tidied, <span class="st">"data/rds/mc2_nodes_tidied.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="looking-at-the-edges" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-the-edges">2.2 Looking at the Edges</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>type_counts_edges <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span> <span class="fu">count</span>(type)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts_edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="correcting-date-data-type" class="level3">
<h3 class="anchored" data-anchor-id="correcting-date-data-type">2.2.1 Correcting date data type</h3>
<p>The date format is not easily readable - so we need to convert them into something useful.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(mc2_edges<span class="sc">$</span>time)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span><span class="st">"_last_edited_date"</span> <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(mc2_edges<span class="sc">$</span><span class="st">"_last_edited_date"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span><span class="st">"_date_added"</span> <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(mc2_edges<span class="sc">$</span><span class="st">"_date_added"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span><span class="st">"date"</span> <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(<span class="st">"mc2_edges$date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mc2_edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="changing-the-field-names" class="level3">
<h3 class="anchored" data-anchor-id="changing-the-field-names">2.2.2 Changing the field names</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"last_edited_by"</span> <span class="ot">=</span> <span class="st">"_last_edited_by"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"date_added"</span> <span class="ot">=</span> <span class="st">"_date_added"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"last_edited_date"</span> <span class="ot">=</span> <span class="st">"_last_edited_date"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"raw_source"</span> <span class="ot">=</span> <span class="st">"_raw_source"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"algo"</span> <span class="ot">=</span> <span class="st">"_algorithm"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="splitting-the-text-under-type" class="level3">
<h3 class="anchored" data-anchor-id="splitting-the-text-under-type">2.2.3 Splitting the Text under Type</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>word_list <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(mc2_edges<span class="sc">$</span>type, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>max_elements <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">lengths</span>(word_list))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>word_list_padded <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word_list, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">c</span>(x, <span class="fu">rep</span>(<span class="cn">NA</span>, max_elements <span class="sc">-</span> <span class="fu">length</span>(x))))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, word_list_padded)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(word_df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"event"</span>, <span class="dv">1</span><span class="sc">:</span>max_elements)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(word_df) <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(event2, event3)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(word_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(word_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mc2_edges, <span class="st">"data/rds/mc2_edges.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="examining-the-data" class="level1">
<h1>3. Examining the data</h1>
<p>Loading the rds files:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/mc2_edges.rds"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/mc2_nodes_tidied.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="nodes-data" class="level2">
<h2 class="anchored" data-anchor-id="nodes-data">3.1 Nodes Data</h2>
<p>From the nodes data, we have the following information:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>type_counts <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   type                           count
   &lt;chr&gt;                          &lt;int&gt;
 1 Entity.Commodity.Fish             10
 2 Entity.Document.DeliveryReport  5307
 3 Entity.Location.City               6
 4 Entity.Location.Point             12
 5 Entity.Location.Region             6
 6 Entity.Vessel.CargoVessel        100
 7 Entity.Vessel.Ferry.Cargo          2
 8 Entity.Vessel.Ferry.Passenger      3
 9 Entity.Vessel.FishingVessel      178
10 Entity.Vessel.Other                5
11 Entity.Vessel.Research             2
12 Entity.Vessel.Tour                 6</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 67%">
</colgroup>
<thead>
<tr class="header">
<th>Data</th>
<th>Description</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Fish</td>
<td>10 Species of Fish</td>
<td><p>Key fields are the:</p>
<p><code>name</code> and <code>id</code></p></td>
</tr>
<tr class="even">
<td>Location</td>
<td>Contains Point, City and Region</td>
<td><p>Contains the <code>Name</code> and id of the location - key field is the <code>id</code></p>
<p><code>fish_species_present</code> is only listed for the region. Only 3 region for commercial fishing - <strong>Cod Table, Tuna Shelf and Wrasse Beds</strong>.</p></td>
</tr>
<tr class="odd">
<td>Delivery Report</td>
<td>5307 Delivery Report</td>
<td><p>Contains the <code>id</code> tied to the cargo id.</p>
<p>Also contains the qty by tons (<code>qty_tons</code>) and the date of the delivery (<code>date</code>).</p></td>
</tr>
<tr class="even">
<td>Fishing Vessel</td>
<td>178 Fishing Vessel</td>
<td><p>Contains the <code>Name</code> and id of the vessel. We can use <code>id</code> to identify the vessels.</p>
<p>Other info includes: <code>flag_country</code>, <code>company</code>, <code>tonnage</code>, <code>length_overall</code>,</p></td>
</tr>
<tr class="odd">
<td>Cargo Vessel</td>
<td>100 Cargo Vessels</td>
<td>To explore given that these vessels can be used for transshipment or IUU activities.</td>
</tr>
<tr class="even">
<td>Other Vessels</td>
<td>Such as Passenger, Research, Tour and Others</td>
<td>KIV - but dont think needed for our analysis</td>
</tr>
</tbody>
</table>
<p>We noticed that there are two columns for the name - one with <code>name</code> and the other with <code>Name</code>. Let us try to combine them into one column for easier analysis:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>overlaps <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Name) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(name) <span class="sc">&amp;</span> <span class="fu">tolower</span>(Name) <span class="sc">==</span> <span class="fu">tolower</span>(name))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print overlaps</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Overlaps between 'Name' and 'name' columns:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Overlaps between 'Name' and 'name' columns:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlaps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 20
# ℹ 20 variables: type &lt;chr&gt;, _last_edited_by &lt;chr&gt;, _date_added &lt;chr&gt;,
#   _last_edited_date &lt;chr&gt;, _raw_source &lt;chr&gt;, _algorithm &lt;chr&gt;, name &lt;chr&gt;,
#   id &lt;chr&gt;, Name &lt;chr&gt;, Description &lt;chr&gt;, Activities &lt;chr&gt;, kind &lt;chr&gt;,
#   qty_tons &lt;dbl&gt;, date &lt;chr&gt;, flag_country &lt;chr&gt;, company &lt;chr&gt;,
#   tonnage &lt;int&gt;, length_overall &lt;int&gt;, style &lt;chr&gt;,
#   fish_species_present &lt;chr&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine columns into one named 'name'</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(name), Name, name)) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="splitting-the-text-under-type-1" class="level2">
<h2 class="anchored" data-anchor-id="splitting-the-text-under-type-1">3.2 Splitting the text under type</h2>
<p>Like how we split the text for edges, we will do so for the nodes data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>word_list <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(mc2_nodes<span class="sc">$</span>type, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>max_elements <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">lengths</span>(word_list))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>word_list_padded <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word_list, </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">c</span>(x, <span class="fu">rep</span>(<span class="cn">NA</span>, max_elements <span class="sc">-</span> <span class="fu">length</span>(x))))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, word_list_padded)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(word_df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"entity"</span>, <span class="dv">1</span><span class="sc">:</span>max_elements)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(word_df) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(entity2, entity3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(word_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filter-out-the-species-in-region" class="level2">
<h2 class="anchored" data-anchor-id="filter-out-the-species-in-region">3.3 Filter out the Species in Region</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fish_species_df <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity3 <span class="sc">==</span> <span class="st">'Region'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, fish_species_present)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the fish_species_present column into a long format data frame for plotting</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>long_fish_species_df <span class="ot">&lt;-</span> fish_species_df <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(fish_species_present, <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">str_trim</span>(fish_species_present)) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> name, <span class="at">fish_species =</span> fish_species_present)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>reserve_only_species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Sockfish/Pisces foetida'</span>, <span class="st">'Offidiaa/Piscis osseus'</span>, <span class="st">'Helenaa/Pisces satis'</span>)  <span class="co"># Example reserve-only species</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column to indicate if a fish species is reserve-only</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>long_fish_species_df <span class="ot">&lt;-</span> long_fish_species_df <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reserve_only =</span> <span class="fu">ifelse</span>(fish_species <span class="sc">%in%</span> reserve_only_species, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, fish_species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(long_fish_species_df, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> reserve_only)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fish Species Present in Different Regions"</span>, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Salmon is not found in the Regions"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="edges-data" class="level2">
<h2 class="anchored" data-anchor-id="edges-data">3.4 Edges Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>type_counts <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  type                                  count
  &lt;chr&gt;                                 &lt;int&gt;
1 Event.HarborReport                     2487
2 Event.Transaction                     10614
3 Event.TransportEvent.TransponderPing 258542</code></pre>
</div>
</div>
<p>We have 3 groups of data in the edges mainly the HarborReport, Transaction and the TransponderPing.</p>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 45%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Data</th>
<th>Description</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Harbor Reports</td>
<td><p>Contains information about the vessel docking at which harbor.</p>
<p>There is a key column, but not sure what it means.</p>
<p>Contains a few other columns with aphorism, holiday greeting etc but seems not impt for our analysis here.</p></td>
<td><p>Key fields here are:</p>
<p><code>source</code> which is tied to the <code>id</code> of a vessel.</p>
<p><code>target</code> which is tied to the <code>name</code> of the city.</p>
<p><code>date_added</code> and <code>last_edited_date</code> are the two key dates available</p></td>
</tr>
<tr class="even">
<td>Transaction</td>
<td><p>Information from OCEANS</p>
<p>Each transaction has two rows - one connecting the transaction to the City, the other to the fish species.</p></td>
<td><p>Key fields here are:</p>
<p><code>source</code> which is tied to the <code>id</code> of a cargo.</p>
<p><code>target</code> which is tied to the <code>name</code> of the city and the <code>id</code> of the fish.</p>
<p><code>date_added</code> and <code>last_edited_date</code> are the two key dates available</p></td>
</tr>
<tr class="odd">
<td>Transponder Ping</td>
<td><p>Information from OVLS</p>
<p>Contains information about the time of ping, dwell time, and location.</p></td>
<td><p>Key fields here are:</p>
<p><code>source</code> which is tied to the <code>name</code>of a location.</p>
<p><code>target</code> which is tied to the <code>id</code> of the vessel.</p>
<p><code>time</code>, <code>date_added</code>and <code>last_edited_date</code> are the three dates available - should be focusing on <code>time</code> here.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="qn-1---associate-vessels-with-their-cargo" class="level1">
<h1>4. Qn 1 - Associate Vessels with their Cargo</h1>
<p>We want to know which <strong>vessel offload their cargo</strong> at <strong>which port</strong> on <strong>which date and time</strong>.</p>
<p>We can first utilised the harbor reports to find out which vessels have been to which harbor - this would give us an initial starting point. As the list of vessels observed is canonical (i.e.&nbsp;accurate) - this can help with our analysis later. However, we note that the date/time is not very accurate here.</p>
<p>Next, we need to wrangle with the transponder data. We want to have a list of all the vessels, by their date/time, which date they visited a harbor and on which day they left a harbor.</p>
<p>So based on the above data, we would generate a data frame with the different rows of date/time and list out in the columns - vessel, location_transponder (which port), within harbor report (yes or no).</p>
<p>Next we will combine the transaction with the delivery report first. So we will be able to match the date of delivery, cargo_id, qty, fish, and which harbor.</p>
<p>Then finally, we can combine the data based on the date that a vessel enter the port, and exit the port, the cargo during this time point.</p>
<section id="visualising-the-harbor-records" class="level2">
<h2 class="anchored" data-anchor-id="visualising-the-harbor-records">4.1 Visualising the Harbor Records</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>vessel_list <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Entity.Vessel.FishingVessel"</span>, <span class="st">"Entity.Vessel.CargoVessel"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    type <span class="sc">==</span> <span class="st">"Entity.Vessel.FishingVessel"</span> <span class="sc">~</span> <span class="st">"FishingVessel"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    type <span class="sc">==</span> <span class="st">"Entity.Vessel.CargoVessel"</span> <span class="sc">~</span> <span class="st">"CargoVessel"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(type, name, id, flag_country, tonnage, length_overall, company) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">vessel =</span> id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>harbor_records <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event.HarborReport"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_added, last_edited_date, source, target) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"source"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"port"</span> <span class="ot">=</span> <span class="st">"target"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>harbor_records <span class="ot">&lt;-</span> harbor_records <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vessel_list, <span class="at">by =</span> <span class="st">"vessel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(name) <span class="sc">&amp;</span> name <span class="sc">!=</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>visit_counts <span class="ot">&lt;-</span> harbor_records <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date_added, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, vessel, type, month) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">visit_count =</span> <span class="fu">n</span>(), </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">visit_dates =</span> <span class="fu">paste</span>(date_added, <span class="at">collapse =</span> <span class="st">', '</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>visits_fishing <span class="ot">&lt;-</span> visit_counts <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"FishingVessel"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>visits_fishing <span class="ot">&lt;-</span> visits_fishing <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(month, port, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">visit_count =</span> <span class="cn">NA</span>))</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>visits_cargo <span class="ot">&lt;-</span> visit_counts <span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"CargoVessel"</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>visits_cargo <span class="ot">&lt;-</span> visits_cargo <span class="sc">%&gt;%</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(month, port, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">visit_count =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(visits_fishing, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> port, <span class="at">fill =</span> visit_count)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"azure1"</span>, <span class="at">high =</span> <span class="st">"deepskyblue4"</span>, <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Paackland and Haacklee more frequented by Fishing Vessels"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Port"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on the Harbor Records"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Number of Visits"</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(visits_cargo, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> port, <span class="at">fill =</span> visit_count)) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"azure1"</span>, <span class="at">high =</span> <span class="st">"deepskyblue4"</span>, <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Paackland and Lomark more frequented by Cargo Vessels"</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Port"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on the Harbor Records"</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Number of Visits"</span>) <span class="sc">+</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-portvisits" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-portvisits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-portvisits" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-portvisits-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-portvisits-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="takehomeex3_files/figure-html/fig-portvisits-1.png" class="img-fluid figure-img" data-ref-parent="fig-portvisits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-portvisits-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Port Visits by Fishing Vessels
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-portvisits" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-portvisits-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-portvisits-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="takehomeex3_files/figure-html/fig-portvisits-2.png" class="img-fluid figure-img" data-ref-parent="fig-portvisits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-portvisits-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Port Visits by Cargo Vessels
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-portvisits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Both Fishing and Cargo Vessels frequent Paackland
</figcaption>
</figure>
</div>
</section>
<section id="wrangling-the-transponder-data" class="level2">
<h2 class="anchored" data-anchor-id="wrangling-the-transponder-data">4.2 Wrangling the Transponder Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event.TransportEvent.TransponderPing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, dwell, source, target) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"target"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting only the 'id' and 'vessel' columns from vessel_list</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>vessel_subset <span class="ot">&lt;-</span> vessel_list <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vessel, name, type) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="at">id =</span> vessel)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing left join on transponder and vessel_subset</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> <span class="fu">left_join</span>(transponder, vessel_subset, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering only those Cargo and Fishing Vessels</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="visualising-the-transponder-data" class="level3">
<h3 class="anchored" data-anchor-id="visualising-the-transponder-data">4.2.1 Visualising the Transponder Data</h3>
<p>For us to better visualise the transponder data, we will split the data by months and also group it by the days of the week.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(time),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">wday</span>(time, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We want to also indicate if the vessel was within a port or not.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ifelse</span> (<span class="fu">grepl</span>(<span class="st">"^City of"</span>, source), <span class="st">"Ports"</span>, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ifelse</span>(source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cod Table"</span>, <span class="st">"Tuna Shelf"</span>, <span class="st">"Wrasse Beds"</span>), <span class="st">"Fishing Grounds"</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^Nav"</span>, source), <span class="st">"Nav Areas"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Don Limpet Preserve"</span>, <span class="st">"Nemo Reef"</span>, <span class="st">"Ghoti Preserve"</span>), <span class="st">"Reserves"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^Exit"</span>, source), <span class="st">"Exit Areas"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Unknown"</span>)))))) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"location"</span> <span class="ot">=</span> <span class="st">"source"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vessel, time) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel, location) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_start =</span> time,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_end =</span> time <span class="sc">+</span> dwell,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_duration =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(stay_end, stay_start, <span class="at">units =</span> <span class="st">"mins"</span>))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows where location is NA or stay_duration is NA or negative</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(stay_duration) <span class="sc">&amp;</span> stay_duration <span class="sc">&gt;=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="looking-at-the-areas-that-the-vessels-visited" class="level3">
<h3 class="anchored" data-anchor-id="looking-at-the-areas-that-the-vessels-visited">4.2.2 Looking at the areas that the vessels visited</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transponder, <span class="fu">aes</span>(<span class="at">x =</span> area, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cargo Vessels should not linger in Fishing Grounds or Reserves"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Location Type"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Vessel Type"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Fishing Vessels were present in Reserves as well"</span>) <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"azure4"</span>, <span class="st">"lightskyblue4"</span>)) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="vessels-within-reserve-areas" class="level3">
<h3 class="anchored" data-anchor-id="vessels-within-reserve-areas">4.2.3 Vessels within Reserve Areas</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>reserves_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="st">"Reserves"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of unique vessels in the reserves area by vessel type</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>unique_vessels_count <span class="ot">&lt;-</span> reserves_data <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">unique_vessels =</span> <span class="fu">n_distinct</span>(vessel))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(reserves_data<span class="sc">$</span>stay_duration)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(reserves_data<span class="sc">$</span>stay_duration)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a box plot of the dwell time in the reserves area</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>boxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reserves_data, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> stay_duration, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure3"</span>, <span class="at">color =</span> <span class="st">"lightskyblue4"</span>, <span class="at">outlier.shape =</span> <span class="dv">16</span>, <span class="at">outlier.size =</span> <span class="dv">2</span>, <span class="at">outlier.colour =</span> <span class="st">"deepskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"azure4"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add mean line</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median_value, <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Many Instances of Fishing Vessel Overspending Time in Reserves"</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins) - Log Scale"</span>,</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"71 Cargo Vessels and 131 Fishing Vessels spent time in Reserves"</span>) <span class="sc">+</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of unique vessels in the reserves area</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_vessels_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  type          unique_vessels
  &lt;chr&gt;                  &lt;int&gt;
1 CargoVessel               71
2 FishingVessel            131</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the box plot</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(boxplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cargo-vessels-within-fishing-grounds" class="level3">
<h3 class="anchored" data-anchor-id="cargo-vessels-within-fishing-grounds">4.2.4 Cargo Vessels within Fishing Grounds</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for cargo vessels in fishing grounds</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>cargo_fishing_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"CargoVessel"</span> <span class="sc">&amp;</span> area <span class="sc">==</span> <span class="st">"Fishing Grounds"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and median values</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(cargo_fishing_data<span class="sc">$</span>stay_duration)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(cargo_fishing_data<span class="sc">$</span>stay_duration)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a box plot of the dwell time for cargo vessels in fishing grounds</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cargo_fishing_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure3"</span>, <span class="at">color =</span> <span class="st">"lightskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"azure4"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add mean line</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median_value, <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cargo Vessels spending more time in Fishing Grounds"</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (min) (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>vessels_above_mean <span class="ot">&lt;-</span> cargo_fishing_data <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stay_duration <span class="sc">&gt;</span> mean_value)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of unique vessels</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>num_vessels_above_mean <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(vessels_above_mean<span class="sc">$</span>vessel)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the count</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_vessels_above_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Notice that there is only 1 Cargo Vessel which stays in the fishing grounds above the mean duration - <strong>Nautical Nomad</strong> (<strong>Tuna Shelf and Wrasse Beds</strong>).</p>
<p>Why is this out of the norm? Typical cargo vessels could have only just transited across the fishing grounds, but if the cargo vessel stays beyond the transit time, they could be involved in illegal fishing activities, e.g.&nbsp;transshipment at sea as shown in the photo below.</p>
<p><img src="images/clipboard-2365353441.png" class="img-fluid" width="495"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transponder, <span class="fu">aes</span>(<span class="at">x =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span> (<span class="dv">0</span>, <span class="dv">5000</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Stay Duration is typically about 100 mins"</span>, <span class="at">x =</span> <span class="st">"Stay Duration (mins)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)<span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We will notice that there are vessels with dwell time = 0. This is so for the first row of data for each vessel, where it seems to initialise the starting of the location tracking of each vessel. However, there are also other times, where the dwell time was 0. Thinking that this could due to the vessel passing by the Port or could have traveled within the vicinity.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize data to get the number of unique vessels in each reserve area</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>vessels_reserve <span class="ot">&lt;-</span> reserves_data <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">unique_vessel_count =</span> <span class="fu">n_distinct</span>(vessel))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>reserves_data <span class="ot">&lt;-</span> reserves_data <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">stay_duration_min =</span> stay_duration<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart showing the number of unique vessels in different reserve areas</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vessels_reserve, <span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> unique_vessel_count)) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>) <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nemo Reef saw the most vessels entering the reserve"</span>,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Reserve Area"</span>,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Unique Vessels"</span>) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> unique_vessel_count), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of stay_duration in different reserve areas</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(reserves_data, <span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> stay_duration_min)) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightskyblue3"</span>) <span class="sc">+</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"But Ghoti Preserve saw longer stay duration"</span>,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Reserve Area"</span>,</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins)"</span>) <span class="sc">+</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-reservesvisits" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-reservesvisits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-reservesvisits" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-reservesvisits-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-reservesvisits-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="takehomeex3_files/figure-html/fig-reservesvisits-1.png" class="img-fluid figure-img" data-ref-parent="fig-reservesvisits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-reservesvisits-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Number of Unique Vessels entering the Reserves
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-reservesvisits" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-reservesvisits-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-reservesvisits-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="takehomeex3_files/figure-html/fig-reservesvisits-2.png" class="img-fluid figure-img" data-ref-parent="fig-reservesvisits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-reservesvisits-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Stay Duration (mins) of the Vessels
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-reservesvisits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Vessels entering Reserves and their Stay Duration
</figcaption>
</figure>
</div>
</section>
<section id="vessels-stay-duration-at-the-ports" class="level3">
<h3 class="anchored" data-anchor-id="vessels-stay-duration-at-the-ports">4.2.5 Vessels’ Stay Duration at the Ports</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>port_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="st">"Ports"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(port_data<span class="sc">$</span>stay_duration)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(port_data<span class="sc">$</span>stay_duration)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a box plot of the dwell time in the reserves area</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>boxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(port_data, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> stay_duration, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure3"</span>, <span class="at">color =</span> <span class="st">"lightskyblue4"</span>, <span class="at">outlier.shape =</span> <span class="dv">16</span>, <span class="at">outlier.size =</span> <span class="dv">2</span>, <span class="at">outlier.colour =</span> <span class="st">"deepskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"azure4"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add mean line</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median_value, <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cargo Vessels spend less time at ports as compared to Fishing Vessels"</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins) - Log Scale"</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Average Time: 1985mins ; Median Time: 1675mins"</span>) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the box plot</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(boxplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="finding-out-the-catches-within-the-vessel" class="level2">
<h2 class="anchored" data-anchor-id="finding-out-the-catches-within-the-vessel">4.3 Finding out the catches within the Vessel</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fishes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Entity.Commodity.Fish"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"name"</span>, <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"fishid"</span> <span class="ot">=</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Entity.Location.Region"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> region <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(fish_species_present, <span class="at">sep =</span> <span class="st">",</span><span class="sc">\\</span><span class="st">s*"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> region <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fish_species_present"</span> <span class="ot">=</span> <span class="st">"name"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>possible_catches <span class="ot">&lt;-</span> region <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fishes =</span> <span class="fu">list</span>(<span class="fu">unique</span>(fishid))) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"location"</span> <span class="ot">=</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mapped_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(possible_catches, <span class="at">by =</span> <span class="st">"location"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify port returns</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>mapped_data<span class="sc">$</span>is_port_return <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"^City of"</span>, mapped_data<span class="sc">$</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>catch_summary <span class="ot">&lt;-</span> mapped_data <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, vessel, <span class="at">return_number =</span> <span class="fu">cumsum</span>(is_port_return)) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_port =</span> <span class="fu">first</span>(location),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_leg =</span> <span class="fu">first</span>(time),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_point_b4_port =</span> <span class="fu">last</span>(location),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_before_port =</span> <span class="fu">last</span>(time),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_check =</span> <span class="fu">first</span>(time <span class="sc">+</span> dwell),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">possible_catches =</span> <span class="fu">list</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(fishes)))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>catch_summary <span class="ot">&lt;-</span> catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">end_port =</span> <span class="fu">lead</span>(start_port, <span class="at">order_by =</span> id),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_into_port =</span> <span class="fu">lead</span>(start_leg, <span class="at">order_by =</span> id),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_exit_port =</span> <span class="fu">lead</span>(time_check, <span class="at">order_by =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(possible_catches) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"possible_catches"</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">"port"</span> <span class="ot">=</span> <span class="st">"end_port"</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"vessel"</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vessel_list, <span class="at">by =</span> <span class="st">"name"</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"fishid"</span>))</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, name.y))</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (name.x, port, time_into_port, time_exit_port, type, flag_country, tonnage, company, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"name.x"</span>)</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(time_into_port,<span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>catch_month_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">vessel_count =</span> <span class="fu">n_distinct</span>(vessel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(catch_month_summary, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> fishtype, <span class="at">size =</span> vessel_count)) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"lightskyblue4"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)) <span class="sc">+</span>  <span class="co"># Adjust the range of the dot sizes</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Possible Fish Types Caught by Month"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fish Type"</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on the transponder data and their duration in the region"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Vessels"</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, we attempt to match the catch summary with the harbor records, so that we exclude transponder pings that are not part of the harbor records.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>harbor_summary <span class="ot">&lt;-</span> catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">harbor =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(harbor_records<span class="sc">$</span>name <span class="sc">==</span> vessel <span class="sc">&amp;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                        harbor_records<span class="sc">$</span>port <span class="sc">==</span> end_port <span class="sc">&amp;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                        harbor_records<span class="sc">$</span>date_added <span class="sc">&gt;=</span> time_into_port),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Y"</span>, <span class="st">"N"</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>harbor_summary <span class="ot">&lt;-</span> harbor_summary<span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(harbor <span class="sc">==</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrangling-with-the-delivery-reports" class="level2">
<h2 class="anchored" data-anchor-id="wrangling-with-the-delivery-reports">4.4 Wrangling with the Delivery Reports</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>deliveryreports <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Entity.Document.DeliveryReport"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, qty_tons, date) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(deliveryreports, <span class="fu">aes</span>(<span class="at">x =</span> qty_tons)) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"There are 5307 delivery reports and the qty ranges from 0 to ~80tons"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Quantity in Tons"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"315 values are 0 and below (to remove these data)"</span>) <span class="sc">+</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"deepskyblue4"</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>delivery_reports_0andbelow <span class="ot">&lt;-</span> deliveryreports <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (qty_tons <span class="sc">&lt;=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> deliveryreports <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (qty_tons <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>delivery_trans <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event.Transaction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(source, target, date_added) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"source"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>delivery_trans<span class="sc">$</span>index <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">seq</span>(<span class="fu">nrow</span>(delivery_trans)) <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"port"</span>, <span class="st">"fish"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>delivery_trans1 <span class="ot">&lt;-</span> delivery_trans <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> index, <span class="at">values_from =</span> target) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"fishid"</span> <span class="ot">=</span> <span class="st">"fish"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delivery_trans1, <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="st">"fishid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fishid, <span class="sc">-</span>name, <span class="sc">-</span>date_added)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="deliveries-by-the-ports" class="level3">
<h3 class="anchored" data-anchor-id="deliveries-by-the-ports">4.4.1 Deliveries by the Ports</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>custom_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"City of Haacklee"</span> <span class="ot">=</span> <span class="st">"Haacklee"</span>, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of Himark"</span> <span class="ot">=</span> <span class="st">"Himark"</span>,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of Lomark"</span> <span class="ot">=</span> <span class="st">"Lomark"</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of Paackland"</span> <span class="ot">=</span> <span class="st">"Paackland"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of South Paackland"</span> <span class="ot">=</span> <span class="st">"S.Paackland"</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(delivery_reports, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> qty_tons)) <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure4"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Similar Range in terms of Qty at the different Ports"</span>,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Port"</span>,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Quantity in Tons"</span>) <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fish-species-not-found-in-fishing-grounds-but-delivered-at-the-ports" class="level3">
<h3 class="anchored" data-anchor-id="fish-species-not-found-in-fishing-grounds-but-delivered-at-the-ports">4.4.2 Fish Species not found in Fishing Grounds but Delivered at the Ports</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of port and fish type</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>delivery_summary <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(delivery_summary, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> num_deliveries)) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Adjust alpha for transparency if needed</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sockfish, Salmon, Offidiaa and Helenaa are found at the Ports"</span>,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Deliveries"</span>) <span class="sc">+</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the graph, we identified that <strong>Sockfish, Salmon, Offidiaa and Helenaa</strong> are found at the various ports. These are fishes that are not found in the fishing grounds, so identifying the vessels that offload these cargoes can help to narrow down IUU fishing.</p>
</section>
<section id="monthly-delivery-trend-by-fish-types" class="level3">
<h3 class="anchored" data-anchor-id="monthly-delivery-trend-by-fish-types">4.4.3 Monthly Delivery Trend by Fish Types</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract month from the date</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of month and fish type</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean deliveries per fish type</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>mean_deliveries <span class="ot">&lt;-</span> monthly_summary <span class="sc">%&gt;%</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_deliveries =</span> <span class="fu">mean</span>(num_deliveries))</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the highest delivery per fish type</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>max_deliveries <span class="ot">&lt;-</span> monthly_summary <span class="sc">%&gt;%</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_deliveries <span class="sc">==</span> <span class="fu">max</span>(num_deliveries))</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the summary data to add the mean delivery to each row</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> monthly_summary <span class="sc">%&gt;%</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_deliveries, <span class="at">by =</span> <span class="st">"fishtype"</span>)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the monthly delivery</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_summary, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> num_deliveries, <span class="at">color =</span> fishtype)) <span class="sc">+</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Line plot for monthly trend</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Add points for each month</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cod has the highest number of deliveries"</span>,</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Deliveries"</span>,</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"The four illegal fish species are delivered in certain months only"</span>,</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Fish Type"</span>) <span class="sc">+</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> max_deliveries, <span class="fu">aes</span>(<span class="at">label =</span> num_deliveries), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> fishtype)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>filtered_summary <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype, port) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>filtered_summary <span class="ot">&lt;-</span> filtered_summary <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fishtype <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sockfish"</span>, <span class="st">"Salmon"</span>, <span class="st">"Offidiaa"</span>, <span class="st">"Helenaa"</span>))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total deliveries across all ports for each month</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>total_deliveries <span class="ot">&lt;-</span> filtered_summary <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_deliveries =</span> <span class="fu">sum</span>(num_deliveries)) <span class="sc">%&gt;%</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">port =</span> <span class="st">"Total"</span>)  </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the filtered summary data with the total deliveries</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>combined_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(filtered_summary, total_deliveries)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the monthly delivery</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_summary, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> num_deliveries, <span class="at">color =</span> fishtype)) <span class="sc">+</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Line plot for monthly trend</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Add points for each month</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Paackland and Himark saw high delivery of the four fish species"</span>,</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Deliveries"</span>,</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Salmon is mostly delivered through Haacklee and Paackland"</span>,</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Fish Type"</span>) <span class="sc">+</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%b"</span>, <span class="at">limits =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2035-02-01"</span>, <span class="st">"2035-11-31"</span>))) <span class="sc">+</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> combined_summary, <span class="fu">aes</span>(<span class="at">label =</span> num_deliveries), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> port)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="merging-the-catch-summary-data-with-delivery-reports" class="level2">
<h2 class="anchored" data-anchor-id="merging-the-catch-summary-data-with-delivery-reports">4.5 Merging the Catch Summary Data with Delivery Reports</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> harbor_summary <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(possible_catches) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"possible_catches"</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">"port"</span> <span class="ot">=</span> <span class="st">"end_port"</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"vessel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vessel_list, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"fishid"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, name.y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Clean up the summary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>final_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (name.x, port, time_into_port, time_exit_port, type, flag_country, tonnage, company, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"name.x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> final_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delivery_reports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"port"</span>, <span class="st">"fishtype"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> time_into_port <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">&amp;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>         date <span class="sc">&lt;=</span> time_exit_port <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cargo =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(id), <span class="fu">as.character</span>(id), <span class="st">"N"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>summary_cargo <span class="ot">&lt;-</span> matched_data <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>summary_cargo_unique <span class="ot">&lt;-</span> summary_cargo <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count<span class="sc">==</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="visualising" class="level1">
<h1>5. Visualising</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of port and fish type</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>match_summary <span class="ot">&lt;-</span> matched_data <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(match_summary, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> num_deliveries)) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Adjust alpha for transparency if needed</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Delivery of the 4 illegal species are not matched fully"</span>,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Perhaps the transponder is off when such deliveries are made"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Deliveries"</span>) <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="match-with-harbor-records-instead" class="level2">
<h2 class="anchored" data-anchor-id="match-with-harbor-records-instead">5.1 Match with Harbor Records Instead</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>matched_data_harbor <span class="ot">&lt;-</span> harbor_records <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delivery_reports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"port"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> date_added  <span class="sc">&amp;</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>           date <span class="sc">&lt;=</span> date_added <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>summary_cargo <span class="ot">&lt;-</span> matched_data_harbor <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>summary_cargo_unique <span class="ot">&lt;-</span> summary_cargo <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count<span class="sc">==</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of port and fish type</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>match_summary <span class="ot">&lt;-</span> matched_data_harbor <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(match_summary, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> num_deliveries)) <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Adjust alpha for transparency if needed</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"More records matched, with 1613 unique matches"</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Matching with the harbor records only could be more accurate"</span>,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Deliveries"</span>) <span class="sc">+</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> matched_data_harbor <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vessel, id) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vessel) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(id))</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create nodes for the network graph</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">unique</span>(<span class="fu">c</span>(edges<span class="sc">$</span>vessel, edges<span class="sc">$</span>id)))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create igraph object</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> edges, <span class="at">vertices =</span> nodes, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Trying to plot using network graphs - but this is a mess - need to tidy up!</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the network graph</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(graph, <span class="at">layout =</span> <span class="st">"fr"</span>) <span class="sc">+</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">start_cap =</span> <span class="fu">label_rect</span>(node1.name), <span class="at">end_cap =</span> <span class="fu">label_rect</span>(node2.name)), <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"mm"</span>)), <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> name <span class="sc">%in%</span> edges<span class="sc">$</span>vessel), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Network Graph of Vessels and Linked Cargo"</span>) <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="qn-2---illegal-activities-for-southseafood-express-corp-sec" class="level1">
<h1>6. Qn 2 - Illegal Activities for SouthSeafood Express Corp (SEC)</h1>
<section id="identify-vessels-belonging-to-sec" class="level2">
<h2 class="anchored" data-anchor-id="identify-vessels-belonging-to-sec">6.1 Identify Vessels belonging to SEC</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>SEC_vessel <span class="ot">&lt;-</span> vessel_list <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (company <span class="sc">==</span> <span class="st">"SouthSeafood Express Corp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We found only 2 vessels linked to SEC:</p>
<ul>
<li><p>Snapper Snatcher (snappersnatcher7be)- a small 100 ton vessel</p></li>
<li><p>Roach Robber (roachrobberdb6)- a 11700 ton bigger vessel</p></li>
</ul>
</section>
<section id="introducing-the-geospatial-data-to-help-in-visualising" class="level2">
<h2 class="anchored" data-anchor-id="introducing-the-geospatial-data-to-help-in-visualising">6.2 Introducing the Geospatial Data to help in visualising</h2>
<p>Importing the geographical data in geojson file format</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>OceanusGeography <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"data/OceanusGeography.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `OceanusGeography' from data source 
  `C:\zjjgithubb\ISSS608VA\TakehomeEx\ex03\data\OceanusGeography.geojson' 
  using driver `GeoJSON'
Simple feature collection with 29 features and 7 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -167.0654 ymin: 38.07452 xmax: -163.2723 ymax: 40.67775
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>Visualising the geojson:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(OceanusGeography, <span class="st">"data/rds/OceanusGeography.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="importing-geographical-data-in-esri-shapefile-format" class="level2">
<h2 class="anchored" data-anchor-id="importing-geographical-data-in-esri-shapefile-format">6.3 <strong>Importing Geographical Data in ESRI shapefile format</strong></h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>OceanusLocations <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/shp"</span>,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">layer =</span> <span class="st">"Oceanus Geography"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Oceanus Geography' from data source 
  `C:\zjjgithubb\ISSS608VA\TakehomeEx\ex03\data\shp' using driver `ESRI Shapefile'
Simple feature collection with 27 features and 7 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -167.0654 ymin: 38.07452 xmax: -163.2723 ymax: 40.67775
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> OceanusLocations) <span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(OceanusLocations, <span class="st">"data/rds/OceanusLocations.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-prep-for-vessel-movement-data" class="level2">
<h2 class="anchored" data-anchor-id="data-prep-for-vessel-movement-data">6.4 Data Prep for Vessel Movement Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(event3 <span class="sc">==</span> <span class="st">"TransponderPing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, dwell, source, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(vessel_movement_data<span class="sc">$</span>source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "City of Haacklee"        "City of Lomark"         
 [3] "City of Himark"          "City of Paackland"      
 [5] "City of South Paackland" "City of Port Grove"     
 [7] "Exit West"               "Nav 3"                  
 [9] "Nav D"                   "Nav B"                  
[11] "Nav A"                   "Nav C"                  
[13] "Nav 2"                   "Nav 1"                  
[15] "Exit East"               "Exit South"             
[17] "Exit North"              "Nav E"                  
[19] "Cod Table"               "Ghoti Preserve"         
[21] "Wrasse Beds"             "Nemo Reef"              
[23] "Don Limpet Preserve"     "Tuna Shelf"             </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(OceanusLocations<span class="sc">$</span>Name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Haacklee"            "Port Grove"          "Lomark"             
 [4] "Himark"              "Paackland"           "Centralia"          
 [7] "South Paackland"     "Exit West"           "Nav 3"              
[10] "Nav D"               "Nav B"               "Nav A"              
[13] "Nav C"               "Nav 2"               "Nav 1"              
[16] "Exit East"           "Exit South"          "Exit North"         
[19] "Nav E"               "Don Limpet Preserve" "Tuna Shelf"         
[22] "Makara Shoal"        "Silent Sanctuary"    "Cod Table"          
[25] "Ghoti Preserve"      "Wrasse Beds"         "Nemo Reef"          </code></pre>
</div>
</div>
<p>We note that the vessel movement data’s name of the location did not match the OceanusLocations. So we need to match.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> vessel_movement_data<span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">gsub</span>(<span class="st">"^City of"</span>, <span class="st">""</span>, source)) <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">gsub</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">""</span>, source))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(OceanusLocations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df <span class="ot">&lt;-</span> OceanusLocations <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df<span class="sc">$</span>XCOORD <span class="ot">&lt;-</span> coords[, <span class="st">"X"</span>]</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df<span class="sc">$</span>YCOORD <span class="ot">&lt;-</span> coords[, <span class="st">"Y"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df <span class="ot">&lt;-</span> OceanusLocations_df <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, X.Kind, XCOORD, YCOORD) <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Loc_Type =</span> X.Kind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> vessel_movement_data <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(OceanusLocations_df,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span> <span class="ot">=</span> <span class="st">"Name"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(vessel_movement_data, <span class="st">"data/rds/vessel_movement_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualising-the-trajectories-of-snappy-snatcher-and-roach-robber" class="level2">
<h2 class="anchored" data-anchor-id="visualising-the-trajectories-of-snappy-snatcher-and-roach-robber">6.5 Visualising the Trajectories of Snappy Snatcher and Roach Robber</h2>
<section id="transforming-the-vessel-movement-data-to-a-path" class="level3">
<h3 class="anchored" data-anchor-id="transforming-the-vessel-movement-data-to-a-path">6.5.1 Transforming the vessel movement data to a path</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/vessel_movement_data.rds"</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>OceanusGeography <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/OceanusGeography.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>vessel_movement_sf <span class="ot">&lt;-</span> vessel_movement_data <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"XCOORD"</span>, <span class="st">"YCOORD"</span>), </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>vessel_movement_sf <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(target, time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>vessel_trajectory <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_selected <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"snappersnatcher7be"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculating-the-dwell-time-mins-at-each-point" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-dwell-time-mins-at-each-point">6.5.2 Calculating the Dwell Time (mins) at each point</h3>
<p>For now, we will look at the total amount of time that each vessel has spent at each location. We will sum the dwell time (converted to mins) at each location.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>points_data <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"snappersnatcher7be"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data) <span class="ot">&lt;-</span> points_data<span class="sc">$</span>geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Subsequently, it will be richer if we are able to plot the data by months. This would help us better visualise and compare the movement of the vessels.</p>
</section>
<section id="path-of-snapper-snatcher-and-roach-robber" class="level3">
<h3 class="anchored" data-anchor-id="path-of-snapper-snatcher-and-roach-robber">6.5.3 Path of Snapper Snatcher and Roach Robber</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_robber <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"roachrobberdb6"</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>points_data_robber <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"roachrobberdb6"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_robber) <span class="ot">&lt;-</span> points_data_robber<span class="sc">$</span>geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_selected, </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data, </span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"lavender"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Snapper Snatcher spent substantial time within Ghouti Preserve"</span>, </span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_robber, </span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_robber, </span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"lavender"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Roach Robber spent time mostly at Himark, Wrasse Beds and Nav C"</span>, </span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-SECVesselsPath" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SECVesselsPath-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-SECVesselsPath" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-SECVesselsPath-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-SECVesselsPath-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="takehomeex3_files/figure-html/fig-SECVesselsPath-1.png" class="img-fluid figure-img" data-ref-parent="fig-SECVesselsPath" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-SECVesselsPath-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Path of Snapper Snatcher
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-SECVesselsPath" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-SECVesselsPath-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-SECVesselsPath-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="takehomeex3_files/figure-html/fig-SECVesselsPath-2.png" class="img-fluid figure-img" data-ref-parent="fig-SECVesselsPath" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-SECVesselsPath-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Patch of Roach Robber
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SECVesselsPath-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Snapper Snatcher lingered in Ghoti Preserve
</figcaption>
</figure>
</div>
<p>Snapper Snatcher also <strong>spent time at Exit East - they are likely to engage in Deep Sea Fishing</strong> there (activities tied to the Exit Areas). This is also likely where they can fish for Salmon (assumption) - given that Salmon was not found in the other fishing grounds.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>combined_path <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(vessel_trajectory_selected, vessel_trajectory_robber)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>points_data_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(points_data, points_data_robber)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>wrapped_subtitle <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(<span class="st">"Transhipment could have occured at these locations"</span>, <span class="at">width =</span> <span class="dv">60</span>)</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> combined_path, <span class="fu">aes</span>(<span class="at">color =</span> target), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Path"</span>, </span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"snappersnatcher7be"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"roachrobberdb6"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_combined, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">size =</span> dwell_time), </span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  </span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span></span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Common Points at Lomark, Wrasse Beds and Nav C"</span>, </span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> wrapped_subtitle, </span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="when-and-where-did-the-illegal-fishing-took-place" class="level3">
<h3 class="anchored" data-anchor-id="when-and-where-did-the-illegal-fishing-took-place">6.5.4 When and Where did the illegal fishing took place?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>SEC_catches <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (vessel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Snapper Snatcher"</span>, <span class="st">"Roach Robber"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>SEC_catch_summary <span class="ot">&lt;-</span> SEC_catches <span class="sc">%&gt;%</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fishtype_count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>SEC_catch_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  vessel           fishtype fishtype_count
  &lt;chr&gt;            &lt;chr&gt;             &lt;int&gt;
1 Roach Robber     Beauvoir             22
2 Roach Robber     Birdseye             22
3 Roach Robber     Wrasse               22
4 Snapper Snatcher Beauvoir             18
5 Snapper Snatcher Birdseye             18
6 Snapper Snatcher Cod                  16
7 Snapper Snatcher Helenaa               4
8 Snapper Snatcher Offidiaa              4
9 Snapper Snatcher Wrasse               12</code></pre>
</div>
</div>
<p>From the table above, we would notice that because Snapper Snatcher spent time in the <strong>Ghoti Preserve</strong>, it would like have caught species like <strong>Helenaa and Offidiaa</strong> which are species that are found in the preserve only. These data is collated based on the vessel’s transponder ping location.</p>
<p>Next we will try to find out when did such fishing took place based on the transponder data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the location and vessel of interest</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>location_of_interest <span class="ot">&lt;-</span> <span class="st">"Ghoti Preserve"</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>vessel_of_interest <span class="ot">&lt;-</span> <span class="st">"Snapper Snatcher"</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the specific location and vessel</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>trespassing_dates <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> location_of_interest, vessel <span class="sc">==</span> vessel_of_interest) <span class="sc">%&gt;%</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, month, day) </span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trespassing_dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
# Groups:   vessel, location [1]
  vessel           location       time                month day  
  &lt;chr&gt;            &lt;chr&gt;          &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt;
1 Snapper Snatcher Ghoti Preserve 2035-02-02 05:39:59     2 Fri  
2 Snapper Snatcher Ghoti Preserve 2035-02-09 05:49:11     2 Fri  
3 Snapper Snatcher Ghoti Preserve 2035-02-16 07:02:09     2 Fri  
4 Snapper Snatcher Ghoti Preserve 2035-03-15 05:46:02     3 Thu  </code></pre>
</div>
</div>
<p>We note from the data that the activities took place in <strong>Feb and Mar</strong> - however, this did not correspond to any cargo delivery reports from the earlier data.</p>
<p>We will also check the other vessels that spent time in Ghoti Preserve.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>other_trespassers <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">"Ghoti Preserve"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vessel, time, month, day, stay_duration, location) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_vessels =</span> <span class="fu">n_distinct</span>(vessel),</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_stay_duration =</span> <span class="fu">mean</span>(stay_duration<span class="sc">/</span><span class="dv">360</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_summary, <span class="fu">aes</span>(<span class="at">x =</span> month)) <span class="sc">+</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> unique_vessels), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>) <span class="sc">+</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_stay_duration <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"lightpink"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Scale mean stay duration for visibility</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_stay_duration <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Add points for mean stay duration</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Number of Unique Vessels"</span>,</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Mean Stay Duration (hours)"</span>)  <span class="co"># Adjust secondary axis scale</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Trespass into Ghouti Preserve"</span>,</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Unique Vessels"</span>) <span class="sc">+</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-115-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month and day to Date object</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>other_trespassers <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">month =</span> <span class="fu">month</span>(time, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>other_trespassers <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">stay_duration =</span> stay_duration<span class="sc">/</span><span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the boxplot</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(other_trespassers, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Box plot of Duration in Ghoti Preserve"</span>,</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins)"</span>,</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Mean time spent dropped in Apr to Jul; Increased from Aug to Nov"</span>) <span class="sc">+</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-117-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the charts, I postulate that after Snapper Snatcher was caught in May, the other vessels chose to spend lesser time in Ghoti Preserve, but their time in the Preserve subsequently picked up again from Aug onwards. This corresponds to the delivery pattern of <strong>Helenaa and Offidiaa</strong>, where their deliveries started to increase from Sep onwards. That said - we may also need to note the species habitual patterns and whether are they present in Ghoti Preserve during these months. (Tried to google these species, but seems like they are fictitious).</p>
</section>
<section id="other-vessels-movement-path" class="level3">
<h3 class="anchored" data-anchor-id="other-vessels-movement-path">6.5.6 Other Vessels Movement Path</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_carp <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"carpcapturer993"</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>points_data_carp <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"carpcapturer993"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_carp) <span class="ot">&lt;-</span> points_data_carp<span class="sc">$</span>geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_carp, </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_carp, </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"lavender"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Carp Capturer spent time at Himark, Wrasse Beds and Nav C"</span>, </span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Dwell Time at Nav C seems high - can investigate further"</span>, </span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-119-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Carp Capturer seems like a fishing vessel that engages only in legal fishing activities, with no time spent in the reserves and mostly shuttling between the ports, navigation lines and the fishing grounds.</p>
</section>
</section>
</section>
<section id="qn-3---workflow-to-discover-other-illegal-fishing" class="level1">
<h1>7. Qn 3 - Workflow to discover other illegal fishing</h1>
<p>We have earlier identified that vessels <strong>spending time in the reserve areas</strong> could be suspected of illegal fishing, and <strong>spending extra time at Nav C</strong> could also be indicators of transshipment activities.</p>
<p>We can first look at those vessels spending time at Ghoti Preserve and first look at vessels spending more time than the mean time by Snapper Snatcher (around 77 mins).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>ghoti_trespassers <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel, month) <span class="sc">%&gt;%</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_stay_duration =</span> <span class="fu">mean</span>(stay_duration))</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the vessels based on the 75th percentile</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>top_vessels <span class="ot">&lt;-</span> ghoti_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel) <span class="sc">%&gt;%</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean_stay_duration <span class="sc">&gt;=</span> <span class="dv">77</span>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>top_vessels <span class="ot">&lt;-</span> top_vessels <span class="sc">%&gt;%</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(month, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">mean_stay_duration =</span> <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_vessels, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> vessel, <span class="at">fill =</span> mean_stay_duration)) <span class="sc">+</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"lightblue"</span>, <span class="at">high =</span> <span class="st">"deepskyblue4"</span>, <span class="at">na.value =</span> <span class="st">"ghostwhite"</span>) <span class="sc">+</span>  <span class="co"># Adjust colors as needed</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heatmap of Vessels in Ghoti Preserve by Month"</span>,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Vessel"</span>,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Mean Stay(mins)"</span>,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"To identify key vessels of interest - e.g. Gurnard Grabber"</span>) <span class="sc">+</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="plot-the-path-of-gurnard-grabber" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-path-of-gurnard-grabber">7.1 Plot the Path of Gurnard Grabber</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_gurnard <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"gurnardgrabberd9a"</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>points_data_gurnard <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"gurnardgrabberd9a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_gurnard) <span class="ot">&lt;-</span> points_data_gurnard<span class="sc">$</span>geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_gurnard, </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_gurnard, </span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"mediumpurple1"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gurnard Grabber - at Ghoti Preserve, Nav points and Exit East"</span>, </span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Dwell Time at these areas seem high - can investigate further"</span>, </span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>gurnard <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vessel <span class="sc">==</span> <span class="st">"Gurnard Grabber"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gurnard, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">fill =</span> <span class="st">"azure4"</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(stay_duration, <span class="dv">2</span>)), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Add labels above the bars</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gurnard Grabber's stay in Ghoti Preserve"</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Stay Duration"</span>,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Long duration in Oct corresponds to higher deliveries in Ports"</span>, </span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span> (<span class="dv">0</span>,<span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-125-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="investigate-vessels-from-the-same-company" class="level2">
<h2 class="anchored" data-anchor-id="investigate-vessels-from-the-same-company">7.2 Investigate vessels from the same company</h2>
<p>After plotting the path, we can investigate further based on the vessels from the same company, e.g.&nbsp;in this case <strong>Schmidt Ltd</strong>, with another vessel, <strong>Black Bullhead Bandit</strong> (blackbullheadbandit801), similarly by plotting the paths, can checking the dwell times of the vessels at the suspected areas.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_bandit <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"blackbullheadbandit801"</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>points_data_bandit <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"blackbullheadbandit801"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_bandit) <span class="ot">&lt;-</span> points_data_bandit<span class="sc">$</span>geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>combined_path_gb <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(vessel_trajectory_gurnard, vessel_trajectory_bandit)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>points_data_gb <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(points_data_gurnard, points_data_bandit)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>wrapped_subtitle <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(<span class="st">"Transshipment could have occured at these locations"</span>, <span class="at">width =</span> <span class="dv">60</span>)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> combined_path_gb, <span class="fu">aes</span>(<span class="at">color =</span> target), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Path"</span>, </span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"gurnardgrabberd9a"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"blackbullheadbandit801"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_gb, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">size =</span> dwell_time), </span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  </span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Common Points at East of Oceanus"</span>, </span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> wrapped_subtitle, </span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="takehomeex3_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="references" class="level1">
<h1>8. References</h1>
<p>Refer to the kickstarter provided for by Dr T.S. Kam:</p>
<ul>
<li><p><a href="https://isss608-ay2023-24apr.netlify.app/vast/kickstarter2">Kickstarter 2: Working with Graph Data</a></p></li>
<li><p><a href="https://isss608-ay2023-24apr.netlify.app/vast/kickstarter3">Kickstarter 3: Working with Geographic Data</a></p></li>
<li><p><a href="https://stopillegalfishing.com/publications/transhipment-issues-and-responses-in-the-fcwc-region/#:~:text=Transhipment%3A%20Issues%20and%20Responses%20in%20the%20FCWC%20Region%20aims%20to,and%20the%20trade%20in%20fish.">Transhipment: Issues and Responses in the FCWC Region</a></p></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb143" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Take Home Ex 3"</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Cheng Chun Chieh"</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "18 May 2024"</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "last-modified"</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true</span></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: true</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a><span class="co"> </span></span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># 1. Overview</span></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>In Oceanus, island life is defined by the coming and going of seafaring vessels, many of which are operated by commercial fishing companies. Typically, the movement of ships and goods are a sign of Oceanus’s healthy economy, especially in the fishing business. But mundane routines can be disrupted by a major event. Analysts at FishEye International, a non-profit organization that aims to find and prevent illegal fishing, need your help to better understand one such event.</span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>FishEye has learned that SouthSeafood Express Corp has been caught fishing illegally. The scandal caused a major disruption in the close-knit fishing community. FishEye has been collecting data on ship movements and shipping records in hopes that they could assemble a cohesive store of knowledge that will allow them to better understand local commercial fishing behavior. FishEye processed open-source and commercial vessel tracking and shipping records into CatchNet: the Oceanus Knowledge Graph. Analysts examine and correct data as it is loaded but need your help to create analytical capabilities for this data.</span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a>FishEye analysts need your help to perform geographic and temporal analysis of the CatchNet data so they can prevent illegal fishing from happening again. Your task is to develop new visual analytics tools and workflows that can be used to discover and understand signatures of different types of behavior. Can you use your tool to visualize a signature of SouthSeafood Express Corp’s illegal behavior? FishEye needs your help to develop a workflow to find other instances of illegal behavior.</span>
<span id="cb143-29"><a href="#cb143-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-30"><a href="#cb143-30" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>FishEye analysts have long wanted to better understand the flow of commercially caught fish through Oceanus’s many ports. But as they were loading data into CatchNet, they discovered they had purchased the wrong port records. They wanted to get the ship off-load records, but they instead got the port-exit records (essentially trucks/trains leaving the port area). Port exit records do not include which vessel that delivered the products. Given this limitation, develop a visualization system to associate vessels with their probable cargos. Which vessels deliver which products and when? What are the seasonal trends and anomalies in the port exit records?</span>
<span id="cb143-31"><a href="#cb143-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-32"><a href="#cb143-32" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Develop visualizations that illustrate the inappropriate behavior of SouthSeafood Express Corp vessels. How do their movement and catch contents compare to other fishing vessels? When and where did SouthSeafood Express Corp vessels perform their illegal fishing? How many different types of suspicious behaviors are observed? Use visual evidence to justify your conclusions.</span>
<span id="cb143-33"><a href="#cb143-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-34"><a href="#cb143-34" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>To support further Fisheye investigations, develop visual analytics workflows that allow you to discover other vessels engaging in behaviors similar to SouthSeafood Express Corp’s illegal activities? Provide visual evidence of the similarities.</span>
<span id="cb143-35"><a href="#cb143-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-36"><a href="#cb143-36" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>How did fishing activity change after SouthSeafood Express Corp was caught? What new behaviors in the Oceanus commercial fishing community are most suspicious and why?</span>
<span id="cb143-37"><a href="#cb143-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-38"><a href="#cb143-38" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb143-39"><a href="#cb143-39" aria-hidden="true" tabindex="-1"></a>For this Take-home Ex 3 - I will be focusing on Qn 1 and 2 first. If time is available, I will also attempt to go in to Qn 3.</span>
<span id="cb143-40"><a href="#cb143-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-41"><a href="#cb143-41" aria-hidden="true" tabindex="-1"></a>To note that we will subsequently package these as part of our project.</span>
<span id="cb143-42"><a href="#cb143-42" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb143-43"><a href="#cb143-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-44"><a href="#cb143-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.1 Loading Packages</span></span>
<span id="cb143-45"><a href="#cb143-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-46"><a href="#cb143-46" aria-hidden="true" tabindex="-1"></a>Because the data are given in a json file format - we will have to load it using jsonlite. The following are the packages that we will be using for this ex.</span>
<span id="cb143-47"><a href="#cb143-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-50"><a href="#cb143-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-51"><a href="#cb143-51" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(jsonlite, tidygraph, igraph, ggraph, visNetwork, graphlayouts, ggforce, skimr, tidytext, tidyverse, plotly, shiny, DT, sf)</span>
<span id="cb143-52"><a href="#cb143-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-53"><a href="#cb143-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-54"><a href="#cb143-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.2 Data Provided by the Challenge</span></span>
<span id="cb143-55"><a href="#cb143-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-56"><a href="#cb143-56" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.2.1 Geography Data of Oceanus</span></span>
<span id="cb143-57"><a href="#cb143-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-58"><a href="#cb143-58" aria-hidden="true" tabindex="-1"></a><span class="al">![](data/Oceanus%20Geography.png)</span></span>
<span id="cb143-59"><a href="#cb143-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-60"><a href="#cb143-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.2.2 Graph Data</span></span>
<span id="cb143-61"><a href="#cb143-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-62"><a href="#cb143-62" aria-hidden="true" tabindex="-1"></a>The following is the graph data provided:</span>
<span id="cb143-63"><a href="#cb143-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-64"><a href="#cb143-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Directed multi-graph, allowing multiple edges between nodes</span>
<span id="cb143-65"><a href="#cb143-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-66"><a href="#cb143-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>5637 nodes</span>
<span id="cb143-67"><a href="#cb143-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-68"><a href="#cb143-68" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>271752 edges</span>
<span id="cb143-69"><a href="#cb143-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-70"><a href="#cb143-70" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1 (weakly) connected component</span>
<span id="cb143-71"><a href="#cb143-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-72"><a href="#cb143-72" aria-hidden="true" tabindex="-1"></a>Which covers:</span>
<span id="cb143-73"><a href="#cb143-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-74"><a href="#cb143-74" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Vessel Movements:** Oceanus is outfitted with a transponder/ping system named the Oceanus Vessel Locator System (OVLS).&nbsp; Vessels are outfitted with a transponder and periodic 'pings' from base-stations results in a report of vessel locations at any time.&nbsp; The raw ping granularity is at the minute-level but post-processing has converted it into visit/dwell times. OVLS is generally reliable, though vessel records may be missing for a variety of reasons.</span>
<span id="cb143-75"><a href="#cb143-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-76"><a href="#cb143-76" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Node/Edge types and properties present</span>
<span id="cb143-77"><a href="#cb143-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-78"><a href="#cb143-78" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.Vessel: Description of the vessel</span>
<span id="cb143-79"><a href="#cb143-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-80"><a href="#cb143-80" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.Location: Description of a geographic location</span>
<span id="cb143-81"><a href="#cb143-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-82"><a href="#cb143-82" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Event.TransponderPing: Links a vessel to a location</span>
<span id="cb143-83"><a href="#cb143-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-84"><a href="#cb143-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Harbor Reports:** Harbor masters regularly report the vessels found in their purview anytime during the day.&nbsp; This data is derived from a different system than OVLS (see "Vessel Movements"), though the data overlaps.&nbsp; Harbor Reports are provided on a different schedule from different harbors. Since no harbor reports every day, this data has lower temporal granularity than vessel movement data. Additionally, the Harbor Master is also responsible for proximate navigational beacon(s), so this data has lower spatial granularity as well.&nbsp; However, the list of vessels observed is considered canonical.</span>
<span id="cb143-85"><a href="#cb143-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-86"><a href="#cb143-86" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Node/edge types present:</span>
<span id="cb143-87"><a href="#cb143-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-88"><a href="#cb143-88" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.Vessel</span>
<span id="cb143-89"><a href="#cb143-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-90"><a href="#cb143-90" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.location</span>
<span id="cb143-91"><a href="#cb143-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-92"><a href="#cb143-92" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Event.HarborReport</span>
<span id="cb143-93"><a href="#cb143-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-94"><a href="#cb143-94" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Harbor Import Records**: Vessels deliver cargo to the ports, and that cargo is brought into Oceanus.&nbsp; These records reflect the goods that <span class="sc">\*</span>leave<span class="sc">\*</span> the harbor to go to businesses in Oceanus or to be exported.&nbsp; It was filtered pre-ingest to focus on the delivery of raw fish.&nbsp; Because it is raw, fish leave the port quickly (generally one day after delivery).&nbsp; Due to clerical error, the records purchased by FishEye do not include the vessel that delivered the cargo.</span>
<span id="cb143-95"><a href="#cb143-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-96"><a href="#cb143-96" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Node/Edge types present:</span>
<span id="cb143-97"><a href="#cb143-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-98"><a href="#cb143-98" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.location</span>
<span id="cb143-99"><a href="#cb143-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-100"><a href="#cb143-100" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.Commodity.Fish</span>
<span id="cb143-101"><a href="#cb143-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-102"><a href="#cb143-102" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Entity.Document.DeliveryReport</span>
<span id="cb143-103"><a href="#cb143-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-104"><a href="#cb143-104" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Event.Transaction</span>
<span id="cb143-105"><a href="#cb143-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-106"><a href="#cb143-106" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.3 Importing the Data</span></span>
<span id="cb143-107"><a href="#cb143-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-108"><a href="#cb143-108" aria-hidden="true" tabindex="-1"></a>We will use jsonlite to import the data:</span>
<span id="cb143-109"><a href="#cb143-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-112"><a href="#cb143-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-113"><a href="#cb143-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-114"><a href="#cb143-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-115"><a href="#cb143-115" aria-hidden="true" tabindex="-1"></a>mc2_data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span> (<span class="st">"data/mc2.json"</span>)</span>
<span id="cb143-116"><a href="#cb143-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-117"><a href="#cb143-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-118"><a href="#cb143-118" aria-hidden="true" tabindex="-1"></a>Importing the nodes and edges as tibble data</span>
<span id="cb143-119"><a href="#cb143-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-122"><a href="#cb143-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-123"><a href="#cb143-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-124"><a href="#cb143-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-125"><a href="#cb143-125" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span></span>
<span id="cb143-126"><a href="#cb143-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(mc2_data<span class="sc">$</span>links) <span class="sc">%&gt;%</span></span>
<span id="cb143-127"><a href="#cb143-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb143-128"><a href="#cb143-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-129"><a href="#cb143-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-132"><a href="#cb143-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-133"><a href="#cb143-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-134"><a href="#cb143-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-135"><a href="#cb143-135" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span></span>
<span id="cb143-136"><a href="#cb143-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(mc2_data<span class="sc">$</span>nodes) <span class="sc">%&gt;%</span></span>
<span id="cb143-137"><a href="#cb143-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb143-138"><a href="#cb143-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-139"><a href="#cb143-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-140"><a href="#cb143-140" aria-hidden="true" tabindex="-1"></a><span class="fu"># 2. Tidying the Data</span></span>
<span id="cb143-141"><a href="#cb143-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-142"><a href="#cb143-142" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2.1 Looking at the Nodes</span></span>
<span id="cb143-143"><a href="#cb143-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-144"><a href="#cb143-144" aria-hidden="true" tabindex="-1"></a>We first look at the types of nodes and how many of each are present in the data set:</span>
<span id="cb143-145"><a href="#cb143-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-148"><a href="#cb143-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-149"><a href="#cb143-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-150"><a href="#cb143-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-151"><a href="#cb143-151" aria-hidden="true" tabindex="-1"></a>type_counts_nodes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span> <span class="fu">count</span>(type)</span>
<span id="cb143-152"><a href="#cb143-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-153"><a href="#cb143-153" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts_nodes)</span>
<span id="cb143-154"><a href="#cb143-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-155"><a href="#cb143-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-156"><a href="#cb143-156" aria-hidden="true" tabindex="-1"></a>Of note we have:</span>
<span id="cb143-157"><a href="#cb143-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-158"><a href="#cb143-158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>5307 Delivery Reports</span>
<span id="cb143-159"><a href="#cb143-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-160"><a href="#cb143-160" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>178 Fishing Vessel and 100 Cargo Vessels</span>
<span id="cb143-161"><a href="#cb143-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-162"><a href="#cb143-162" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>10 Types of Fish</span>
<span id="cb143-163"><a href="#cb143-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-164"><a href="#cb143-164" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2.1.1 Tidying the Text</span></span>
<span id="cb143-165"><a href="#cb143-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-166"><a href="#cb143-166" aria-hidden="true" tabindex="-1"></a>From the table above, beside the date data type and inappropriate field name issues we discussed earlier, two additional data issues can be observed. They are:</span>
<span id="cb143-167"><a href="#cb143-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-168"><a href="#cb143-168" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The values in Activities and fish_species_present fields are in **list** data type, which will affect the ability to process and to analyse the data.</span>
<span id="cb143-169"><a href="#cb143-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-170"><a href="#cb143-170" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As shown in the screenshot below, some values in the Activities field are not ready to be analyse without further tidying (i.e.&nbsp;removing c(““)).</span>
<span id="cb143-171"><a href="#cb143-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-172"><a href="#cb143-172" aria-hidden="true" tabindex="-1"></a>In the code chunk below,&nbsp;<span class="in">`mutate()`</span>&nbsp;of dplyr and&nbsp;<span class="in">`gsub()`</span>&nbsp;of Base R are used to perform the data todying task.</span>
<span id="cb143-173"><a href="#cb143-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-176"><a href="#cb143-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-177"><a href="#cb143-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-178"><a href="#cb143-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-179"><a href="#cb143-179" aria-hidden="true" tabindex="-1"></a>mc2_nodes_tidied <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-180"><a href="#cb143-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Activities =</span> <span class="fu">gsub</span>(<span class="st">"c[(]"</span>, <span class="st">""</span>, Activities)) <span class="sc">%&gt;%</span> </span>
<span id="cb143-181"><a href="#cb143-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Activities =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>, Activities)) <span class="sc">%&gt;%</span></span>
<span id="cb143-182"><a href="#cb143-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Activities =</span> <span class="fu">gsub</span>(<span class="st">"[)]"</span>, <span class="st">""</span>, Activities)) </span>
<span id="cb143-183"><a href="#cb143-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-184"><a href="#cb143-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-187"><a href="#cb143-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-188"><a href="#cb143-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-189"><a href="#cb143-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-190"><a href="#cb143-190" aria-hidden="true" tabindex="-1"></a>mc2_nodes_tidied <span class="ot">&lt;-</span> mc2_nodes_tidied <span class="sc">%&gt;%</span></span>
<span id="cb143-191"><a href="#cb143-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">gsub</span>(<span class="st">"c[(]"</span>, <span class="st">""</span>, fish_species_present)) <span class="sc">%&gt;%</span> </span>
<span id="cb143-192"><a href="#cb143-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, <span class="st">""</span>, fish_species_present)) <span class="sc">%&gt;%</span></span>
<span id="cb143-193"><a href="#cb143-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">gsub</span>(<span class="st">"[)]"</span>, <span class="st">""</span>, fish_species_present)) </span>
<span id="cb143-194"><a href="#cb143-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-195"><a href="#cb143-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-198"><a href="#cb143-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-199"><a href="#cb143-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-200"><a href="#cb143-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-201"><a href="#cb143-201" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mc2_nodes_tidied, <span class="st">"data/rds/mc2_nodes_tidied.rds"</span>)</span>
<span id="cb143-202"><a href="#cb143-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-203"><a href="#cb143-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-204"><a href="#cb143-204" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2.2 Looking at the Edges</span></span>
<span id="cb143-205"><a href="#cb143-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-208"><a href="#cb143-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-209"><a href="#cb143-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-210"><a href="#cb143-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-211"><a href="#cb143-211" aria-hidden="true" tabindex="-1"></a>type_counts_edges <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span> <span class="fu">count</span>(type)</span>
<span id="cb143-212"><a href="#cb143-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-213"><a href="#cb143-213" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts_edges)</span>
<span id="cb143-214"><a href="#cb143-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-215"><a href="#cb143-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-216"><a href="#cb143-216" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2.2.1 Correcting date data type</span></span>
<span id="cb143-217"><a href="#cb143-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-218"><a href="#cb143-218" aria-hidden="true" tabindex="-1"></a>The date format is not easily readable - so we need to convert them into something useful.</span>
<span id="cb143-219"><a href="#cb143-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-222"><a href="#cb143-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-223"><a href="#cb143-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-224"><a href="#cb143-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-225"><a href="#cb143-225" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(mc2_edges<span class="sc">$</span>time)</span>
<span id="cb143-226"><a href="#cb143-226" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span><span class="st">"_last_edited_date"</span> <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(mc2_edges<span class="sc">$</span><span class="st">"_last_edited_date"</span>)</span>
<span id="cb143-227"><a href="#cb143-227" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span><span class="st">"_date_added"</span> <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(mc2_edges<span class="sc">$</span><span class="st">"_date_added"</span>)</span>
<span id="cb143-228"><a href="#cb143-228" aria-hidden="true" tabindex="-1"></a>mc2_edges<span class="sc">$</span><span class="st">"date"</span> <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(<span class="st">"mc2_edges$date"</span>)</span>
<span id="cb143-229"><a href="#cb143-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-230"><a href="#cb143-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-233"><a href="#cb143-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-234"><a href="#cb143-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-235"><a href="#cb143-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-236"><a href="#cb143-236" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mc2_edges)</span>
<span id="cb143-237"><a href="#cb143-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-238"><a href="#cb143-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-239"><a href="#cb143-239" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2.2.2 Changing the field names</span></span>
<span id="cb143-240"><a href="#cb143-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-243"><a href="#cb143-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-244"><a href="#cb143-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-245"><a href="#cb143-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-246"><a href="#cb143-246" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-247"><a href="#cb143-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"last_edited_by"</span> <span class="ot">=</span> <span class="st">"_last_edited_by"</span>,</span>
<span id="cb143-248"><a href="#cb143-248" aria-hidden="true" tabindex="-1"></a>         <span class="st">"date_added"</span> <span class="ot">=</span> <span class="st">"_date_added"</span>,</span>
<span id="cb143-249"><a href="#cb143-249" aria-hidden="true" tabindex="-1"></a>         <span class="st">"last_edited_date"</span> <span class="ot">=</span> <span class="st">"_last_edited_date"</span>,</span>
<span id="cb143-250"><a href="#cb143-250" aria-hidden="true" tabindex="-1"></a>         <span class="st">"raw_source"</span> <span class="ot">=</span> <span class="st">"_raw_source"</span>,</span>
<span id="cb143-251"><a href="#cb143-251" aria-hidden="true" tabindex="-1"></a>         <span class="st">"algo"</span> <span class="ot">=</span> <span class="st">"_algorithm"</span>) </span>
<span id="cb143-252"><a href="#cb143-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-253"><a href="#cb143-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-254"><a href="#cb143-254" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2.2.3 Splitting the Text under Type</span></span>
<span id="cb143-255"><a href="#cb143-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-258"><a href="#cb143-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-259"><a href="#cb143-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-260"><a href="#cb143-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-261"><a href="#cb143-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-262"><a href="#cb143-262" aria-hidden="true" tabindex="-1"></a>word_list <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(mc2_edges<span class="sc">$</span>type, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb143-263"><a href="#cb143-263" aria-hidden="true" tabindex="-1"></a>max_elements <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">lengths</span>(word_list))</span>
<span id="cb143-264"><a href="#cb143-264" aria-hidden="true" tabindex="-1"></a>word_list_padded <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word_list, </span>
<span id="cb143-265"><a href="#cb143-265" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">c</span>(x, <span class="fu">rep</span>(<span class="cn">NA</span>, max_elements <span class="sc">-</span> <span class="fu">length</span>(x))))</span>
<span id="cb143-266"><a href="#cb143-266" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, word_list_padded)</span>
<span id="cb143-267"><a href="#cb143-267" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(word_df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"event"</span>, <span class="dv">1</span><span class="sc">:</span>max_elements)</span>
<span id="cb143-268"><a href="#cb143-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-269"><a href="#cb143-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-272"><a href="#cb143-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-273"><a href="#cb143-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-274"><a href="#cb143-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-275"><a href="#cb143-275" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(word_df) <span class="sc">%&gt;%</span></span>
<span id="cb143-276"><a href="#cb143-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(event2, event3)</span>
<span id="cb143-277"><a href="#cb143-277" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(word_df)</span>
<span id="cb143-278"><a href="#cb143-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-279"><a href="#cb143-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-282"><a href="#cb143-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-283"><a href="#cb143-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-284"><a href="#cb143-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-285"><a href="#cb143-285" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-286"><a href="#cb143-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(word_df)</span>
<span id="cb143-287"><a href="#cb143-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-288"><a href="#cb143-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-291"><a href="#cb143-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-292"><a href="#cb143-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb143-293"><a href="#cb143-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-294"><a href="#cb143-294" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mc2_edges, <span class="st">"data/rds/mc2_edges.rds"</span>)</span>
<span id="cb143-295"><a href="#cb143-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-296"><a href="#cb143-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-297"><a href="#cb143-297" aria-hidden="true" tabindex="-1"></a><span class="fu"># 3. Examining the data</span></span>
<span id="cb143-298"><a href="#cb143-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-299"><a href="#cb143-299" aria-hidden="true" tabindex="-1"></a>Loading the rds files:</span>
<span id="cb143-300"><a href="#cb143-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-303"><a href="#cb143-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-304"><a href="#cb143-304" aria-hidden="true" tabindex="-1"></a>mc2_edges <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/mc2_edges.rds"</span>)</span>
<span id="cb143-305"><a href="#cb143-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-306"><a href="#cb143-306" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/mc2_nodes_tidied.rds"</span>)</span>
<span id="cb143-307"><a href="#cb143-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-308"><a href="#cb143-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-309"><a href="#cb143-309" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.1 Nodes Data</span></span>
<span id="cb143-310"><a href="#cb143-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-311"><a href="#cb143-311" aria-hidden="true" tabindex="-1"></a>From the nodes data, we have the following information:</span>
<span id="cb143-312"><a href="#cb143-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-315"><a href="#cb143-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-316"><a href="#cb143-316" aria-hidden="true" tabindex="-1"></a>type_counts <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-317"><a href="#cb143-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb143-318"><a href="#cb143-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb143-319"><a href="#cb143-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-320"><a href="#cb143-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb143-321"><a href="#cb143-321" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts)</span>
<span id="cb143-322"><a href="#cb143-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-323"><a href="#cb143-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-324"><a href="#cb143-324" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-325"><a href="#cb143-325" aria-hidden="true" tabindex="-1"></a>| Data            | Description                                  | Remarks                                                                                                                                 |</span>
<span id="cb143-326"><a href="#cb143-326" aria-hidden="true" tabindex="-1"></a>+=================+==============================================+=========================================================================================================================================+</span>
<span id="cb143-327"><a href="#cb143-327" aria-hidden="true" tabindex="-1"></a>| Fish            | 10 Species of Fish                           | Key fields are the:                                                                                                                     |</span>
<span id="cb143-328"><a href="#cb143-328" aria-hidden="true" tabindex="-1"></a>|                 |                                              |                                                                                                                                         |</span>
<span id="cb143-329"><a href="#cb143-329" aria-hidden="true" tabindex="-1"></a>|                 |                                              | <span class="in">`name`</span> and <span class="in">`id`</span>                                                                                                                         |</span>
<span id="cb143-330"><a href="#cb143-330" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-331"><a href="#cb143-331" aria-hidden="true" tabindex="-1"></a>| Location        | Contains Point, City and Region              | Contains the <span class="in">`Name`</span> and id of the location - key field is the <span class="in">`id`</span>                                                                      |</span>
<span id="cb143-332"><a href="#cb143-332" aria-hidden="true" tabindex="-1"></a>|                 |                                              |                                                                                                                                         |</span>
<span id="cb143-333"><a href="#cb143-333" aria-hidden="true" tabindex="-1"></a>|                 |                                              | <span class="in">`fish_species_present`</span> is only listed for the region. Only 3 region for commercial fishing - **Cod Table, Tuna Shelf and Wrasse Beds**. |</span>
<span id="cb143-334"><a href="#cb143-334" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-335"><a href="#cb143-335" aria-hidden="true" tabindex="-1"></a>| Delivery Report | 5307 Delivery Report                         | Contains the <span class="in">`id`</span> tied to the cargo id.                                                                                                 |</span>
<span id="cb143-336"><a href="#cb143-336" aria-hidden="true" tabindex="-1"></a>|                 |                                              |                                                                                                                                         |</span>
<span id="cb143-337"><a href="#cb143-337" aria-hidden="true" tabindex="-1"></a>|                 |                                              | Also contains the qty by tons (<span class="in">`qty_tons`</span>) and the date of the delivery (<span class="in">`date`</span>).                                                       |</span>
<span id="cb143-338"><a href="#cb143-338" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-339"><a href="#cb143-339" aria-hidden="true" tabindex="-1"></a>| Fishing Vessel  | 178 Fishing Vessel                           | Contains the <span class="in">`Name`</span> and id of the vessel. We can use <span class="in">`id`</span> to identify the vessels.                                                      |</span>
<span id="cb143-340"><a href="#cb143-340" aria-hidden="true" tabindex="-1"></a>|                 |                                              |                                                                                                                                         |</span>
<span id="cb143-341"><a href="#cb143-341" aria-hidden="true" tabindex="-1"></a>|                 |                                              | Other info includes: <span class="in">`flag_country`</span>, <span class="in">`company`</span>, <span class="in">`tonnage`</span>, <span class="in">`length_overall`</span>,                                                            |</span>
<span id="cb143-342"><a href="#cb143-342" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-343"><a href="#cb143-343" aria-hidden="true" tabindex="-1"></a>| Cargo Vessel    | 100 Cargo Vessels                            | To explore given that these vessels can be used for transshipment or IUU activities.                                                    |</span>
<span id="cb143-344"><a href="#cb143-344" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-345"><a href="#cb143-345" aria-hidden="true" tabindex="-1"></a>| Other Vessels   | Such as Passenger, Research, Tour and Others | KIV - but dont think needed for our analysis                                                                                            |</span>
<span id="cb143-346"><a href="#cb143-346" aria-hidden="true" tabindex="-1"></a>+-----------------+----------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-347"><a href="#cb143-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-348"><a href="#cb143-348" aria-hidden="true" tabindex="-1"></a>We noticed that there are two columns for the name - one with <span class="in">`name`</span> and the other with <span class="in">`Name`</span>. Let us try to combine them into one column for easier analysis:</span>
<span id="cb143-349"><a href="#cb143-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-352"><a href="#cb143-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-353"><a href="#cb143-353" aria-hidden="true" tabindex="-1"></a>overlaps <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-354"><a href="#cb143-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Name) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(name) <span class="sc">&amp;</span> <span class="fu">tolower</span>(Name) <span class="sc">==</span> <span class="fu">tolower</span>(name))</span>
<span id="cb143-355"><a href="#cb143-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-356"><a href="#cb143-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Print overlaps</span></span>
<span id="cb143-357"><a href="#cb143-357" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Overlaps between 'Name' and 'name' columns:"</span>)</span>
<span id="cb143-358"><a href="#cb143-358" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlaps)</span>
<span id="cb143-359"><a href="#cb143-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-360"><a href="#cb143-360" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine columns into one named 'name'</span></span>
<span id="cb143-361"><a href="#cb143-361" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-362"><a href="#cb143-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(name), Name, name)) <span class="sc">%&gt;%</span></span>
<span id="cb143-363"><a href="#cb143-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Name)</span>
<span id="cb143-364"><a href="#cb143-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-365"><a href="#cb143-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-366"><a href="#cb143-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-367"><a href="#cb143-367" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.2 Splitting the text under type</span></span>
<span id="cb143-368"><a href="#cb143-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-369"><a href="#cb143-369" aria-hidden="true" tabindex="-1"></a>Like how we split the text for edges, we will do so for the nodes data.</span>
<span id="cb143-370"><a href="#cb143-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-373"><a href="#cb143-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-374"><a href="#cb143-374" aria-hidden="true" tabindex="-1"></a>word_list <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(mc2_nodes<span class="sc">$</span>type, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb143-375"><a href="#cb143-375" aria-hidden="true" tabindex="-1"></a>max_elements <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">lengths</span>(word_list))</span>
<span id="cb143-376"><a href="#cb143-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-377"><a href="#cb143-377" aria-hidden="true" tabindex="-1"></a>word_list_padded <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word_list, </span>
<span id="cb143-378"><a href="#cb143-378" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">c</span>(x, <span class="fu">rep</span>(<span class="cn">NA</span>, max_elements <span class="sc">-</span> <span class="fu">length</span>(x))))</span>
<span id="cb143-379"><a href="#cb143-379" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, word_list_padded)</span>
<span id="cb143-380"><a href="#cb143-380" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(word_df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"entity"</span>, <span class="dv">1</span><span class="sc">:</span>max_elements)</span>
<span id="cb143-381"><a href="#cb143-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-382"><a href="#cb143-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-385"><a href="#cb143-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-386"><a href="#cb143-386" aria-hidden="true" tabindex="-1"></a>word_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(word_df) <span class="sc">%&gt;%</span></span>
<span id="cb143-387"><a href="#cb143-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(entity2, entity3)</span>
<span id="cb143-388"><a href="#cb143-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-389"><a href="#cb143-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-392"><a href="#cb143-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-393"><a href="#cb143-393" aria-hidden="true" tabindex="-1"></a>mc2_nodes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-394"><a href="#cb143-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(word_df)</span>
<span id="cb143-395"><a href="#cb143-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-396"><a href="#cb143-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-397"><a href="#cb143-397" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.3 Filter out the Species in Region</span></span>
<span id="cb143-398"><a href="#cb143-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-401"><a href="#cb143-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-402"><a href="#cb143-402" aria-hidden="true" tabindex="-1"></a>fish_species_df <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-403"><a href="#cb143-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity3 <span class="sc">==</span> <span class="st">'Region'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-404"><a href="#cb143-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, fish_species_present)</span>
<span id="cb143-405"><a href="#cb143-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-406"><a href="#cb143-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-409"><a href="#cb143-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-410"><a href="#cb143-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the fish_species_present column into a long format data frame for plotting</span></span>
<span id="cb143-411"><a href="#cb143-411" aria-hidden="true" tabindex="-1"></a>long_fish_species_df <span class="ot">&lt;-</span> fish_species_df <span class="sc">%&gt;%</span></span>
<span id="cb143-412"><a href="#cb143-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(fish_species_present, <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-413"><a href="#cb143-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fish_species_present =</span> <span class="fu">str_trim</span>(fish_species_present)) <span class="sc">%&gt;%</span></span>
<span id="cb143-414"><a href="#cb143-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region =</span> name, <span class="at">fish_species =</span> fish_species_present)</span>
<span id="cb143-415"><a href="#cb143-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-416"><a href="#cb143-416" aria-hidden="true" tabindex="-1"></a>reserve_only_species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Sockfish/Pisces foetida'</span>, <span class="st">'Offidiaa/Piscis osseus'</span>, <span class="st">'Helenaa/Pisces satis'</span>)  <span class="co"># Example reserve-only species</span></span>
<span id="cb143-417"><a href="#cb143-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-418"><a href="#cb143-418" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column to indicate if a fish species is reserve-only</span></span>
<span id="cb143-419"><a href="#cb143-419" aria-hidden="true" tabindex="-1"></a>long_fish_species_df <span class="ot">&lt;-</span> long_fish_species_df <span class="sc">%&gt;%</span></span>
<span id="cb143-420"><a href="#cb143-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reserve_only =</span> <span class="fu">ifelse</span>(fish_species <span class="sc">%in%</span> reserve_only_species, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-421"><a href="#cb143-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, fish_species))</span>
<span id="cb143-422"><a href="#cb143-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-423"><a href="#cb143-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-424"><a href="#cb143-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-425"><a href="#cb143-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-428"><a href="#cb143-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-429"><a href="#cb143-429" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(long_fish_species_df, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> reserve_only)) <span class="sc">+</span></span>
<span id="cb143-430"><a href="#cb143-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb143-431"><a href="#cb143-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb143-432"><a href="#cb143-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fish Species Present in Different Regions"</span>, </span>
<span id="cb143-433"><a href="#cb143-433" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Salmon is not found in the Regions"</span>,</span>
<span id="cb143-434"><a href="#cb143-434" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span></span>
<span id="cb143-435"><a href="#cb143-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-436"><a href="#cb143-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb143-437"><a href="#cb143-437" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb143-438"><a href="#cb143-438" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb143-439"><a href="#cb143-439" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb143-440"><a href="#cb143-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-441"><a href="#cb143-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-442"><a href="#cb143-442" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.4 Edges Data</span></span>
<span id="cb143-443"><a href="#cb143-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-446"><a href="#cb143-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-447"><a href="#cb143-447" aria-hidden="true" tabindex="-1"></a>type_counts <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-448"><a href="#cb143-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb143-449"><a href="#cb143-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb143-450"><a href="#cb143-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-451"><a href="#cb143-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb143-452"><a href="#cb143-452" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(type_counts)</span>
<span id="cb143-453"><a href="#cb143-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-454"><a href="#cb143-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-455"><a href="#cb143-455" aria-hidden="true" tabindex="-1"></a>We have 3 groups of data in the edges mainly the HarborReport, Transaction and the TransponderPing.</span>
<span id="cb143-456"><a href="#cb143-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-457"><a href="#cb143-457" aria-hidden="true" tabindex="-1"></a>+------------------+------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-458"><a href="#cb143-458" aria-hidden="true" tabindex="-1"></a>| Data             | Description                                                                                                | Remarks                                                                                                       |</span>
<span id="cb143-459"><a href="#cb143-459" aria-hidden="true" tabindex="-1"></a>+==================+============================================================================================================+===============================================================================================================+</span>
<span id="cb143-460"><a href="#cb143-460" aria-hidden="true" tabindex="-1"></a>| Harbor Reports   | Contains information about the vessel docking at which harbor.                                             | Key fields here are:                                                                                          |</span>
<span id="cb143-461"><a href="#cb143-461" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-462"><a href="#cb143-462" aria-hidden="true" tabindex="-1"></a>|                  | There is a key column, but not sure what it means.                                                         | <span class="in">`source`</span> which is tied to the <span class="in">`id`</span> of a vessel.                                                               |</span>
<span id="cb143-463"><a href="#cb143-463" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-464"><a href="#cb143-464" aria-hidden="true" tabindex="-1"></a>|                  | Contains a few other columns with aphorism, holiday greeting etc but seems not impt for our analysis here. | <span class="in">`target`</span> which is tied to the <span class="in">`name`</span> of the city.                                                             |</span>
<span id="cb143-465"><a href="#cb143-465" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-466"><a href="#cb143-466" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            | <span class="in">`date_added`</span> and <span class="in">`last_edited_date`</span> are the two key dates available                                           |</span>
<span id="cb143-467"><a href="#cb143-467" aria-hidden="true" tabindex="-1"></a>+------------------+------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-468"><a href="#cb143-468" aria-hidden="true" tabindex="-1"></a>| Transaction      | Information from OCEANS                                                                                    | Key fields here are:                                                                                          |</span>
<span id="cb143-469"><a href="#cb143-469" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-470"><a href="#cb143-470" aria-hidden="true" tabindex="-1"></a>|                  | Each transaction has two rows - one connecting the transaction to the City, the other to the fish species. | <span class="in">`source`</span> which is tied to the <span class="in">`id`</span> of a cargo.                                                                |</span>
<span id="cb143-471"><a href="#cb143-471" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-472"><a href="#cb143-472" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            | <span class="in">`target`</span> which is tied to the <span class="in">`name`</span> of the city and the <span class="in">`id`</span> of the fish.                                    |</span>
<span id="cb143-473"><a href="#cb143-473" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-474"><a href="#cb143-474" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            | <span class="in">`date_added`</span> and <span class="in">`last_edited_date`</span> are the two key dates available                                           |</span>
<span id="cb143-475"><a href="#cb143-475" aria-hidden="true" tabindex="-1"></a>+------------------+------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-476"><a href="#cb143-476" aria-hidden="true" tabindex="-1"></a>| Transponder Ping | Information from OVLS                                                                                      | Key fields here are:                                                                                          |</span>
<span id="cb143-477"><a href="#cb143-477" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-478"><a href="#cb143-478" aria-hidden="true" tabindex="-1"></a>|                  | Contains information about the time of ping, dwell time, and location.                                     | <span class="in">`source`</span> which is tied to the <span class="in">`name`</span>of a location.                                                            |</span>
<span id="cb143-479"><a href="#cb143-479" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-480"><a href="#cb143-480" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            | <span class="in">`target`</span> which is tied to the <span class="in">`id`</span> of the vessel.                                                             |</span>
<span id="cb143-481"><a href="#cb143-481" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            |                                                                                                               |</span>
<span id="cb143-482"><a href="#cb143-482" aria-hidden="true" tabindex="-1"></a>|                  |                                                                                                            | <span class="in">`time`</span>, <span class="in">`date_added`</span>and <span class="in">`last_edited_date`</span> are the three dates available - should be focusing on <span class="in">`time`</span> here. |</span>
<span id="cb143-483"><a href="#cb143-483" aria-hidden="true" tabindex="-1"></a>+------------------+------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------+</span>
<span id="cb143-484"><a href="#cb143-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-485"><a href="#cb143-485" aria-hidden="true" tabindex="-1"></a><span class="fu"># 4. Qn 1 - Associate Vessels with their Cargo</span></span>
<span id="cb143-486"><a href="#cb143-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-487"><a href="#cb143-487" aria-hidden="true" tabindex="-1"></a>We want to know which **vessel offload their cargo** at **which port** on **which date and time**.</span>
<span id="cb143-488"><a href="#cb143-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-489"><a href="#cb143-489" aria-hidden="true" tabindex="-1"></a>We can first utilised the harbor reports to find out which vessels have been to which harbor - this would give us an initial starting point. As the list of vessels observed is canonical (i.e. accurate) - this can help with our analysis later. However, we note that the date/time is not very accurate here.</span>
<span id="cb143-490"><a href="#cb143-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-491"><a href="#cb143-491" aria-hidden="true" tabindex="-1"></a>Next, we need to wrangle with the transponder data. We want to have a list of all the vessels, by their date/time, which date they visited a harbor and on which day they left a harbor.</span>
<span id="cb143-492"><a href="#cb143-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-493"><a href="#cb143-493" aria-hidden="true" tabindex="-1"></a>So based on the above data, we would generate a data frame with the different rows of date/time and list out in the columns - vessel, location_transponder (which port), within harbor report (yes or no).</span>
<span id="cb143-494"><a href="#cb143-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-495"><a href="#cb143-495" aria-hidden="true" tabindex="-1"></a>Next we will combine the transaction with the delivery report first. So we will be able to match the date of delivery, cargo_id, qty, fish, and which harbor.</span>
<span id="cb143-496"><a href="#cb143-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-497"><a href="#cb143-497" aria-hidden="true" tabindex="-1"></a>Then finally, we can combine the data based on the date that a vessel enter the port, and exit the port, the cargo during this time point.</span>
<span id="cb143-498"><a href="#cb143-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-499"><a href="#cb143-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.1 Visualising the Harbor Records</span></span>
<span id="cb143-500"><a href="#cb143-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-503"><a href="#cb143-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-504"><a href="#cb143-504" aria-hidden="true" tabindex="-1"></a>vessel_list <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-505"><a href="#cb143-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Entity.Vessel.FishingVessel"</span>, <span class="st">"Entity.Vessel.CargoVessel"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-506"><a href="#cb143-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(</span>
<span id="cb143-507"><a href="#cb143-507" aria-hidden="true" tabindex="-1"></a>    type <span class="sc">==</span> <span class="st">"Entity.Vessel.FishingVessel"</span> <span class="sc">~</span> <span class="st">"FishingVessel"</span>,</span>
<span id="cb143-508"><a href="#cb143-508" aria-hidden="true" tabindex="-1"></a>    type <span class="sc">==</span> <span class="st">"Entity.Vessel.CargoVessel"</span> <span class="sc">~</span> <span class="st">"CargoVessel"</span></span>
<span id="cb143-509"><a href="#cb143-509" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb143-510"><a href="#cb143-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(type, name, id, flag_country, tonnage, length_overall, company) <span class="sc">%&gt;%</span></span>
<span id="cb143-511"><a href="#cb143-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">vessel =</span> id)</span>
<span id="cb143-512"><a href="#cb143-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-513"><a href="#cb143-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-516"><a href="#cb143-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-517"><a href="#cb143-517" aria-hidden="true" tabindex="-1"></a>harbor_records <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-518"><a href="#cb143-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event.HarborReport"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-519"><a href="#cb143-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_added, last_edited_date, source, target) <span class="sc">%&gt;%</span></span>
<span id="cb143-520"><a href="#cb143-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"source"</span>,</span>
<span id="cb143-521"><a href="#cb143-521" aria-hidden="true" tabindex="-1"></a>         <span class="st">"port"</span> <span class="ot">=</span> <span class="st">"target"</span>) </span>
<span id="cb143-522"><a href="#cb143-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-523"><a href="#cb143-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-526"><a href="#cb143-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-527"><a href="#cb143-527" aria-hidden="true" tabindex="-1"></a>harbor_records <span class="ot">&lt;-</span> harbor_records <span class="sc">%&gt;%</span></span>
<span id="cb143-528"><a href="#cb143-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vessel_list, <span class="at">by =</span> <span class="st">"vessel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-529"><a href="#cb143-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(name) <span class="sc">&amp;</span> name <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb143-530"><a href="#cb143-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-531"><a href="#cb143-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-532"><a href="#cb143-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-535"><a href="#cb143-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-536"><a href="#cb143-536" aria-hidden="true" tabindex="-1"></a>visit_counts <span class="ot">&lt;-</span> harbor_records <span class="sc">%&gt;%</span></span>
<span id="cb143-537"><a href="#cb143-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date_added, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-538"><a href="#cb143-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, vessel, type, month) <span class="sc">%&gt;%</span></span>
<span id="cb143-539"><a href="#cb143-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">visit_count =</span> <span class="fu">n</span>(), </span>
<span id="cb143-540"><a href="#cb143-540" aria-hidden="true" tabindex="-1"></a>            <span class="at">visit_dates =</span> <span class="fu">paste</span>(date_added, <span class="at">collapse =</span> <span class="st">', '</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-541"><a href="#cb143-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb143-542"><a href="#cb143-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-543"><a href="#cb143-543" aria-hidden="true" tabindex="-1"></a>visits_fishing <span class="ot">&lt;-</span> visit_counts <span class="sc">%&gt;%</span></span>
<span id="cb143-544"><a href="#cb143-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"FishingVessel"</span>)</span>
<span id="cb143-545"><a href="#cb143-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-546"><a href="#cb143-546" aria-hidden="true" tabindex="-1"></a>visits_fishing <span class="ot">&lt;-</span> visits_fishing <span class="sc">%&gt;%</span></span>
<span id="cb143-547"><a href="#cb143-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(month, port, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">visit_count =</span> <span class="cn">NA</span>))</span>
<span id="cb143-548"><a href="#cb143-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-549"><a href="#cb143-549" aria-hidden="true" tabindex="-1"></a>visits_cargo <span class="ot">&lt;-</span> visit_counts <span class="sc">%&gt;%</span></span>
<span id="cb143-550"><a href="#cb143-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"CargoVessel"</span>)</span>
<span id="cb143-551"><a href="#cb143-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-552"><a href="#cb143-552" aria-hidden="true" tabindex="-1"></a>visits_cargo <span class="ot">&lt;-</span> visits_cargo <span class="sc">%&gt;%</span></span>
<span id="cb143-553"><a href="#cb143-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(month, port, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">visit_count =</span> <span class="cn">NA</span>))</span>
<span id="cb143-554"><a href="#cb143-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-555"><a href="#cb143-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-558"><a href="#cb143-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-559"><a href="#cb143-559" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-portvisits</span></span>
<span id="cb143-560"><a href="#cb143-560" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Both Fishing and Cargo Vessels frequent Paackland"</span></span>
<span id="cb143-561"><a href="#cb143-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb143-562"><a href="#cb143-562" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Port Visits by Fishing Vessels"</span></span>
<span id="cb143-563"><a href="#cb143-563" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Port Visits by Cargo Vessels"</span></span>
<span id="cb143-564"><a href="#cb143-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb143-565"><a href="#cb143-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-566"><a href="#cb143-566" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(visits_fishing, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> port, <span class="at">fill =</span> visit_count)) <span class="sc">+</span></span>
<span id="cb143-567"><a href="#cb143-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb143-568"><a href="#cb143-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"azure1"</span>, <span class="at">high =</span> <span class="st">"deepskyblue4"</span>, <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb143-569"><a href="#cb143-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Paackland and Haacklee more frequented by Fishing Vessels"</span>,</span>
<span id="cb143-570"><a href="#cb143-570" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-571"><a href="#cb143-571" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Port"</span>,</span>
<span id="cb143-572"><a href="#cb143-572" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on the Harbor Records"</span>,</span>
<span id="cb143-573"><a href="#cb143-573" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Number of Visits"</span>) <span class="sc">+</span></span>
<span id="cb143-574"><a href="#cb143-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-575"><a href="#cb143-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb143-576"><a href="#cb143-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-577"><a href="#cb143-577" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(visits_cargo, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> port, <span class="at">fill =</span> visit_count)) <span class="sc">+</span></span>
<span id="cb143-578"><a href="#cb143-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb143-579"><a href="#cb143-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"azure1"</span>, <span class="at">high =</span> <span class="st">"deepskyblue4"</span>, <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb143-580"><a href="#cb143-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Paackland and Lomark more frequented by Cargo Vessels"</span>,</span>
<span id="cb143-581"><a href="#cb143-581" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-582"><a href="#cb143-582" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Port"</span>,</span>
<span id="cb143-583"><a href="#cb143-583" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on the Harbor Records"</span>,</span>
<span id="cb143-584"><a href="#cb143-584" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Number of Visits"</span>) <span class="sc">+</span></span>
<span id="cb143-585"><a href="#cb143-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-586"><a href="#cb143-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb143-587"><a href="#cb143-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-588"><a href="#cb143-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-589"><a href="#cb143-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-590"><a href="#cb143-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-591"><a href="#cb143-591" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.2 Wrangling the Transponder Data</span></span>
<span id="cb143-592"><a href="#cb143-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-595"><a href="#cb143-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-596"><a href="#cb143-596" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-597"><a href="#cb143-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event.TransportEvent.TransponderPing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-598"><a href="#cb143-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, dwell, source, target) <span class="sc">%&gt;%</span></span>
<span id="cb143-599"><a href="#cb143-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"target"</span>)</span>
<span id="cb143-600"><a href="#cb143-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-601"><a href="#cb143-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-604"><a href="#cb143-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-605"><a href="#cb143-605" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting only the 'id' and 'vessel' columns from vessel_list</span></span>
<span id="cb143-606"><a href="#cb143-606" aria-hidden="true" tabindex="-1"></a>vessel_subset <span class="ot">&lt;-</span> vessel_list <span class="sc">%&gt;%</span> </span>
<span id="cb143-607"><a href="#cb143-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vessel, name, type) <span class="sc">%&gt;%</span></span>
<span id="cb143-608"><a href="#cb143-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="at">id =</span> vessel)</span>
<span id="cb143-609"><a href="#cb143-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-610"><a href="#cb143-610" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing left join on transponder and vessel_subset</span></span>
<span id="cb143-611"><a href="#cb143-611" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> <span class="fu">left_join</span>(transponder, vessel_subset, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb143-612"><a href="#cb143-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-613"><a href="#cb143-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering only those Cargo and Fishing Vessels</span></span>
<span id="cb143-614"><a href="#cb143-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-615"><a href="#cb143-615" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-616"><a href="#cb143-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type))</span>
<span id="cb143-617"><a href="#cb143-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-618"><a href="#cb143-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-619"><a href="#cb143-619" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2.1 Visualising the Transponder Data</span></span>
<span id="cb143-620"><a href="#cb143-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-621"><a href="#cb143-621" aria-hidden="true" tabindex="-1"></a>For us to better visualise the transponder data, we will split the data by months and also group it by the days of the week.</span>
<span id="cb143-622"><a href="#cb143-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-625"><a href="#cb143-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-626"><a href="#cb143-626" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-627"><a href="#cb143-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(time),</span>
<span id="cb143-628"><a href="#cb143-628" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">wday</span>(time, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb143-629"><a href="#cb143-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-630"><a href="#cb143-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-631"><a href="#cb143-631" aria-hidden="true" tabindex="-1"></a>We want to also indicate if the vessel was within a port or not.</span>
<span id="cb143-632"><a href="#cb143-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-635"><a href="#cb143-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-636"><a href="#cb143-636" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-637"><a href="#cb143-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> </span>
<span id="cb143-638"><a href="#cb143-638" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ifelse</span> (<span class="fu">grepl</span>(<span class="st">"^City of"</span>, source), <span class="st">"Ports"</span>, </span>
<span id="cb143-639"><a href="#cb143-639" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ifelse</span>(source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cod Table"</span>, <span class="st">"Tuna Shelf"</span>, <span class="st">"Wrasse Beds"</span>), <span class="st">"Fishing Grounds"</span>,</span>
<span id="cb143-640"><a href="#cb143-640" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^Nav"</span>, source), <span class="st">"Nav Areas"</span>,</span>
<span id="cb143-641"><a href="#cb143-641" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Don Limpet Preserve"</span>, <span class="st">"Nemo Reef"</span>, <span class="st">"Ghoti Preserve"</span>), <span class="st">"Reserves"</span>,</span>
<span id="cb143-642"><a href="#cb143-642" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^Exit"</span>, source), <span class="st">"Exit Areas"</span>,</span>
<span id="cb143-643"><a href="#cb143-643" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Unknown"</span>)))))) <span class="sc">%&gt;%</span></span>
<span id="cb143-644"><a href="#cb143-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"location"</span> <span class="ot">=</span> <span class="st">"source"</span>,</span>
<span id="cb143-645"><a href="#cb143-645" aria-hidden="true" tabindex="-1"></a>         <span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"name"</span>)</span>
<span id="cb143-646"><a href="#cb143-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-647"><a href="#cb143-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-650"><a href="#cb143-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-651"><a href="#cb143-651" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-652"><a href="#cb143-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vessel, time) <span class="sc">%&gt;%</span></span>
<span id="cb143-653"><a href="#cb143-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel, location) <span class="sc">%&gt;%</span></span>
<span id="cb143-654"><a href="#cb143-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb143-655"><a href="#cb143-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_start =</span> time,</span>
<span id="cb143-656"><a href="#cb143-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_end =</span> time <span class="sc">+</span> dwell,</span>
<span id="cb143-657"><a href="#cb143-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">stay_duration =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(stay_end, stay_start, <span class="at">units =</span> <span class="st">"mins"</span>))</span>
<span id="cb143-658"><a href="#cb143-658" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb143-659"><a href="#cb143-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-660"><a href="#cb143-660" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows where location is NA or stay_duration is NA or negative</span></span>
<span id="cb143-661"><a href="#cb143-661" aria-hidden="true" tabindex="-1"></a>transponder <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-662"><a href="#cb143-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(stay_duration) <span class="sc">&amp;</span> stay_duration <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb143-663"><a href="#cb143-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-664"><a href="#cb143-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-665"><a href="#cb143-665" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2.2 Looking at the areas that the vessels visited</span></span>
<span id="cb143-666"><a href="#cb143-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-669"><a href="#cb143-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-670"><a href="#cb143-670" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb143-671"><a href="#cb143-671" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transponder, <span class="fu">aes</span>(<span class="at">x =</span> area, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb143-672"><a href="#cb143-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb143-673"><a href="#cb143-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cargo Vessels should not linger in Fishing Grounds or Reserves"</span>,</span>
<span id="cb143-674"><a href="#cb143-674" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Location Type"</span>,</span>
<span id="cb143-675"><a href="#cb143-675" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb143-676"><a href="#cb143-676" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Vessel Type"</span>,</span>
<span id="cb143-677"><a href="#cb143-677" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Fishing Vessels were present in Reserves as well"</span>) <span class="sc">+</span></span>
<span id="cb143-678"><a href="#cb143-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"azure4"</span>, <span class="st">"lightskyblue4"</span>)) <span class="sc">+</span></span>
<span id="cb143-679"><a href="#cb143-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-680"><a href="#cb143-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-681"><a href="#cb143-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-682"><a href="#cb143-682" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2.3 Vessels within Reserve Areas</span></span>
<span id="cb143-683"><a href="#cb143-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-686"><a href="#cb143-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-687"><a href="#cb143-687" aria-hidden="true" tabindex="-1"></a>reserves_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-688"><a href="#cb143-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="st">"Reserves"</span>)</span>
<span id="cb143-689"><a href="#cb143-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-690"><a href="#cb143-690" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of unique vessels in the reserves area by vessel type</span></span>
<span id="cb143-691"><a href="#cb143-691" aria-hidden="true" tabindex="-1"></a>unique_vessels_count <span class="ot">&lt;-</span> reserves_data <span class="sc">%&gt;%</span></span>
<span id="cb143-692"><a href="#cb143-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb143-693"><a href="#cb143-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">unique_vessels =</span> <span class="fu">n_distinct</span>(vessel))</span>
<span id="cb143-694"><a href="#cb143-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-695"><a href="#cb143-695" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(reserves_data<span class="sc">$</span>stay_duration)</span>
<span id="cb143-696"><a href="#cb143-696" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(reserves_data<span class="sc">$</span>stay_duration)</span>
<span id="cb143-697"><a href="#cb143-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-698"><a href="#cb143-698" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a box plot of the dwell time in the reserves area</span></span>
<span id="cb143-699"><a href="#cb143-699" aria-hidden="true" tabindex="-1"></a>boxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reserves_data, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> stay_duration, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb143-700"><a href="#cb143-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure3"</span>, <span class="at">color =</span> <span class="st">"lightskyblue4"</span>, <span class="at">outlier.shape =</span> <span class="dv">16</span>, <span class="at">outlier.size =</span> <span class="dv">2</span>, <span class="at">outlier.colour =</span> <span class="st">"deepskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb143-701"><a href="#cb143-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"azure4"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add mean line</span></span>
<span id="cb143-702"><a href="#cb143-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median_value, <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-703"><a href="#cb143-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Many Instances of Fishing Vessel Overspending Time in Reserves"</span>,</span>
<span id="cb143-704"><a href="#cb143-704" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-705"><a href="#cb143-705" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins) - Log Scale"</span>,</span>
<span id="cb143-706"><a href="#cb143-706" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"71 Cargo Vessels and 131 Fishing Vessels spent time in Reserves"</span>) <span class="sc">+</span></span>
<span id="cb143-707"><a href="#cb143-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb143-708"><a href="#cb143-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-709"><a href="#cb143-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-710"><a href="#cb143-710" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of unique vessels in the reserves area</span></span>
<span id="cb143-711"><a href="#cb143-711" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_vessels_count)</span>
<span id="cb143-712"><a href="#cb143-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-713"><a href="#cb143-713" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the box plot</span></span>
<span id="cb143-714"><a href="#cb143-714" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(boxplot)</span>
<span id="cb143-715"><a href="#cb143-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-716"><a href="#cb143-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-717"><a href="#cb143-717" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2.4 Cargo Vessels within Fishing Grounds</span></span>
<span id="cb143-718"><a href="#cb143-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-721"><a href="#cb143-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-722"><a href="#cb143-722" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for cargo vessels in fishing grounds</span></span>
<span id="cb143-723"><a href="#cb143-723" aria-hidden="true" tabindex="-1"></a>cargo_fishing_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-724"><a href="#cb143-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"CargoVessel"</span> <span class="sc">&amp;</span> area <span class="sc">==</span> <span class="st">"Fishing Grounds"</span>)</span>
<span id="cb143-725"><a href="#cb143-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-726"><a href="#cb143-726" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and median values</span></span>
<span id="cb143-727"><a href="#cb143-727" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(cargo_fishing_data<span class="sc">$</span>stay_duration)</span>
<span id="cb143-728"><a href="#cb143-728" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(cargo_fishing_data<span class="sc">$</span>stay_duration)</span>
<span id="cb143-729"><a href="#cb143-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-730"><a href="#cb143-730" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a box plot of the dwell time for cargo vessels in fishing grounds</span></span>
<span id="cb143-731"><a href="#cb143-731" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cargo_fishing_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb143-732"><a href="#cb143-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure3"</span>, <span class="at">color =</span> <span class="st">"lightskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb143-733"><a href="#cb143-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"azure4"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add mean line</span></span>
<span id="cb143-734"><a href="#cb143-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median_value, <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb143-735"><a href="#cb143-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb143-736"><a href="#cb143-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cargo Vessels spending more time in Fishing Grounds"</span>,</span>
<span id="cb143-737"><a href="#cb143-737" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-738"><a href="#cb143-738" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (min) (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb143-739"><a href="#cb143-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-740"><a href="#cb143-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-741"><a href="#cb143-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-742"><a href="#cb143-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-745"><a href="#cb143-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-746"><a href="#cb143-746" aria-hidden="true" tabindex="-1"></a>vessels_above_mean <span class="ot">&lt;-</span> cargo_fishing_data <span class="sc">%&gt;%</span></span>
<span id="cb143-747"><a href="#cb143-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stay_duration <span class="sc">&gt;</span> mean_value)</span>
<span id="cb143-748"><a href="#cb143-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-749"><a href="#cb143-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of unique vessels</span></span>
<span id="cb143-750"><a href="#cb143-750" aria-hidden="true" tabindex="-1"></a>num_vessels_above_mean <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(vessels_above_mean<span class="sc">$</span>vessel)</span>
<span id="cb143-751"><a href="#cb143-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-752"><a href="#cb143-752" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the count</span></span>
<span id="cb143-753"><a href="#cb143-753" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_vessels_above_mean)</span>
<span id="cb143-754"><a href="#cb143-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-755"><a href="#cb143-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-756"><a href="#cb143-756" aria-hidden="true" tabindex="-1"></a>Notice that there is only 1 Cargo Vessel which stays in the fishing grounds above the mean duration - **Nautical Nomad** (**Tuna Shelf and Wrasse Beds**).</span>
<span id="cb143-757"><a href="#cb143-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-758"><a href="#cb143-758" aria-hidden="true" tabindex="-1"></a>Why is this out of the norm? Typical cargo vessels could have only just transited across the fishing grounds, but if the cargo vessel stays beyond the transit time, they could be involved in illegal fishing activities, e.g. transshipment at sea as shown in the photo below.</span>
<span id="cb143-759"><a href="#cb143-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-760"><a href="#cb143-760" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/clipboard-2365353441.png)</span>{width="495"}</span>
<span id="cb143-761"><a href="#cb143-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-764"><a href="#cb143-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-765"><a href="#cb143-765" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(transponder, <span class="fu">aes</span>(<span class="at">x =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb143-766"><a href="#cb143-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb143-767"><a href="#cb143-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span> (<span class="dv">0</span>, <span class="dv">5000</span>) <span class="sc">+</span></span>
<span id="cb143-768"><a href="#cb143-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Stay Duration is typically about 100 mins"</span>, <span class="at">x =</span> <span class="st">"Stay Duration (mins)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)<span class="sc">+</span></span>
<span id="cb143-769"><a href="#cb143-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-770"><a href="#cb143-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-771"><a href="#cb143-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-772"><a href="#cb143-772" aria-hidden="true" tabindex="-1"></a>We will notice that there are vessels with dwell time = 0. This is so for the first row of data for each vessel, where it seems to initialise the starting of the location tracking of each vessel. However, there are also other times, where the dwell time was 0. Thinking that this could due to the vessel passing by the Port or could have traveled within the vicinity.</span>
<span id="cb143-773"><a href="#cb143-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-776"><a href="#cb143-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-777"><a href="#cb143-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-reservesvisits</span></span>
<span id="cb143-778"><a href="#cb143-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Vessels entering Reserves and their Stay Duration"</span></span>
<span id="cb143-779"><a href="#cb143-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb143-780"><a href="#cb143-780" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Number of Unique Vessels entering the Reserves"</span></span>
<span id="cb143-781"><a href="#cb143-781" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Stay Duration (mins) of the Vessels"</span></span>
<span id="cb143-782"><a href="#cb143-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb143-783"><a href="#cb143-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-784"><a href="#cb143-784" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize data to get the number of unique vessels in each reserve area</span></span>
<span id="cb143-785"><a href="#cb143-785" aria-hidden="true" tabindex="-1"></a>vessels_reserve <span class="ot">&lt;-</span> reserves_data <span class="sc">%&gt;%</span></span>
<span id="cb143-786"><a href="#cb143-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location) <span class="sc">%&gt;%</span></span>
<span id="cb143-787"><a href="#cb143-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">unique_vessel_count =</span> <span class="fu">n_distinct</span>(vessel))</span>
<span id="cb143-788"><a href="#cb143-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-789"><a href="#cb143-789" aria-hidden="true" tabindex="-1"></a>reserves_data <span class="ot">&lt;-</span> reserves_data <span class="sc">%&gt;%</span></span>
<span id="cb143-790"><a href="#cb143-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">stay_duration_min =</span> stay_duration<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-791"><a href="#cb143-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-792"><a href="#cb143-792" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart showing the number of unique vessels in different reserve areas</span></span>
<span id="cb143-793"><a href="#cb143-793" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vessels_reserve, <span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> unique_vessel_count)) <span class="sc">+</span></span>
<span id="cb143-794"><a href="#cb143-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>) <span class="sc">+</span></span>
<span id="cb143-795"><a href="#cb143-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nemo Reef saw the most vessels entering the reserve"</span>,</span>
<span id="cb143-796"><a href="#cb143-796" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Reserve Area"</span>,</span>
<span id="cb143-797"><a href="#cb143-797" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Unique Vessels"</span>) <span class="sc">+</span></span>
<span id="cb143-798"><a href="#cb143-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> unique_vessel_count), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb143-799"><a href="#cb143-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-800"><a href="#cb143-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-801"><a href="#cb143-801" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of stay_duration in different reserve areas</span></span>
<span id="cb143-802"><a href="#cb143-802" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(reserves_data, <span class="fu">aes</span>(<span class="at">x =</span> location, <span class="at">y =</span> stay_duration_min)) <span class="sc">+</span></span>
<span id="cb143-803"><a href="#cb143-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightskyblue3"</span>) <span class="sc">+</span></span>
<span id="cb143-804"><a href="#cb143-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"But Ghoti Preserve saw longer stay duration"</span>,</span>
<span id="cb143-805"><a href="#cb143-805" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Reserve Area"</span>,</span>
<span id="cb143-806"><a href="#cb143-806" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins)"</span>) <span class="sc">+</span></span>
<span id="cb143-807"><a href="#cb143-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-808"><a href="#cb143-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-809"><a href="#cb143-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-810"><a href="#cb143-810" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.2.5 Vessels' Stay Duration at the Ports</span></span>
<span id="cb143-811"><a href="#cb143-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-814"><a href="#cb143-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-815"><a href="#cb143-815" aria-hidden="true" tabindex="-1"></a>port_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-816"><a href="#cb143-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="st">"Ports"</span>)</span>
<span id="cb143-817"><a href="#cb143-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-818"><a href="#cb143-818" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(port_data<span class="sc">$</span>stay_duration)</span>
<span id="cb143-819"><a href="#cb143-819" aria-hidden="true" tabindex="-1"></a>median_value <span class="ot">&lt;-</span> <span class="fu">median</span>(port_data<span class="sc">$</span>stay_duration)</span>
<span id="cb143-820"><a href="#cb143-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-821"><a href="#cb143-821" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a box plot of the dwell time in the reserves area</span></span>
<span id="cb143-822"><a href="#cb143-822" aria-hidden="true" tabindex="-1"></a>boxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(port_data, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> stay_duration, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb143-823"><a href="#cb143-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure3"</span>, <span class="at">color =</span> <span class="st">"lightskyblue4"</span>, <span class="at">outlier.shape =</span> <span class="dv">16</span>, <span class="at">outlier.size =</span> <span class="dv">2</span>, <span class="at">outlier.colour =</span> <span class="st">"deepskyblue4"</span>) <span class="sc">+</span></span>
<span id="cb143-824"><a href="#cb143-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_value, <span class="at">color =</span> <span class="st">"azure4"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add mean line</span></span>
<span id="cb143-825"><a href="#cb143-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median_value, <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-826"><a href="#cb143-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cargo Vessels spend less time at ports as compared to Fishing Vessels"</span>,</span>
<span id="cb143-827"><a href="#cb143-827" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-828"><a href="#cb143-828" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins) - Log Scale"</span>,</span>
<span id="cb143-829"><a href="#cb143-829" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Average Time: 1985mins ; Median Time: 1675mins"</span>) <span class="sc">+</span></span>
<span id="cb143-830"><a href="#cb143-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb143-831"><a href="#cb143-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-832"><a href="#cb143-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-833"><a href="#cb143-833" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the box plot</span></span>
<span id="cb143-834"><a href="#cb143-834" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(boxplot)</span>
<span id="cb143-835"><a href="#cb143-835" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-836"><a href="#cb143-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-837"><a href="#cb143-837" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.3 Finding out the catches within the Vessel</span></span>
<span id="cb143-838"><a href="#cb143-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-841"><a href="#cb143-841" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-842"><a href="#cb143-842" aria-hidden="true" tabindex="-1"></a>fishes <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-843"><a href="#cb143-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Entity.Commodity.Fish"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-844"><a href="#cb143-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"name"</span>, <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-845"><a href="#cb143-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"fishid"</span> <span class="ot">=</span> <span class="st">"id"</span>)</span>
<span id="cb143-846"><a href="#cb143-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-847"><a href="#cb143-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-850"><a href="#cb143-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-851"><a href="#cb143-851" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-852"><a href="#cb143-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Entity.Location.Region"</span>)</span>
<span id="cb143-853"><a href="#cb143-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-854"><a href="#cb143-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-857"><a href="#cb143-857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-858"><a href="#cb143-858" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> region <span class="sc">%&gt;%</span></span>
<span id="cb143-859"><a href="#cb143-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(fish_species_present, <span class="at">sep =</span> <span class="st">",</span><span class="sc">\\</span><span class="st">s*"</span>) </span>
<span id="cb143-860"><a href="#cb143-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-861"><a href="#cb143-861" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-862"><a href="#cb143-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-865"><a href="#cb143-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-866"><a href="#cb143-866" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> region <span class="sc">%&gt;%</span></span>
<span id="cb143-867"><a href="#cb143-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fish_species_present"</span> <span class="ot">=</span> <span class="st">"name"</span>))</span>
<span id="cb143-868"><a href="#cb143-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-869"><a href="#cb143-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-872"><a href="#cb143-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-873"><a href="#cb143-873" aria-hidden="true" tabindex="-1"></a>possible_catches <span class="ot">&lt;-</span> region <span class="sc">%&gt;%</span></span>
<span id="cb143-874"><a href="#cb143-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb143-875"><a href="#cb143-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fishes =</span> <span class="fu">list</span>(<span class="fu">unique</span>(fishid))) <span class="sc">%&gt;%</span></span>
<span id="cb143-876"><a href="#cb143-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"location"</span> <span class="ot">=</span> <span class="st">"name"</span>)</span>
<span id="cb143-877"><a href="#cb143-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-878"><a href="#cb143-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-881"><a href="#cb143-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-882"><a href="#cb143-882" aria-hidden="true" tabindex="-1"></a>mapped_data <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-883"><a href="#cb143-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(possible_catches, <span class="at">by =</span> <span class="st">"location"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-884"><a href="#cb143-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, time)</span>
<span id="cb143-885"><a href="#cb143-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-886"><a href="#cb143-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-889"><a href="#cb143-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-890"><a href="#cb143-890" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify port returns</span></span>
<span id="cb143-891"><a href="#cb143-891" aria-hidden="true" tabindex="-1"></a>mapped_data<span class="sc">$</span>is_port_return <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"^City of"</span>, mapped_data<span class="sc">$</span>location)</span>
<span id="cb143-892"><a href="#cb143-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-893"><a href="#cb143-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-896"><a href="#cb143-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-897"><a href="#cb143-897" aria-hidden="true" tabindex="-1"></a>catch_summary <span class="ot">&lt;-</span> mapped_data <span class="sc">%&gt;%</span></span>
<span id="cb143-898"><a href="#cb143-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, vessel, <span class="at">return_number =</span> <span class="fu">cumsum</span>(is_port_return)) <span class="sc">%&gt;%</span></span>
<span id="cb143-899"><a href="#cb143-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb143-900"><a href="#cb143-900" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_port =</span> <span class="fu">first</span>(location),</span>
<span id="cb143-901"><a href="#cb143-901" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_leg =</span> <span class="fu">first</span>(time),</span>
<span id="cb143-902"><a href="#cb143-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_point_b4_port =</span> <span class="fu">last</span>(location),</span>
<span id="cb143-903"><a href="#cb143-903" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_before_port =</span> <span class="fu">last</span>(time),</span>
<span id="cb143-904"><a href="#cb143-904" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_check =</span> <span class="fu">first</span>(time <span class="sc">+</span> dwell),</span>
<span id="cb143-905"><a href="#cb143-905" aria-hidden="true" tabindex="-1"></a>    <span class="at">possible_catches =</span> <span class="fu">list</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(fishes)))</span>
<span id="cb143-906"><a href="#cb143-906" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb143-907"><a href="#cb143-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-908"><a href="#cb143-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-911"><a href="#cb143-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-912"><a href="#cb143-912" aria-hidden="true" tabindex="-1"></a>catch_summary <span class="ot">&lt;-</span> catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-913"><a href="#cb143-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">end_port =</span> <span class="fu">lead</span>(start_port, <span class="at">order_by =</span> id),</span>
<span id="cb143-914"><a href="#cb143-914" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_into_port =</span> <span class="fu">lead</span>(start_leg, <span class="at">order_by =</span> id),</span>
<span id="cb143-915"><a href="#cb143-915" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_exit_port =</span> <span class="fu">lead</span>(time_check, <span class="at">order_by =</span> id))</span>
<span id="cb143-916"><a href="#cb143-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-917"><a href="#cb143-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-920"><a href="#cb143-920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-921"><a href="#cb143-921" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-922"><a href="#cb143-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(possible_catches) <span class="sc">%&gt;%</span></span>
<span id="cb143-923"><a href="#cb143-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"possible_catches"</span>,</span>
<span id="cb143-924"><a href="#cb143-924" aria-hidden="true" tabindex="-1"></a>          <span class="st">"port"</span> <span class="ot">=</span> <span class="st">"end_port"</span>,</span>
<span id="cb143-925"><a href="#cb143-925" aria-hidden="true" tabindex="-1"></a>          <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"vessel"</span>)</span>
<span id="cb143-926"><a href="#cb143-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-927"><a href="#cb143-927" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-928"><a href="#cb143-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vessel_list, <span class="at">by =</span> <span class="st">"name"</span>)</span>
<span id="cb143-929"><a href="#cb143-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-930"><a href="#cb143-930" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-931"><a href="#cb143-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"fishid"</span>))</span>
<span id="cb143-932"><a href="#cb143-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-933"><a href="#cb143-933" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-934"><a href="#cb143-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, name.y))</span>
<span id="cb143-935"><a href="#cb143-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-936"><a href="#cb143-936" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-937"><a href="#cb143-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (name.x, port, time_into_port, time_exit_port, type, flag_country, tonnage, company, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-938"><a href="#cb143-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"name.x"</span>)</span>
<span id="cb143-939"><a href="#cb143-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-940"><a href="#cb143-940" aria-hidden="true" tabindex="-1"></a>all_catch_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-941"><a href="#cb143-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(time_into_port,<span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb143-942"><a href="#cb143-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-943"><a href="#cb143-943" aria-hidden="true" tabindex="-1"></a>catch_month_summary <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-944"><a href="#cb143-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-945"><a href="#cb143-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">vessel_count =</span> <span class="fu">n_distinct</span>(vessel))</span>
<span id="cb143-946"><a href="#cb143-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-947"><a href="#cb143-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-950"><a href="#cb143-950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-951"><a href="#cb143-951" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(catch_month_summary, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> fishtype, <span class="at">size =</span> vessel_count)) <span class="sc">+</span></span>
<span id="cb143-952"><a href="#cb143-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"lightskyblue4"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb143-953"><a href="#cb143-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)) <span class="sc">+</span>  <span class="co"># Adjust the range of the dot sizes</span></span>
<span id="cb143-954"><a href="#cb143-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Possible Fish Types Caught by Month"</span>,</span>
<span id="cb143-955"><a href="#cb143-955" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-956"><a href="#cb143-956" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Fish Type"</span>,</span>
<span id="cb143-957"><a href="#cb143-957" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on the transponder data and their duration in the region"</span>,</span>
<span id="cb143-958"><a href="#cb143-958" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Vessels"</span>) <span class="sc">+</span></span>
<span id="cb143-959"><a href="#cb143-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-960"><a href="#cb143-960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-961"><a href="#cb143-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-962"><a href="#cb143-962" aria-hidden="true" tabindex="-1"></a>Here, we attempt to match the catch summary with the harbor records, so that we exclude transponder pings that are not part of the harbor records.</span>
<span id="cb143-963"><a href="#cb143-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-966"><a href="#cb143-966" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-967"><a href="#cb143-967" aria-hidden="true" tabindex="-1"></a>harbor_summary <span class="ot">&lt;-</span> catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-968"><a href="#cb143-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb143-969"><a href="#cb143-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb143-970"><a href="#cb143-970" aria-hidden="true" tabindex="-1"></a>    <span class="at">harbor =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(harbor_records<span class="sc">$</span>name <span class="sc">==</span> vessel <span class="sc">&amp;</span></span>
<span id="cb143-971"><a href="#cb143-971" aria-hidden="true" tabindex="-1"></a>                        harbor_records<span class="sc">$</span>port <span class="sc">==</span> end_port <span class="sc">&amp;</span></span>
<span id="cb143-972"><a href="#cb143-972" aria-hidden="true" tabindex="-1"></a>                        harbor_records<span class="sc">$</span>date_added <span class="sc">&gt;=</span> time_into_port),</span>
<span id="cb143-973"><a href="#cb143-973" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Y"</span>, <span class="st">"N"</span>)</span>
<span id="cb143-974"><a href="#cb143-974" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb143-975"><a href="#cb143-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb143-976"><a href="#cb143-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-977"><a href="#cb143-977" aria-hidden="true" tabindex="-1"></a>harbor_summary <span class="ot">&lt;-</span> harbor_summary<span class="sc">%&gt;%</span></span>
<span id="cb143-978"><a href="#cb143-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(harbor <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb143-979"><a href="#cb143-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-980"><a href="#cb143-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-981"><a href="#cb143-981" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.4 Wrangling with the Delivery Reports</span></span>
<span id="cb143-982"><a href="#cb143-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-985"><a href="#cb143-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-986"><a href="#cb143-986" aria-hidden="true" tabindex="-1"></a>deliveryreports <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-987"><a href="#cb143-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Entity.Document.DeliveryReport"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb143-988"><a href="#cb143-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, qty_tons, date) </span>
<span id="cb143-989"><a href="#cb143-989" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-990"><a href="#cb143-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-993"><a href="#cb143-993" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-994"><a href="#cb143-994" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram</span></span>
<span id="cb143-995"><a href="#cb143-995" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(deliveryreports, <span class="fu">aes</span>(<span class="at">x =</span> qty_tons)) <span class="sc">+</span></span>
<span id="cb143-996"><a href="#cb143-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb143-997"><a href="#cb143-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"There are 5307 delivery reports and the qty ranges from 0 to ~80tons"</span>,</span>
<span id="cb143-998"><a href="#cb143-998" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Quantity in Tons"</span>,</span>
<span id="cb143-999"><a href="#cb143-999" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb143-1000"><a href="#cb143-1000" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"315 values are 0 and below (to remove these data)"</span>) <span class="sc">+</span></span>
<span id="cb143-1001"><a href="#cb143-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1002"><a href="#cb143-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"deepskyblue4"</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb143-1003"><a href="#cb143-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1004"><a href="#cb143-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1007"><a href="#cb143-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1008"><a href="#cb143-1008" aria-hidden="true" tabindex="-1"></a>delivery_reports_0andbelow <span class="ot">&lt;-</span> deliveryreports <span class="sc">%&gt;%</span></span>
<span id="cb143-1009"><a href="#cb143-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (qty_tons <span class="sc">&lt;=</span> <span class="dv">0</span>)</span>
<span id="cb143-1010"><a href="#cb143-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1011"><a href="#cb143-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1014"><a href="#cb143-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1015"><a href="#cb143-1015" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> deliveryreports <span class="sc">%&gt;%</span></span>
<span id="cb143-1016"><a href="#cb143-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (qty_tons <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb143-1017"><a href="#cb143-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1018"><a href="#cb143-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1021"><a href="#cb143-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1022"><a href="#cb143-1022" aria-hidden="true" tabindex="-1"></a>delivery_trans <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-1023"><a href="#cb143-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event.Transaction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1024"><a href="#cb143-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(source, target, date_added) <span class="sc">%&gt;%</span></span>
<span id="cb143-1025"><a href="#cb143-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"source"</span>) </span>
<span id="cb143-1026"><a href="#cb143-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1027"><a href="#cb143-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1030"><a href="#cb143-1030" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1031"><a href="#cb143-1031" aria-hidden="true" tabindex="-1"></a>delivery_trans<span class="sc">$</span>index <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">seq</span>(<span class="fu">nrow</span>(delivery_trans)) <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"port"</span>, <span class="st">"fish"</span>)</span>
<span id="cb143-1032"><a href="#cb143-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1033"><a href="#cb143-1033" aria-hidden="true" tabindex="-1"></a>delivery_trans1 <span class="ot">&lt;-</span> delivery_trans <span class="sc">%&gt;%</span></span>
<span id="cb143-1034"><a href="#cb143-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> index, <span class="at">values_from =</span> target) <span class="sc">%&gt;%</span></span>
<span id="cb143-1035"><a href="#cb143-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"fishid"</span> <span class="ot">=</span> <span class="st">"fish"</span>)</span>
<span id="cb143-1036"><a href="#cb143-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1037"><a href="#cb143-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1040"><a href="#cb143-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1041"><a href="#cb143-1041" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1042"><a href="#cb143-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delivery_trans1, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb143-1043"><a href="#cb143-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1044"><a href="#cb143-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1045"><a href="#cb143-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1048"><a href="#cb143-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1049"><a href="#cb143-1049" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1050"><a href="#cb143-1050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="st">"fishid"</span>)</span>
<span id="cb143-1051"><a href="#cb143-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1052"><a href="#cb143-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1055"><a href="#cb143-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1056"><a href="#cb143-1056" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1057"><a href="#cb143-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, name))</span>
<span id="cb143-1058"><a href="#cb143-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1059"><a href="#cb143-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1060"><a href="#cb143-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1063"><a href="#cb143-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1064"><a href="#cb143-1064" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1065"><a href="#cb143-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fishid, <span class="sc">-</span>name, <span class="sc">-</span>date_added)</span>
<span id="cb143-1066"><a href="#cb143-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1067"><a href="#cb143-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1068"><a href="#cb143-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.4.1 Deliveries by the Ports</span></span>
<span id="cb143-1069"><a href="#cb143-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1072"><a href="#cb143-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1073"><a href="#cb143-1073" aria-hidden="true" tabindex="-1"></a>custom_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"City of Haacklee"</span> <span class="ot">=</span> <span class="st">"Haacklee"</span>, </span>
<span id="cb143-1074"><a href="#cb143-1074" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of Himark"</span> <span class="ot">=</span> <span class="st">"Himark"</span>,</span>
<span id="cb143-1075"><a href="#cb143-1075" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of Lomark"</span> <span class="ot">=</span> <span class="st">"Lomark"</span>,</span>
<span id="cb143-1076"><a href="#cb143-1076" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of Paackland"</span> <span class="ot">=</span> <span class="st">"Paackland"</span>,</span>
<span id="cb143-1077"><a href="#cb143-1077" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City of South Paackland"</span> <span class="ot">=</span> <span class="st">"S.Paackland"</span>)</span>
<span id="cb143-1078"><a href="#cb143-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1079"><a href="#cb143-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1080"><a href="#cb143-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(delivery_reports, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> qty_tons)) <span class="sc">+</span></span>
<span id="cb143-1081"><a href="#cb143-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"azure4"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb143-1082"><a href="#cb143-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Similar Range in terms of Qty at the different Ports"</span>,</span>
<span id="cb143-1083"><a href="#cb143-1083" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Port"</span>,</span>
<span id="cb143-1084"><a href="#cb143-1084" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Quantity in Tons"</span>) <span class="sc">+</span></span>
<span id="cb143-1085"><a href="#cb143-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb143-1086"><a href="#cb143-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-1087"><a href="#cb143-1087" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1088"><a href="#cb143-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1089"><a href="#cb143-1089" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.4.2 Fish Species not found in Fishing Grounds but Delivered at the Ports</span></span>
<span id="cb143-1090"><a href="#cb143-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1093"><a href="#cb143-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1094"><a href="#cb143-1094" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of port and fish type</span></span>
<span id="cb143-1095"><a href="#cb143-1095" aria-hidden="true" tabindex="-1"></a>delivery_summary <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1096"><a href="#cb143-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1097"><a href="#cb143-1097" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb143-1098"><a href="#cb143-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1099"><a href="#cb143-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(delivery_summary, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> num_deliveries)) <span class="sc">+</span></span>
<span id="cb143-1100"><a href="#cb143-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Adjust alpha for transparency if needed</span></span>
<span id="cb143-1101"><a href="#cb143-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sockfish, Salmon, Offidiaa and Helenaa are found at the Ports"</span>,</span>
<span id="cb143-1102"><a href="#cb143-1102" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-1103"><a href="#cb143-1103" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-1104"><a href="#cb143-1104" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Deliveries"</span>) <span class="sc">+</span></span>
<span id="cb143-1105"><a href="#cb143-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb143-1106"><a href="#cb143-1106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1107"><a href="#cb143-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))  </span>
<span id="cb143-1108"><a href="#cb143-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1109"><a href="#cb143-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1110"><a href="#cb143-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1111"><a href="#cb143-1111" aria-hidden="true" tabindex="-1"></a>From the graph, we identified that **Sockfish, Salmon, Offidiaa and Helenaa** are found at the various ports. These are fishes that are not found in the fishing grounds, so identifying the vessels that offload these cargoes can help to narrow down IUU fishing.</span>
<span id="cb143-1112"><a href="#cb143-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1113"><a href="#cb143-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4.4.3 Monthly Delivery Trend by Fish Types</span></span>
<span id="cb143-1114"><a href="#cb143-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1117"><a href="#cb143-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1118"><a href="#cb143-1118" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1119"><a href="#cb143-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb143-1120"><a href="#cb143-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1121"><a href="#cb143-1121" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract month from the date</span></span>
<span id="cb143-1122"><a href="#cb143-1122" aria-hidden="true" tabindex="-1"></a>delivery_reports <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1123"><a href="#cb143-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>))</span>
<span id="cb143-1124"><a href="#cb143-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1125"><a href="#cb143-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of month and fish type</span></span>
<span id="cb143-1126"><a href="#cb143-1126" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1127"><a href="#cb143-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1128"><a href="#cb143-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb143-1129"><a href="#cb143-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1130"><a href="#cb143-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean deliveries per fish type</span></span>
<span id="cb143-1131"><a href="#cb143-1131" aria-hidden="true" tabindex="-1"></a>mean_deliveries <span class="ot">&lt;-</span> monthly_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1132"><a href="#cb143-1132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1133"><a href="#cb143-1133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_deliveries =</span> <span class="fu">mean</span>(num_deliveries))</span>
<span id="cb143-1134"><a href="#cb143-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1135"><a href="#cb143-1135" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the highest delivery per fish type</span></span>
<span id="cb143-1136"><a href="#cb143-1136" aria-hidden="true" tabindex="-1"></a>max_deliveries <span class="ot">&lt;-</span> monthly_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1137"><a href="#cb143-1137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1138"><a href="#cb143-1138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_deliveries <span class="sc">==</span> <span class="fu">max</span>(num_deliveries))</span>
<span id="cb143-1139"><a href="#cb143-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1140"><a href="#cb143-1140" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the summary data to add the mean delivery to each row</span></span>
<span id="cb143-1141"><a href="#cb143-1141" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> monthly_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1142"><a href="#cb143-1142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_deliveries, <span class="at">by =</span> <span class="st">"fishtype"</span>)</span>
<span id="cb143-1143"><a href="#cb143-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1144"><a href="#cb143-1144" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the monthly delivery</span></span>
<span id="cb143-1145"><a href="#cb143-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_summary, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> num_deliveries, <span class="at">color =</span> fishtype)) <span class="sc">+</span></span>
<span id="cb143-1146"><a href="#cb143-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Line plot for monthly trend</span></span>
<span id="cb143-1147"><a href="#cb143-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Add points for each month</span></span>
<span id="cb143-1148"><a href="#cb143-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cod has the highest number of deliveries"</span>,</span>
<span id="cb143-1149"><a href="#cb143-1149" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-1150"><a href="#cb143-1150" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Deliveries"</span>,</span>
<span id="cb143-1151"><a href="#cb143-1151" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"The four illegal fish species are delivered in certain months only"</span>,</span>
<span id="cb143-1152"><a href="#cb143-1152" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Fish Type"</span>) <span class="sc">+</span></span>
<span id="cb143-1153"><a href="#cb143-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1154"><a href="#cb143-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb143-1155"><a href="#cb143-1155" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb143-1156"><a href="#cb143-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> max_deliveries, <span class="fu">aes</span>(<span class="at">label =</span> num_deliveries), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-1157"><a href="#cb143-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>))) <span class="sc">+</span></span>
<span id="cb143-1158"><a href="#cb143-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> fishtype)  </span>
<span id="cb143-1159"><a href="#cb143-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1160"><a href="#cb143-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1163"><a href="#cb143-1163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1164"><a href="#cb143-1164" aria-hidden="true" tabindex="-1"></a>filtered_summary <span class="ot">&lt;-</span> delivery_reports <span class="sc">%&gt;%</span></span>
<span id="cb143-1165"><a href="#cb143-1165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype, port) <span class="sc">%&gt;%</span></span>
<span id="cb143-1166"><a href="#cb143-1166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb143-1167"><a href="#cb143-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1168"><a href="#cb143-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1171"><a href="#cb143-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1172"><a href="#cb143-1172" aria-hidden="true" tabindex="-1"></a>filtered_summary <span class="ot">&lt;-</span> filtered_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1173"><a href="#cb143-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fishtype <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sockfish"</span>, <span class="st">"Salmon"</span>, <span class="st">"Offidiaa"</span>, <span class="st">"Helenaa"</span>))</span>
<span id="cb143-1174"><a href="#cb143-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1175"><a href="#cb143-1175" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total deliveries across all ports for each month</span></span>
<span id="cb143-1176"><a href="#cb143-1176" aria-hidden="true" tabindex="-1"></a>total_deliveries <span class="ot">&lt;-</span> filtered_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1177"><a href="#cb143-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1178"><a href="#cb143-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_deliveries =</span> <span class="fu">sum</span>(num_deliveries)) <span class="sc">%&gt;%</span></span>
<span id="cb143-1179"><a href="#cb143-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">port =</span> <span class="st">"Total"</span>)  </span>
<span id="cb143-1180"><a href="#cb143-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1181"><a href="#cb143-1181" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the filtered summary data with the total deliveries</span></span>
<span id="cb143-1182"><a href="#cb143-1182" aria-hidden="true" tabindex="-1"></a>combined_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(filtered_summary, total_deliveries)</span>
<span id="cb143-1183"><a href="#cb143-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1184"><a href="#cb143-1184" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the monthly delivery</span></span>
<span id="cb143-1185"><a href="#cb143-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_summary, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> num_deliveries, <span class="at">color =</span> fishtype)) <span class="sc">+</span></span>
<span id="cb143-1186"><a href="#cb143-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Line plot for monthly trend</span></span>
<span id="cb143-1187"><a href="#cb143-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Add points for each month</span></span>
<span id="cb143-1188"><a href="#cb143-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Paackland and Himark saw high delivery of the four fish species"</span>,</span>
<span id="cb143-1189"><a href="#cb143-1189" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-1190"><a href="#cb143-1190" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Deliveries"</span>,</span>
<span id="cb143-1191"><a href="#cb143-1191" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Salmon is mostly delivered through Haacklee and Paackland"</span>,</span>
<span id="cb143-1192"><a href="#cb143-1192" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Fish Type"</span>) <span class="sc">+</span></span>
<span id="cb143-1193"><a href="#cb143-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1194"><a href="#cb143-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%b"</span>, <span class="at">limits =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2035-02-01"</span>, <span class="st">"2035-11-31"</span>))) <span class="sc">+</span></span>
<span id="cb143-1195"><a href="#cb143-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> combined_summary, <span class="fu">aes</span>(<span class="at">label =</span> num_deliveries), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb143-1196"><a href="#cb143-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb143-1197"><a href="#cb143-1197" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb143-1198"><a href="#cb143-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> port)</span>
<span id="cb143-1199"><a href="#cb143-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1200"><a href="#cb143-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1201"><a href="#cb143-1201" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.5 Merging the Catch Summary Data with Delivery Reports</span></span>
<span id="cb143-1202"><a href="#cb143-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1205"><a href="#cb143-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1206"><a href="#cb143-1206" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> harbor_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1207"><a href="#cb143-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(possible_catches) <span class="sc">%&gt;%</span></span>
<span id="cb143-1208"><a href="#cb143-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"possible_catches"</span>,</span>
<span id="cb143-1209"><a href="#cb143-1209" aria-hidden="true" tabindex="-1"></a>          <span class="st">"port"</span> <span class="ot">=</span> <span class="st">"end_port"</span>,</span>
<span id="cb143-1210"><a href="#cb143-1210" aria-hidden="true" tabindex="-1"></a>          <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"vessel"</span>)</span>
<span id="cb143-1211"><a href="#cb143-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1212"><a href="#cb143-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1215"><a href="#cb143-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1216"><a href="#cb143-1216" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1217"><a href="#cb143-1217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vessel_list, <span class="at">by =</span> <span class="st">"name"</span>)</span>
<span id="cb143-1218"><a href="#cb143-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1219"><a href="#cb143-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1222"><a href="#cb143-1222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1223"><a href="#cb143-1223" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1224"><a href="#cb143-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fishes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fish"</span> <span class="ot">=</span> <span class="st">"fishid"</span>))</span>
<span id="cb143-1225"><a href="#cb143-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1226"><a href="#cb143-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1229"><a href="#cb143-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1230"><a href="#cb143-1230" aria-hidden="true" tabindex="-1"></a>expanded_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1231"><a href="#cb143-1231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fishtype =</span> <span class="fu">sub</span>(<span class="st">"/.*"</span>, <span class="st">""</span>, name.y))</span>
<span id="cb143-1232"><a href="#cb143-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1233"><a href="#cb143-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1234"><a href="#cb143-1234" aria-hidden="true" tabindex="-1"></a>Clean up the summary.</span>
<span id="cb143-1235"><a href="#cb143-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1238"><a href="#cb143-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1239"><a href="#cb143-1239" aria-hidden="true" tabindex="-1"></a>final_catch_summary <span class="ot">&lt;-</span> expanded_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1240"><a href="#cb143-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span> (name.x, port, time_into_port, time_exit_port, type, flag_country, tonnage, company, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1241"><a href="#cb143-1241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="st">"vessel"</span> <span class="ot">=</span> <span class="st">"name.x"</span>)</span>
<span id="cb143-1242"><a href="#cb143-1242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1243"><a href="#cb143-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1246"><a href="#cb143-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1247"><a href="#cb143-1247" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> final_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1248"><a href="#cb143-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delivery_reports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"port"</span>, <span class="st">"fishtype"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-1249"><a href="#cb143-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> time_into_port <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">&amp;</span></span>
<span id="cb143-1250"><a href="#cb143-1250" aria-hidden="true" tabindex="-1"></a>         date <span class="sc">&lt;=</span> time_exit_port <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1251"><a href="#cb143-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cargo =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(id), <span class="fu">as.character</span>(id), <span class="st">"N"</span>))</span>
<span id="cb143-1252"><a href="#cb143-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1253"><a href="#cb143-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1256"><a href="#cb143-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1257"><a href="#cb143-1257" aria-hidden="true" tabindex="-1"></a>summary_cargo <span class="ot">&lt;-</span> matched_data <span class="sc">%&gt;%</span></span>
<span id="cb143-1258"><a href="#cb143-1258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb143-1259"><a href="#cb143-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb143-1260"><a href="#cb143-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1261"><a href="#cb143-1261" aria-hidden="true" tabindex="-1"></a>summary_cargo_unique <span class="ot">&lt;-</span> summary_cargo <span class="sc">%&gt;%</span></span>
<span id="cb143-1262"><a href="#cb143-1262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb143-1263"><a href="#cb143-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1264"><a href="#cb143-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1265"><a href="#cb143-1265" aria-hidden="true" tabindex="-1"></a><span class="fu"># 5. Visualising</span></span>
<span id="cb143-1266"><a href="#cb143-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1269"><a href="#cb143-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1270"><a href="#cb143-1270" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of port and fish type</span></span>
<span id="cb143-1271"><a href="#cb143-1271" aria-hidden="true" tabindex="-1"></a>match_summary <span class="ot">&lt;-</span> matched_data <span class="sc">%&gt;%</span></span>
<span id="cb143-1272"><a href="#cb143-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1273"><a href="#cb143-1273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb143-1274"><a href="#cb143-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1275"><a href="#cb143-1275" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(match_summary, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> num_deliveries)) <span class="sc">+</span></span>
<span id="cb143-1276"><a href="#cb143-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Adjust alpha for transparency if needed</span></span>
<span id="cb143-1277"><a href="#cb143-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Delivery of the 4 illegal species are not matched fully"</span>,</span>
<span id="cb143-1278"><a href="#cb143-1278" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-1279"><a href="#cb143-1279" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-1280"><a href="#cb143-1280" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Perhaps the transponder is off when such deliveries are made"</span>,</span>
<span id="cb143-1281"><a href="#cb143-1281" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Deliveries"</span>) <span class="sc">+</span></span>
<span id="cb143-1282"><a href="#cb143-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb143-1283"><a href="#cb143-1283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1284"><a href="#cb143-1284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>))  </span>
<span id="cb143-1285"><a href="#cb143-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1286"><a href="#cb143-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1287"><a href="#cb143-1287" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.1 Match with Harbor Records Instead</span></span>
<span id="cb143-1288"><a href="#cb143-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1291"><a href="#cb143-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1292"><a href="#cb143-1292" aria-hidden="true" tabindex="-1"></a>matched_data_harbor <span class="ot">&lt;-</span> harbor_records <span class="sc">%&gt;%</span></span>
<span id="cb143-1293"><a href="#cb143-1293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delivery_reports, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"port"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-1294"><a href="#cb143-1294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> date_added  <span class="sc">&amp;</span></span>
<span id="cb143-1295"><a href="#cb143-1295" aria-hidden="true" tabindex="-1"></a>           date <span class="sc">&lt;=</span> date_added <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb143-1296"><a href="#cb143-1296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1297"><a href="#cb143-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1300"><a href="#cb143-1300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1301"><a href="#cb143-1301" aria-hidden="true" tabindex="-1"></a>summary_cargo <span class="ot">&lt;-</span> matched_data_harbor <span class="sc">%&gt;%</span></span>
<span id="cb143-1302"><a href="#cb143-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb143-1303"><a href="#cb143-1303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb143-1304"><a href="#cb143-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1305"><a href="#cb143-1305" aria-hidden="true" tabindex="-1"></a>summary_cargo_unique <span class="ot">&lt;-</span> summary_cargo <span class="sc">%&gt;%</span></span>
<span id="cb143-1306"><a href="#cb143-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb143-1307"><a href="#cb143-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1308"><a href="#cb143-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1311"><a href="#cb143-1311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1312"><a href="#cb143-1312" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to count the number of deliveries for each combination of port and fish type</span></span>
<span id="cb143-1313"><a href="#cb143-1313" aria-hidden="true" tabindex="-1"></a>match_summary <span class="ot">&lt;-</span> matched_data_harbor <span class="sc">%&gt;%</span></span>
<span id="cb143-1314"><a href="#cb143-1314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(port, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1315"><a href="#cb143-1315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_deliveries =</span> <span class="fu">n</span>())</span>
<span id="cb143-1316"><a href="#cb143-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1317"><a href="#cb143-1317" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(match_summary, <span class="fu">aes</span>(<span class="at">x =</span> port, <span class="at">y =</span> fishtype, <span class="at">color =</span> fishtype, <span class="at">size =</span> num_deliveries)) <span class="sc">+</span></span>
<span id="cb143-1318"><a href="#cb143-1318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Adjust alpha for transparency if needed</span></span>
<span id="cb143-1319"><a href="#cb143-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"More records matched, with 1613 unique matches"</span>,</span>
<span id="cb143-1320"><a href="#cb143-1320" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-1321"><a href="#cb143-1321" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb143-1322"><a href="#cb143-1322" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Matching with the harbor records only could be more accurate"</span>,</span>
<span id="cb143-1323"><a href="#cb143-1323" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Number of Deliveries"</span>) <span class="sc">+</span></span>
<span id="cb143-1324"><a href="#cb143-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> custom_labels) <span class="sc">+</span></span>
<span id="cb143-1325"><a href="#cb143-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1326"><a href="#cb143-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>)) </span>
<span id="cb143-1327"><a href="#cb143-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1328"><a href="#cb143-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1331"><a href="#cb143-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1332"><a href="#cb143-1332" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> matched_data_harbor <span class="sc">%&gt;%</span></span>
<span id="cb143-1333"><a href="#cb143-1333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vessel, id) <span class="sc">%&gt;%</span></span>
<span id="cb143-1334"><a href="#cb143-1334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb143-1335"><a href="#cb143-1335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vessel) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(id))</span>
<span id="cb143-1336"><a href="#cb143-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1337"><a href="#cb143-1337" aria-hidden="true" tabindex="-1"></a><span class="co"># Create nodes for the network graph</span></span>
<span id="cb143-1338"><a href="#cb143-1338" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">unique</span>(<span class="fu">c</span>(edges<span class="sc">$</span>vessel, edges<span class="sc">$</span>id)))</span>
<span id="cb143-1339"><a href="#cb143-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1340"><a href="#cb143-1340" aria-hidden="true" tabindex="-1"></a><span class="co"># Create igraph object</span></span>
<span id="cb143-1341"><a href="#cb143-1341" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> edges, <span class="at">vertices =</span> nodes, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb143-1342"><a href="#cb143-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1343"><a href="#cb143-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1344"><a href="#cb143-1344" aria-hidden="true" tabindex="-1"></a>Trying to plot using network graphs - but this is a mess - need to tidy up!</span>
<span id="cb143-1345"><a href="#cb143-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1348"><a href="#cb143-1348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1349"><a href="#cb143-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the network graph</span></span>
<span id="cb143-1350"><a href="#cb143-1350" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(graph, <span class="at">layout =</span> <span class="st">"fr"</span>) <span class="sc">+</span> </span>
<span id="cb143-1351"><a href="#cb143-1351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">start_cap =</span> <span class="fu">label_rect</span>(node1.name), <span class="at">end_cap =</span> <span class="fu">label_rect</span>(node2.name)), <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"mm"</span>)), <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb143-1352"><a href="#cb143-1352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> name <span class="sc">%in%</span> edges<span class="sc">$</span>vessel), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb143-1353"><a href="#cb143-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb143-1354"><a href="#cb143-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Network Graph of Vessels and Linked Cargo"</span>) <span class="sc">+</span></span>
<span id="cb143-1355"><a href="#cb143-1355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb143-1356"><a href="#cb143-1356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb143-1357"><a href="#cb143-1357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1358"><a href="#cb143-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1359"><a href="#cb143-1359" aria-hidden="true" tabindex="-1"></a><span class="fu"># 6. Qn 2 - Illegal Activities for SouthSeafood Express Corp (SEC)</span></span>
<span id="cb143-1360"><a href="#cb143-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1361"><a href="#cb143-1361" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6.1 Identify Vessels belonging to SEC</span></span>
<span id="cb143-1362"><a href="#cb143-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1365"><a href="#cb143-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1366"><a href="#cb143-1366" aria-hidden="true" tabindex="-1"></a>SEC_vessel <span class="ot">&lt;-</span> vessel_list <span class="sc">%&gt;%</span></span>
<span id="cb143-1367"><a href="#cb143-1367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (company <span class="sc">==</span> <span class="st">"SouthSeafood Express Corp"</span>)</span>
<span id="cb143-1368"><a href="#cb143-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1369"><a href="#cb143-1369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1370"><a href="#cb143-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1371"><a href="#cb143-1371" aria-hidden="true" tabindex="-1"></a>We found only 2 vessels linked to SEC:</span>
<span id="cb143-1372"><a href="#cb143-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1373"><a href="#cb143-1373" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Snapper Snatcher (snappersnatcher7be)- a small 100 ton vessel</span>
<span id="cb143-1374"><a href="#cb143-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1375"><a href="#cb143-1375" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Roach Robber (roachrobberdb6)- a 11700 ton bigger vessel</span>
<span id="cb143-1376"><a href="#cb143-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1377"><a href="#cb143-1377" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6.2 Introducing the Geospatial Data to help in visualising</span></span>
<span id="cb143-1378"><a href="#cb143-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1379"><a href="#cb143-1379" aria-hidden="true" tabindex="-1"></a>Importing the geographical data in geojson file format</span>
<span id="cb143-1380"><a href="#cb143-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1383"><a href="#cb143-1383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1384"><a href="#cb143-1384" aria-hidden="true" tabindex="-1"></a>OceanusGeography <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"data/OceanusGeography.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1385"><a href="#cb143-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb143-1386"><a href="#cb143-1386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1387"><a href="#cb143-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1388"><a href="#cb143-1388" aria-hidden="true" tabindex="-1"></a>Visualising the geojson:</span>
<span id="cb143-1389"><a href="#cb143-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1392"><a href="#cb143-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1393"><a href="#cb143-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1394"><a href="#cb143-1394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span>
<span id="cb143-1395"><a href="#cb143-1395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1396"><a href="#cb143-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1399"><a href="#cb143-1399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1400"><a href="#cb143-1400" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(OceanusGeography, <span class="st">"data/rds/OceanusGeography.rds"</span>)</span>
<span id="cb143-1401"><a href="#cb143-1401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1402"><a href="#cb143-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1403"><a href="#cb143-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6.3 **Importing Geographical Data in ESRI shapefile format**</span></span>
<span id="cb143-1404"><a href="#cb143-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1407"><a href="#cb143-1407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1408"><a href="#cb143-1408" aria-hidden="true" tabindex="-1"></a>OceanusLocations <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/shp"</span>,</span>
<span id="cb143-1409"><a href="#cb143-1409" aria-hidden="true" tabindex="-1"></a>  <span class="at">layer =</span> <span class="st">"Oceanus Geography"</span>)</span>
<span id="cb143-1410"><a href="#cb143-1410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1411"><a href="#cb143-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1414"><a href="#cb143-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1415"><a href="#cb143-1415" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> OceanusLocations) <span class="sc">+</span></span>
<span id="cb143-1416"><a href="#cb143-1416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span>
<span id="cb143-1417"><a href="#cb143-1417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1418"><a href="#cb143-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1421"><a href="#cb143-1421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1422"><a href="#cb143-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(OceanusLocations, <span class="st">"data/rds/OceanusLocations.rds"</span>)</span>
<span id="cb143-1423"><a href="#cb143-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1424"><a href="#cb143-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1425"><a href="#cb143-1425" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6.4 Data Prep for Vessel Movement Data</span></span>
<span id="cb143-1426"><a href="#cb143-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1429"><a href="#cb143-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1430"><a href="#cb143-1430" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> mc2_edges <span class="sc">%&gt;%</span></span>
<span id="cb143-1431"><a href="#cb143-1431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(event3 <span class="sc">==</span> <span class="st">"TransponderPing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1432"><a href="#cb143-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, dwell, source, target)</span>
<span id="cb143-1433"><a href="#cb143-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1434"><a href="#cb143-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1437"><a href="#cb143-1437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1438"><a href="#cb143-1438" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(vessel_movement_data<span class="sc">$</span>source)</span>
<span id="cb143-1439"><a href="#cb143-1439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1440"><a href="#cb143-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1443"><a href="#cb143-1443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1444"><a href="#cb143-1444" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(OceanusLocations<span class="sc">$</span>Name)</span>
<span id="cb143-1445"><a href="#cb143-1445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1446"><a href="#cb143-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1447"><a href="#cb143-1447" aria-hidden="true" tabindex="-1"></a>We note that the vessel movement data's name of the location did not match the OceanusLocations. So we need to match.</span>
<span id="cb143-1448"><a href="#cb143-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1451"><a href="#cb143-1451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1452"><a href="#cb143-1452" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> vessel_movement_data<span class="sc">%&gt;%</span></span>
<span id="cb143-1453"><a href="#cb143-1453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">gsub</span>(<span class="st">"^City of"</span>, <span class="st">""</span>, source)) <span class="sc">%&gt;%</span></span>
<span id="cb143-1454"><a href="#cb143-1454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">gsub</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">""</span>, source))</span>
<span id="cb143-1455"><a href="#cb143-1455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1456"><a href="#cb143-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1459"><a href="#cb143-1459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1460"><a href="#cb143-1460" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(OceanusLocations)</span>
<span id="cb143-1461"><a href="#cb143-1461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1462"><a href="#cb143-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1465"><a href="#cb143-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1466"><a href="#cb143-1466" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df <span class="ot">&lt;-</span> OceanusLocations <span class="sc">%&gt;%</span></span>
<span id="cb143-1467"><a href="#cb143-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb143-1468"><a href="#cb143-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1469"><a href="#cb143-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1472"><a href="#cb143-1472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1473"><a href="#cb143-1473" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df<span class="sc">$</span>XCOORD <span class="ot">&lt;-</span> coords[, <span class="st">"X"</span>]</span>
<span id="cb143-1474"><a href="#cb143-1474" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df<span class="sc">$</span>YCOORD <span class="ot">&lt;-</span> coords[, <span class="st">"Y"</span>]</span>
<span id="cb143-1475"><a href="#cb143-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1476"><a href="#cb143-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1479"><a href="#cb143-1479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1480"><a href="#cb143-1480" aria-hidden="true" tabindex="-1"></a>OceanusLocations_df <span class="ot">&lt;-</span> OceanusLocations_df <span class="sc">%&gt;%</span></span>
<span id="cb143-1481"><a href="#cb143-1481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, X.Kind, XCOORD, YCOORD) <span class="sc">%&gt;%</span></span>
<span id="cb143-1482"><a href="#cb143-1482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Loc_Type =</span> X.Kind)</span>
<span id="cb143-1483"><a href="#cb143-1483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1484"><a href="#cb143-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1487"><a href="#cb143-1487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1488"><a href="#cb143-1488" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> vessel_movement_data <span class="sc">%&gt;%</span></span>
<span id="cb143-1489"><a href="#cb143-1489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(OceanusLocations_df,</span>
<span id="cb143-1490"><a href="#cb143-1490" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span> <span class="ot">=</span> <span class="st">"Name"</span>))</span>
<span id="cb143-1491"><a href="#cb143-1491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1492"><a href="#cb143-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1495"><a href="#cb143-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1496"><a href="#cb143-1496" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(vessel_movement_data, <span class="st">"data/rds/vessel_movement_data.rds"</span>)</span>
<span id="cb143-1497"><a href="#cb143-1497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1498"><a href="#cb143-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1499"><a href="#cb143-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6.5 Visualising the Trajectories of Snappy Snatcher and Roach Robber</span></span>
<span id="cb143-1500"><a href="#cb143-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1501"><a href="#cb143-1501" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.5.1 Transforming the vessel movement data to a path</span></span>
<span id="cb143-1502"><a href="#cb143-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1505"><a href="#cb143-1505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1506"><a href="#cb143-1506" aria-hidden="true" tabindex="-1"></a>vessel_movement_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/vessel_movement_data.rds"</span>)</span>
<span id="cb143-1507"><a href="#cb143-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1508"><a href="#cb143-1508" aria-hidden="true" tabindex="-1"></a>OceanusGeography <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/OceanusGeography.rds"</span>)</span>
<span id="cb143-1509"><a href="#cb143-1509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1510"><a href="#cb143-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1513"><a href="#cb143-1513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1514"><a href="#cb143-1514" aria-hidden="true" tabindex="-1"></a>vessel_movement_sf <span class="ot">&lt;-</span> vessel_movement_data <span class="sc">%&gt;%</span></span>
<span id="cb143-1515"><a href="#cb143-1515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"XCOORD"</span>, <span class="st">"YCOORD"</span>), </span>
<span id="cb143-1516"><a href="#cb143-1516" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb143-1517"><a href="#cb143-1517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1518"><a href="#cb143-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1521"><a href="#cb143-1521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1522"><a href="#cb143-1522" aria-hidden="true" tabindex="-1"></a>vessel_movement_sf <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1523"><a href="#cb143-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(target, time)</span>
<span id="cb143-1524"><a href="#cb143-1524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1525"><a href="#cb143-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1528"><a href="#cb143-1528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1529"><a href="#cb143-1529" aria-hidden="true" tabindex="-1"></a>vessel_trajectory <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1530"><a href="#cb143-1530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target) <span class="sc">%&gt;%</span></span>
<span id="cb143-1531"><a href="#cb143-1531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">do_union =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1532"><a href="#cb143-1532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>)</span>
<span id="cb143-1533"><a href="#cb143-1533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1534"><a href="#cb143-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1537"><a href="#cb143-1537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1538"><a href="#cb143-1538" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_selected <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb143-1539"><a href="#cb143-1539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"snappersnatcher7be"</span>)</span>
<span id="cb143-1540"><a href="#cb143-1540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1541"><a href="#cb143-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1542"><a href="#cb143-1542" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.5.2 Calculating the Dwell Time (mins) at each point</span></span>
<span id="cb143-1543"><a href="#cb143-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1544"><a href="#cb143-1544" aria-hidden="true" tabindex="-1"></a>For now, we will look at the total amount of time that each vessel has spent at each location. We will sum the dwell time (converted to mins) at each location.</span>
<span id="cb143-1545"><a href="#cb143-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1548"><a href="#cb143-1548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1549"><a href="#cb143-1549" aria-hidden="true" tabindex="-1"></a>points_data <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1550"><a href="#cb143-1550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"snappersnatcher7be"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1551"><a href="#cb143-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb143-1552"><a href="#cb143-1552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-1553"><a href="#cb143-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1554"><a href="#cb143-1554" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb143-1555"><a href="#cb143-1555" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data) <span class="ot">&lt;-</span> points_data<span class="sc">$</span>geometry</span>
<span id="cb143-1556"><a href="#cb143-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1557"><a href="#cb143-1557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1558"><a href="#cb143-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1559"><a href="#cb143-1559" aria-hidden="true" tabindex="-1"></a>Subsequently, it will be richer if we are able to plot the data by months. This would help us better visualise and compare the movement of the vessels.</span>
<span id="cb143-1560"><a href="#cb143-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1561"><a href="#cb143-1561" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.5.3 Path of Snapper Snatcher and Roach Robber</span></span>
<span id="cb143-1562"><a href="#cb143-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1565"><a href="#cb143-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1566"><a href="#cb143-1566" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_robber <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb143-1567"><a href="#cb143-1567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"roachrobberdb6"</span>)</span>
<span id="cb143-1568"><a href="#cb143-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1569"><a href="#cb143-1569" aria-hidden="true" tabindex="-1"></a>points_data_robber <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1570"><a href="#cb143-1570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"roachrobberdb6"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1571"><a href="#cb143-1571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb143-1572"><a href="#cb143-1572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-1573"><a href="#cb143-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1574"><a href="#cb143-1574" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb143-1575"><a href="#cb143-1575" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_robber) <span class="ot">&lt;-</span> points_data_robber<span class="sc">$</span>geometry</span>
<span id="cb143-1576"><a href="#cb143-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1577"><a href="#cb143-1577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1578"><a href="#cb143-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1581"><a href="#cb143-1581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1582"><a href="#cb143-1582" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-SECVesselsPath</span></span>
<span id="cb143-1583"><a href="#cb143-1583" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Snapper Snatcher lingered in Ghoti Preserve"</span></span>
<span id="cb143-1584"><a href="#cb143-1584" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb143-1585"><a href="#cb143-1585" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Path of Snapper Snatcher"</span></span>
<span id="cb143-1586"><a href="#cb143-1586" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Patch of Roach Robber"</span></span>
<span id="cb143-1587"><a href="#cb143-1587" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb143-1588"><a href="#cb143-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1589"><a href="#cb143-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1590"><a href="#cb143-1590" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-1591"><a href="#cb143-1591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1592"><a href="#cb143-1592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb143-1593"><a href="#cb143-1593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_selected, </span>
<span id="cb143-1594"><a href="#cb143-1594" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb143-1595"><a href="#cb143-1595" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb143-1596"><a href="#cb143-1596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data, </span>
<span id="cb143-1597"><a href="#cb143-1597" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb143-1598"><a href="#cb143-1598" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb143-1599"><a href="#cb143-1599" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb143-1600"><a href="#cb143-1600" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb143-1601"><a href="#cb143-1601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1602"><a href="#cb143-1602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"lavender"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1603"><a href="#cb143-1603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1604"><a href="#cb143-1604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Snapper Snatcher spent substantial time within Ghouti Preserve"</span>, </span>
<span id="cb143-1605"><a href="#cb143-1605" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb143-1606"><a href="#cb143-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1607"><a href="#cb143-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1608"><a href="#cb143-1608" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-1609"><a href="#cb143-1609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1610"><a href="#cb143-1610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb143-1611"><a href="#cb143-1611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_robber, </span>
<span id="cb143-1612"><a href="#cb143-1612" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb143-1613"><a href="#cb143-1613" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb143-1614"><a href="#cb143-1614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_robber, </span>
<span id="cb143-1615"><a href="#cb143-1615" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb143-1616"><a href="#cb143-1616" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb143-1617"><a href="#cb143-1617" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb143-1618"><a href="#cb143-1618" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb143-1619"><a href="#cb143-1619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1620"><a href="#cb143-1620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"lavender"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1621"><a href="#cb143-1621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1622"><a href="#cb143-1622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Roach Robber spent time mostly at Himark, Wrasse Beds and Nav C"</span>, </span>
<span id="cb143-1623"><a href="#cb143-1623" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb143-1624"><a href="#cb143-1624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1625"><a href="#cb143-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1626"><a href="#cb143-1626" aria-hidden="true" tabindex="-1"></a>Snapper Snatcher also **spent time at Exit East - they are likely to engage in Deep Sea Fishing** there (activities tied to the Exit Areas). This is also likely where they can fish for Salmon (assumption) - given that Salmon was not found in the other fishing grounds.</span>
<span id="cb143-1627"><a href="#cb143-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1630"><a href="#cb143-1630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1631"><a href="#cb143-1631" aria-hidden="true" tabindex="-1"></a>combined_path <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(vessel_trajectory_selected, vessel_trajectory_robber)</span>
<span id="cb143-1632"><a href="#cb143-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1633"><a href="#cb143-1633" aria-hidden="true" tabindex="-1"></a>points_data_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(points_data, points_data_robber)</span>
<span id="cb143-1634"><a href="#cb143-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1635"><a href="#cb143-1635" aria-hidden="true" tabindex="-1"></a>wrapped_subtitle <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(<span class="st">"Transhipment could have occured at these locations"</span>, <span class="at">width =</span> <span class="dv">60</span>)</span>
<span id="cb143-1636"><a href="#cb143-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1637"><a href="#cb143-1637" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-1638"><a href="#cb143-1638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1639"><a href="#cb143-1639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb143-1640"><a href="#cb143-1640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> combined_path, <span class="fu">aes</span>(<span class="at">color =</span> target), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb143-1641"><a href="#cb143-1641" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-1642"><a href="#cb143-1642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Path"</span>, </span>
<span id="cb143-1643"><a href="#cb143-1643" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"snappersnatcher7be"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"roachrobberdb6"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb143-1644"><a href="#cb143-1644" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-1645"><a href="#cb143-1645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_combined, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb143-1646"><a href="#cb143-1646" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb143-1647"><a href="#cb143-1647" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">size =</span> dwell_time), </span>
<span id="cb143-1648"><a href="#cb143-1648" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  </span>
<span id="cb143-1649"><a href="#cb143-1649" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb143-1650"><a href="#cb143-1650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span></span>
<span id="cb143-1651"><a href="#cb143-1651" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-1652"><a href="#cb143-1652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1653"><a href="#cb143-1653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Common Points at Lomark, Wrasse Beds and Nav C"</span>, </span>
<span id="cb143-1654"><a href="#cb143-1654" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> wrapped_subtitle, </span>
<span id="cb143-1655"><a href="#cb143-1655" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb143-1656"><a href="#cb143-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1657"><a href="#cb143-1657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1658"><a href="#cb143-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1659"><a href="#cb143-1659" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.5.4 When and Where did the illegal fishing took place?</span></span>
<span id="cb143-1660"><a href="#cb143-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1663"><a href="#cb143-1663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1664"><a href="#cb143-1664" aria-hidden="true" tabindex="-1"></a>SEC_catches <span class="ot">&lt;-</span> all_catch_summary <span class="sc">%&gt;%</span></span>
<span id="cb143-1665"><a href="#cb143-1665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (vessel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Snapper Snatcher"</span>, <span class="st">"Roach Robber"</span>))</span>
<span id="cb143-1666"><a href="#cb143-1666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1667"><a href="#cb143-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1670"><a href="#cb143-1670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1671"><a href="#cb143-1671" aria-hidden="true" tabindex="-1"></a>SEC_catch_summary <span class="ot">&lt;-</span> SEC_catches <span class="sc">%&gt;%</span></span>
<span id="cb143-1672"><a href="#cb143-1672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel, fishtype) <span class="sc">%&gt;%</span></span>
<span id="cb143-1673"><a href="#cb143-1673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fishtype_count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb143-1674"><a href="#cb143-1674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb143-1675"><a href="#cb143-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1676"><a href="#cb143-1676" aria-hidden="true" tabindex="-1"></a>SEC_catch_summary</span>
<span id="cb143-1677"><a href="#cb143-1677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1678"><a href="#cb143-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1679"><a href="#cb143-1679" aria-hidden="true" tabindex="-1"></a>From the table above, we would notice that because Snapper Snatcher spent time in the **Ghoti Preserve**, it would like have caught species like **Helenaa and Offidiaa** which are species that are found in the preserve only. These data is collated based on the vessel's transponder ping location.</span>
<span id="cb143-1680"><a href="#cb143-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1681"><a href="#cb143-1681" aria-hidden="true" tabindex="-1"></a>Next we will try to find out when did such fishing took place based on the transponder data.</span>
<span id="cb143-1682"><a href="#cb143-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1685"><a href="#cb143-1685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1686"><a href="#cb143-1686" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the location and vessel of interest</span></span>
<span id="cb143-1687"><a href="#cb143-1687" aria-hidden="true" tabindex="-1"></a>location_of_interest <span class="ot">&lt;-</span> <span class="st">"Ghoti Preserve"</span></span>
<span id="cb143-1688"><a href="#cb143-1688" aria-hidden="true" tabindex="-1"></a>vessel_of_interest <span class="ot">&lt;-</span> <span class="st">"Snapper Snatcher"</span></span>
<span id="cb143-1689"><a href="#cb143-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1690"><a href="#cb143-1690" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the specific location and vessel</span></span>
<span id="cb143-1691"><a href="#cb143-1691" aria-hidden="true" tabindex="-1"></a>trespassing_dates <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-1692"><a href="#cb143-1692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> location_of_interest, vessel <span class="sc">==</span> vessel_of_interest) <span class="sc">%&gt;%</span></span>
<span id="cb143-1693"><a href="#cb143-1693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time, month, day) </span>
<span id="cb143-1694"><a href="#cb143-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1695"><a href="#cb143-1695" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trespassing_dates)</span>
<span id="cb143-1696"><a href="#cb143-1696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1697"><a href="#cb143-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1698"><a href="#cb143-1698" aria-hidden="true" tabindex="-1"></a>We note from the data that the activities took place in **Feb and Mar** - however, this did not correspond to any cargo delivery reports from the earlier data.</span>
<span id="cb143-1699"><a href="#cb143-1699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1700"><a href="#cb143-1700" aria-hidden="true" tabindex="-1"></a>We will also check the other vessels that spent time in Ghoti Preserve.</span>
<span id="cb143-1701"><a href="#cb143-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1704"><a href="#cb143-1704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1705"><a href="#cb143-1705" aria-hidden="true" tabindex="-1"></a>other_trespassers <span class="ot">&lt;-</span> transponder <span class="sc">%&gt;%</span></span>
<span id="cb143-1706"><a href="#cb143-1706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location <span class="sc">==</span> <span class="st">"Ghoti Preserve"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1707"><a href="#cb143-1707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vessel, time, month, day, stay_duration, location) </span>
<span id="cb143-1708"><a href="#cb143-1708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1709"><a href="#cb143-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1712"><a href="#cb143-1712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1713"><a href="#cb143-1713" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb143-1714"><a href="#cb143-1714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span></span>
<span id="cb143-1715"><a href="#cb143-1715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb143-1716"><a href="#cb143-1716" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_vessels =</span> <span class="fu">n_distinct</span>(vessel),</span>
<span id="cb143-1717"><a href="#cb143-1717" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_stay_duration =</span> <span class="fu">mean</span>(stay_duration<span class="sc">/</span><span class="dv">360</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb143-1718"><a href="#cb143-1718" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb143-1719"><a href="#cb143-1719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1720"><a href="#cb143-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1723"><a href="#cb143-1723" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1724"><a href="#cb143-1724" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_summary, <span class="fu">aes</span>(<span class="at">x =</span> month)) <span class="sc">+</span></span>
<span id="cb143-1725"><a href="#cb143-1725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> unique_vessels), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"azure4"</span>) <span class="sc">+</span></span>
<span id="cb143-1726"><a href="#cb143-1726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_stay_duration <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"lightpink"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Scale mean stay duration for visibility</span></span>
<span id="cb143-1727"><a href="#cb143-1727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_stay_duration <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Add points for mean stay duration</span></span>
<span id="cb143-1728"><a href="#cb143-1728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb143-1729"><a href="#cb143-1729" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Number of Unique Vessels"</span>,</span>
<span id="cb143-1730"><a href="#cb143-1730" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Mean Stay Duration (hours)"</span>)  <span class="co"># Adjust secondary axis scale</span></span>
<span id="cb143-1731"><a href="#cb143-1731" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb143-1732"><a href="#cb143-1732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Trespass into Ghouti Preserve"</span>,</span>
<span id="cb143-1733"><a href="#cb143-1733" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-1734"><a href="#cb143-1734" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Unique Vessels"</span>) <span class="sc">+</span></span>
<span id="cb143-1735"><a href="#cb143-1735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-1736"><a href="#cb143-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1737"><a href="#cb143-1737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1738"><a href="#cb143-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1741"><a href="#cb143-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1742"><a href="#cb143-1742" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month and day to Date object</span></span>
<span id="cb143-1743"><a href="#cb143-1743" aria-hidden="true" tabindex="-1"></a>other_trespassers <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb143-1744"><a href="#cb143-1744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">month =</span> <span class="fu">month</span>(time, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb143-1745"><a href="#cb143-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1746"><a href="#cb143-1746" aria-hidden="true" tabindex="-1"></a>other_trespassers <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb143-1747"><a href="#cb143-1747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">stay_duration =</span> stay_duration<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-1748"><a href="#cb143-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1749"><a href="#cb143-1749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1750"><a href="#cb143-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1753"><a href="#cb143-1753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1754"><a href="#cb143-1754" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the boxplot</span></span>
<span id="cb143-1755"><a href="#cb143-1755" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(other_trespassers, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb143-1756"><a href="#cb143-1756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb143-1757"><a href="#cb143-1757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Box plot of Duration in Ghoti Preserve"</span>,</span>
<span id="cb143-1758"><a href="#cb143-1758" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-1759"><a href="#cb143-1759" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stay Duration (mins)"</span>,</span>
<span id="cb143-1760"><a href="#cb143-1760" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Mean time spent dropped in Apr to Jul; Increased from Aug to Nov"</span>) <span class="sc">+</span></span>
<span id="cb143-1761"><a href="#cb143-1761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-1762"><a href="#cb143-1762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1763"><a href="#cb143-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1764"><a href="#cb143-1764" aria-hidden="true" tabindex="-1"></a>From the charts, I postulate that after Snapper Snatcher was caught in May, the other vessels chose to spend lesser time in Ghoti Preserve, but their time in the Preserve subsequently picked up again from Aug onwards. This corresponds to the delivery pattern of **Helenaa and Offidiaa**, where their deliveries started to increase from Sep onwards. That said - we may also need to note the species habitual patterns and whether are they present in Ghoti Preserve during these months. (Tried to google these species, but seems like they are fictitious).</span>
<span id="cb143-1765"><a href="#cb143-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1766"><a href="#cb143-1766" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.5.6 Other Vessels Movement Path</span></span>
<span id="cb143-1767"><a href="#cb143-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1770"><a href="#cb143-1770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1771"><a href="#cb143-1771" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_carp <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb143-1772"><a href="#cb143-1772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"carpcapturer993"</span>)</span>
<span id="cb143-1773"><a href="#cb143-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1774"><a href="#cb143-1774" aria-hidden="true" tabindex="-1"></a>points_data_carp <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1775"><a href="#cb143-1775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"carpcapturer993"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1776"><a href="#cb143-1776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb143-1777"><a href="#cb143-1777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-1778"><a href="#cb143-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1779"><a href="#cb143-1779" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb143-1780"><a href="#cb143-1780" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_carp) <span class="ot">&lt;-</span> points_data_carp<span class="sc">$</span>geometry</span>
<span id="cb143-1781"><a href="#cb143-1781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1782"><a href="#cb143-1782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1783"><a href="#cb143-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1786"><a href="#cb143-1786" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1787"><a href="#cb143-1787" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-1788"><a href="#cb143-1788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1789"><a href="#cb143-1789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb143-1790"><a href="#cb143-1790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_carp, </span>
<span id="cb143-1791"><a href="#cb143-1791" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb143-1792"><a href="#cb143-1792" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb143-1793"><a href="#cb143-1793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_carp, </span>
<span id="cb143-1794"><a href="#cb143-1794" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb143-1795"><a href="#cb143-1795" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb143-1796"><a href="#cb143-1796" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb143-1797"><a href="#cb143-1797" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb143-1798"><a href="#cb143-1798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1799"><a href="#cb143-1799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"lavender"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1800"><a href="#cb143-1800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1801"><a href="#cb143-1801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Carp Capturer spent time at Himark, Wrasse Beds and Nav C"</span>, </span>
<span id="cb143-1802"><a href="#cb143-1802" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Dwell Time at Nav C seems high - can investigate further"</span>, </span>
<span id="cb143-1803"><a href="#cb143-1803" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb143-1804"><a href="#cb143-1804" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1805"><a href="#cb143-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1806"><a href="#cb143-1806" aria-hidden="true" tabindex="-1"></a>Carp Capturer seems like a fishing vessel that engages only in legal fishing activities, with no time spent in the reserves and mostly shuttling between the ports, navigation lines and the fishing grounds.</span>
<span id="cb143-1807"><a href="#cb143-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1808"><a href="#cb143-1808" aria-hidden="true" tabindex="-1"></a><span class="fu"># 7. Qn 3 - Workflow to discover other illegal fishing</span></span>
<span id="cb143-1809"><a href="#cb143-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1810"><a href="#cb143-1810" aria-hidden="true" tabindex="-1"></a>We have earlier identified that vessels **spending time in the reserve areas** could be suspected of illegal fishing, and **spending extra time at Nav C** could also be indicators of transshipment activities.</span>
<span id="cb143-1811"><a href="#cb143-1811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1812"><a href="#cb143-1812" aria-hidden="true" tabindex="-1"></a>We can first look at those vessels spending time at Ghoti Preserve and first look at vessels spending more time than the mean time by Snapper Snatcher (around 77 mins).</span>
<span id="cb143-1813"><a href="#cb143-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1816"><a href="#cb143-1816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1817"><a href="#cb143-1817" aria-hidden="true" tabindex="-1"></a>ghoti_trespassers <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb143-1818"><a href="#cb143-1818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel, month) <span class="sc">%&gt;%</span></span>
<span id="cb143-1819"><a href="#cb143-1819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_stay_duration =</span> <span class="fu">mean</span>(stay_duration))</span>
<span id="cb143-1820"><a href="#cb143-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1821"><a href="#cb143-1821" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the vessels based on the 75th percentile</span></span>
<span id="cb143-1822"><a href="#cb143-1822" aria-hidden="true" tabindex="-1"></a>top_vessels <span class="ot">&lt;-</span> ghoti_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb143-1823"><a href="#cb143-1823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vessel) <span class="sc">%&gt;%</span></span>
<span id="cb143-1824"><a href="#cb143-1824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean_stay_duration <span class="sc">&gt;=</span> <span class="dv">77</span>)</span>
<span id="cb143-1825"><a href="#cb143-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1826"><a href="#cb143-1826" aria-hidden="true" tabindex="-1"></a>top_vessels <span class="ot">&lt;-</span> top_vessels <span class="sc">%&gt;%</span></span>
<span id="cb143-1827"><a href="#cb143-1827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(month, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">mean_stay_duration =</span> <span class="cn">NA</span>))</span>
<span id="cb143-1828"><a href="#cb143-1828" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1829"><a href="#cb143-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1832"><a href="#cb143-1832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1833"><a href="#cb143-1833" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_vessels, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> vessel, <span class="at">fill =</span> mean_stay_duration)) <span class="sc">+</span></span>
<span id="cb143-1834"><a href="#cb143-1834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb143-1835"><a href="#cb143-1835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"lightblue"</span>, <span class="at">high =</span> <span class="st">"deepskyblue4"</span>, <span class="at">na.value =</span> <span class="st">"ghostwhite"</span>) <span class="sc">+</span>  <span class="co"># Adjust colors as needed</span></span>
<span id="cb143-1836"><a href="#cb143-1836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heatmap of Vessels in Ghoti Preserve by Month"</span>,</span>
<span id="cb143-1837"><a href="#cb143-1837" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-1838"><a href="#cb143-1838" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Vessel"</span>,</span>
<span id="cb143-1839"><a href="#cb143-1839" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Mean Stay(mins)"</span>,</span>
<span id="cb143-1840"><a href="#cb143-1840" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"To identify key vessels of interest - e.g. Gurnard Grabber"</span>) <span class="sc">+</span></span>
<span id="cb143-1841"><a href="#cb143-1841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-1842"><a href="#cb143-1842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1843"><a href="#cb143-1843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1844"><a href="#cb143-1844" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.1 Plot the Path of Gurnard Grabber</span></span>
<span id="cb143-1845"><a href="#cb143-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1848"><a href="#cb143-1848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1849"><a href="#cb143-1849" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_gurnard <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb143-1850"><a href="#cb143-1850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"gurnardgrabberd9a"</span>)</span>
<span id="cb143-1851"><a href="#cb143-1851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1852"><a href="#cb143-1852" aria-hidden="true" tabindex="-1"></a>points_data_gurnard <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1853"><a href="#cb143-1853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"gurnardgrabberd9a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1854"><a href="#cb143-1854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb143-1855"><a href="#cb143-1855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-1856"><a href="#cb143-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1857"><a href="#cb143-1857" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb143-1858"><a href="#cb143-1858" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_gurnard) <span class="ot">&lt;-</span> points_data_gurnard<span class="sc">$</span>geometry</span>
<span id="cb143-1859"><a href="#cb143-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1860"><a href="#cb143-1860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1861"><a href="#cb143-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1864"><a href="#cb143-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1865"><a href="#cb143-1865" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-1866"><a href="#cb143-1866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1867"><a href="#cb143-1867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb143-1868"><a href="#cb143-1868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> vessel_trajectory_gurnard, </span>
<span id="cb143-1869"><a href="#cb143-1869" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"blue"</span>,  <span class="co"># Set the color of the trajectory</span></span>
<span id="cb143-1870"><a href="#cb143-1870" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb143-1871"><a href="#cb143-1871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_gurnard, </span>
<span id="cb143-1872"><a href="#cb143-1872" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb143-1873"><a href="#cb143-1873" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb143-1874"><a href="#cb143-1874" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> dwell_time, <span class="at">color =</span> dwell_time), </span>
<span id="cb143-1875"><a href="#cb143-1875" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add points with size based on dwell time</span></span>
<span id="cb143-1876"><a href="#cb143-1876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1877"><a href="#cb143-1877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>, <span class="at">low =</span> <span class="st">"mediumpurple1"</span>, <span class="at">high =</span> <span class="st">"mediumpurple4"</span>) <span class="sc">+</span>  </span>
<span id="cb143-1878"><a href="#cb143-1878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1879"><a href="#cb143-1879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gurnard Grabber - at Ghoti Preserve, Nav points and Exit East"</span>, </span>
<span id="cb143-1880"><a href="#cb143-1880" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Dwell Time at these areas seem high - can investigate further"</span>, </span>
<span id="cb143-1881"><a href="#cb143-1881" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb143-1882"><a href="#cb143-1882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1883"><a href="#cb143-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1886"><a href="#cb143-1886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1887"><a href="#cb143-1887" aria-hidden="true" tabindex="-1"></a>gurnard <span class="ot">&lt;-</span> other_trespassers <span class="sc">%&gt;%</span></span>
<span id="cb143-1888"><a href="#cb143-1888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vessel <span class="sc">==</span> <span class="st">"Gurnard Grabber"</span>)</span>
<span id="cb143-1889"><a href="#cb143-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1890"><a href="#cb143-1890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1891"><a href="#cb143-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1894"><a href="#cb143-1894" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1895"><a href="#cb143-1895" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gurnard, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> stay_duration)) <span class="sc">+</span></span>
<span id="cb143-1896"><a href="#cb143-1896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">fill =</span> <span class="st">"azure4"</span>) <span class="sc">+</span></span>
<span id="cb143-1897"><a href="#cb143-1897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(stay_duration, <span class="dv">2</span>)), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Add labels above the bars</span></span>
<span id="cb143-1898"><a href="#cb143-1898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gurnard Grabber's stay in Ghoti Preserve"</span>,</span>
<span id="cb143-1899"><a href="#cb143-1899" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb143-1900"><a href="#cb143-1900" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Stay Duration"</span>,</span>
<span id="cb143-1901"><a href="#cb143-1901" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Long duration in Oct corresponds to higher deliveries in Ports"</span>, </span>
<span id="cb143-1902"><a href="#cb143-1902" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Month"</span>) <span class="sc">+</span></span>
<span id="cb143-1903"><a href="#cb143-1903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span> (<span class="dv">0</span>,<span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb143-1904"><a href="#cb143-1904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb143-1905"><a href="#cb143-1905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1906"><a href="#cb143-1906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1907"><a href="#cb143-1907" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.2 Investigate vessels from the same company</span></span>
<span id="cb143-1908"><a href="#cb143-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1909"><a href="#cb143-1909" aria-hidden="true" tabindex="-1"></a>After plotting the path, we can investigate further based on the vessels from the same company, e.g. in this case **Schmidt Ltd**, with another vessel, **Black Bullhead Bandit** (blackbullheadbandit801), similarly by plotting the paths, can checking the dwell times of the vessels at the suspected areas.</span>
<span id="cb143-1910"><a href="#cb143-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1913"><a href="#cb143-1913" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1914"><a href="#cb143-1914" aria-hidden="true" tabindex="-1"></a>vessel_trajectory_bandit <span class="ot">&lt;-</span> vessel_trajectory <span class="sc">%&gt;%</span></span>
<span id="cb143-1915"><a href="#cb143-1915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(target <span class="sc">==</span> <span class="st">"blackbullheadbandit801"</span>)</span>
<span id="cb143-1916"><a href="#cb143-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1917"><a href="#cb143-1917" aria-hidden="true" tabindex="-1"></a>points_data_bandit <span class="ot">&lt;-</span> vessel_movement_sf <span class="sc">%&gt;%</span></span>
<span id="cb143-1918"><a href="#cb143-1918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (target <span class="sc">==</span> <span class="st">"blackbullheadbandit801"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-1919"><a href="#cb143-1919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb143-1920"><a href="#cb143-1920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">dwell_time =</span> <span class="fu">sum</span>(dwell)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb143-1921"><a href="#cb143-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1922"><a href="#cb143-1922" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the geometry column is retained as a 'geometry' class</span></span>
<span id="cb143-1923"><a href="#cb143-1923" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(points_data_bandit) <span class="ot">&lt;-</span> points_data_bandit<span class="sc">$</span>geometry</span>
<span id="cb143-1924"><a href="#cb143-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1925"><a href="#cb143-1925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1926"><a href="#cb143-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1929"><a href="#cb143-1929" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1930"><a href="#cb143-1930" aria-hidden="true" tabindex="-1"></a>combined_path_gb <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(vessel_trajectory_gurnard, vessel_trajectory_bandit)</span>
<span id="cb143-1931"><a href="#cb143-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1932"><a href="#cb143-1932" aria-hidden="true" tabindex="-1"></a>points_data_gb <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(points_data_gurnard, points_data_bandit)</span>
<span id="cb143-1933"><a href="#cb143-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1934"><a href="#cb143-1934" aria-hidden="true" tabindex="-1"></a>wrapped_subtitle <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(<span class="st">"Transshipment could have occured at these locations"</span>, <span class="at">width =</span> <span class="dv">60</span>)</span>
<span id="cb143-1935"><a href="#cb143-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1936"><a href="#cb143-1936" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-1937"><a href="#cb143-1937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> OceanusGeography) <span class="sc">+</span></span>
<span id="cb143-1938"><a href="#cb143-1938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> OceanusGeography, <span class="fu">aes</span>(<span class="at">label =</span> Name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb143-1939"><a href="#cb143-1939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> combined_path_gb, <span class="fu">aes</span>(<span class="at">color =</span> target), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb143-1940"><a href="#cb143-1940" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-1941"><a href="#cb143-1941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Path"</span>, </span>
<span id="cb143-1942"><a href="#cb143-1942" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"gurnardgrabberd9a"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"blackbullheadbandit801"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb143-1943"><a href="#cb143-1943" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-1944"><a href="#cb143-1944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> points_data_gb, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"X"</span>], </span>
<span id="cb143-1945"><a href="#cb143-1945" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="st">"Y"</span>], </span>
<span id="cb143-1946"><a href="#cb143-1946" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">size =</span> dwell_time), </span>
<span id="cb143-1947"><a href="#cb143-1947" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  </span>
<span id="cb143-1948"><a href="#cb143-1948" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb143-1949"><a href="#cb143-1949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Dwell Time (mins)"</span>) <span class="sc">+</span></span>
<span id="cb143-1950"><a href="#cb143-1950" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-1951"><a href="#cb143-1951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-1952"><a href="#cb143-1952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Common Points at East of Oceanus"</span>, </span>
<span id="cb143-1953"><a href="#cb143-1953" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> wrapped_subtitle, </span>
<span id="cb143-1954"><a href="#cb143-1954" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span>
<span id="cb143-1955"><a href="#cb143-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1956"><a href="#cb143-1956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1957"><a href="#cb143-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1958"><a href="#cb143-1958" aria-hidden="true" tabindex="-1"></a><span class="fu"># 8. References</span></span>
<span id="cb143-1959"><a href="#cb143-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1960"><a href="#cb143-1960" aria-hidden="true" tabindex="-1"></a>Refer to the kickstarter provided for by Dr T.S. Kam:</span>
<span id="cb143-1961"><a href="#cb143-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1962"><a href="#cb143-1962" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Kickstarter 2: Working with Graph Data</span><span class="co">](https://isss608-ay2023-24apr.netlify.app/vast/kickstarter2)</span></span>
<span id="cb143-1963"><a href="#cb143-1963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1964"><a href="#cb143-1964" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Kickstarter 3: Working with Geographic Data</span><span class="co">](https://isss608-ay2023-24apr.netlify.app/vast/kickstarter3)</span></span>
<span id="cb143-1965"><a href="#cb143-1965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1966"><a href="#cb143-1966" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Transhipment: Issues and Responses in the FCWC Region</span><span class="co">](https://stopillegalfishing.com/publications/transhipment-issues-and-responses-in-the-fcwc-region/#:~:text=Transhipment%3A%20Issues%20and%20Responses%20in%20the%20FCWC%20Region%20aims%20to,and%20the%20trade%20in%20fish.)</span></span>
<span id="cb143-1967"><a href="#cb143-1967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1968"><a href="#cb143-1968" aria-hidden="true" tabindex="-1"></a><span class="fu"># 9. Data Preparation for Shiny App</span></span>
<span id="cb143-1969"><a href="#cb143-1969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1970"><a href="#cb143-1970" aria-hidden="true" tabindex="-1"></a><span class="fu">## List of Vessel Names </span></span>
<span id="cb143-1971"><a href="#cb143-1971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1974"><a href="#cb143-1974" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1975"><a href="#cb143-1975" aria-hidden="true" tabindex="-1"></a>vessel_list <span class="ot">&lt;-</span> mc2_nodes <span class="sc">%&gt;%</span></span>
<span id="cb143-1976"><a href="#cb143-1976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Entity.Vessel.FishingVessel"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-1977"><a href="#cb143-1977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(</span>
<span id="cb143-1978"><a href="#cb143-1978" aria-hidden="true" tabindex="-1"></a>    type <span class="sc">==</span> <span class="st">"Entity.Vessel.FishingVessel"</span> <span class="sc">~</span> <span class="st">"FishingVessel"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb143-1979"><a href="#cb143-1979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(type, Name, id, flag_country, tonnage, length_overall, company) <span class="sc">%&gt;%</span></span>
<span id="cb143-1980"><a href="#cb143-1980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">vessel =</span> id)</span>
<span id="cb143-1981"><a href="#cb143-1981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb143-1982"><a href="#cb143-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-1985"><a href="#cb143-1985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb143-1986"><a href="#cb143-1986" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span> (vessel_list, <span class="st">"data/rds/vessel_list.rds"</span>)</span>
<span id="cb143-1987"><a href="#cb143-1987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>